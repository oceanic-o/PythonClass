var Microsoft="object"==typeof Microsoft?Microsoft:{};Microsoft.Office=Microsoft.Office||{},Microsoft.Office.PowerPoint=function(e){var t={};function i(o){if(t[o])return t[o].exports;var s=t[o]={i:o,l:!1,exports:{}};return e[o].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(o,s,function(t){return e[t]}.bind(null,s));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=16)}({16:function(e,t,i){"use strict";i.r(t),i.d(t,"DocRebootSupportMode",(function(){return ao})),i.d(t,"CommandIds",(function(){return z})),i.d(t,"EventIds",(function(){return K})),i.d(t,"createCancellationToken",(function(){return et})),i.d(t,"Application",(function(){return co})),i.d(t,"createApplication",(function(){return lo}));const o=[[/!/g,"%21"],[/'/g,"%27"],[/\(/g,"%28"],[/\)/g,"%29"],[/\*/g,"%2A"]],s=["eurppc"];function n(e){return 8===e.toLowerCase().indexOf("ffc")}function r(e){return 8===e.toLowerCase().indexOf("ppc")}function a(e){const t=e.match(/^https:\/\/((?!word)\w+)(-\w+)+\..*$/i);return t&&t[1]?t[1]:"public"}function c(e,t){if(!t||-1===s.indexOf(t.toLowerCase()))return e;const i=e.match(/(^http[s]:\/\/)((?!word)\w*[-])?(.*)/i);return i?`${i[1]}${t}-${i[3]}`:e}function d(e){const t=e.match(/^(.*?\/\/[^\/]+)(.*)$/);if(!t)throw new Error("Invalid URL");return t[1]}function l(e,t){const i=e.match(/^(.*?\/\/)([^\/:]+)(.*)$/);if(!i)throw new Error("Invalid URL");const o=i[2];if(void 0===t)return o;if(t<0)throw new Error("subDomainParts should be at least 1");return o.split(".").slice(-(t+1)).join(".")}function h(e){return e+"RemoteUls.ashx"}function u(e,t,i){i&&(e[t.toLowerCase()]=i)}function p(e,t){e[t.toLowerCase()]=""}function f(e,t){const i=e.toLowerCase(),o=t.toLowerCase();let s=i.indexOf("&"+o+"=");if(-1===s&&(s=i.indexOf("?"+o+"=")),-1===s)return"";const n=s+(t.length+2),r=e.indexOf("&",n);return e.substring(n,-1===r?void 0:r)}function m(e,t,i,o){if(!i)return e;let s=e;const n=s.indexOf("?");let r="&";n===s.length-1||"&"===s.slice(-1)||"&>"===s.slice(-2)?r="":-1===n&&(r="?");const a=t.toLowerCase()+"=",c=new RegExp("\\W"+a,"i").exec(s);if("?"!==r&&c){if(o){const e=c.index+1,t=s.indexOf("&",e);s=s.substring(0,e)+a+i+(-1===t?"":s.substring(t))}return s}return s.concat(r,a,i)}function w(e){const t={},i=e.indexOf("?");return-1===i||i===e.length-1||e.substring(i+1).replace(new RegExp(/<.*?>/g),"").split("&").forEach(e=>{if(e){const i=e.indexOf("=");-1!==i&&i!==e.length-1&&(t[e.substring(0,i).toLowerCase()]=e.substring(i+1))}}),t}function g(e,t){if(!e)return e;let i=e;const o=i.indexOf("?"),s=t.toLowerCase()+"=",n=i.toLowerCase().indexOf(s,o);if(n>=0){const e=i.indexOf("&",n);return i=i.substring(0,n)+(-1===e?"":i.substring(e+1)),"&"===i.slice(-1)&&(i=i.slice(0,-1)),i}return e}function v(e){const t=new RegExp("(c[1-5])h?(-)");return e.replace(t,"$1h$2")}function S(e,t,i){const o=new RegExp("[?&]"+t+"=("+(i||"1")+")\\b","i"),s=e.match(o);return!(!s||i&&s[1]!==i)}function I(e,t){const i=f(e,t);return i?decodeURI(i):i}function _(e){return f(window.location.href,e)}function b(e){let t=encodeURIComponent(e);return o.forEach(e=>{t=t.replace(e[0],e[1])}),t}function T(e){let t=(e+"===").substring(0,e.length+(4-e.length%4)%4);return t=t.replace(/-/g,"+"),t=t.replace(/_/g,"/"),atob(t)}function C(e){const t=document.createElement("a");t.href=e;const i=t.port||80,o=window.location.port||80;return t.hostname===window.location.hostname&&i===o}function P(e){return e?e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0]:""}function y(e=!1,t){return{shouldPreconnect:e=>A&&(!t||t(e)),preconnect:t=>function(e){const t=document.createElement("link");t.rel="preconnect",t.href=e,t.crossOrigin="anonymous",document.head.appendChild(t)}(e?v(t):t)}}const A=!0;var U,E,F;function R(e,t,i){if(!t)return;const o=window.navigator;if(o&&o.sendBeacon)try{return void o.sendBeacon(t,e)}catch{}!function(e,t,i){const o=new XMLHttpRequest;o.readyState!==XMLHttpRequest.UNSENT&&o.readyState!==XMLHttpRequest.DONE||(o.open("POST",t,i),o.send(e))}(e,t,i)}!function(e){e.Unknown="UNKNOWN",e.Initialized="INITIALIZED",e.Prebooted="PREBOOTED",e.Booting="BOOTING",e.Booted="BOOTED",e.Failed="FAILED",e.Disposing="DISPOSING",e.Disposed="DISPOSED"}(U||(U={})),function(e){e[e.h=0]="msoulscat_ES_EWAJS",e[e.u=1]="msoulscat_ES_EWAJSGrid",e[e.g=6]="msoulscat_ES_EWAJSChart",e[e.v=202]="msoulscat_MSOSP_FileMenuCommands",e[e._=220]="msoulscat_MSOSP_AddInCommands",e[e.P=225]="msoulscat_MSOSP_OTelJS",e[e.A=227]="msoulscat_MSOSP_OTelJSInWebWoker",e[e.U=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",e[e.F=301]="msoulscat_Wac_WordViewer",e[e.R=306]="msoulscat_Wac_BrowserGeneral",e[e.O=320]="msoulscat_Wac_TaskPane",e[e.k=339]="msoulscat_Wac_OneNoteGeneral",e[e.N=340]="msoulscat_Wac_Ribbon",e[e.H=356]="msoulscat_Wac_WacFeedback",e[e.B=379]="msoulscat_Wac_WopiPendingApplication",e[e.J=383]="msoulscat_Wac_Telemetry",e[e.$=391]="msoulscat_Wac_WacCatchUpActivities",e[e.j=394]="msoulscat_Wac_Dictation",e[e.q=395]="msoulscat_Wac_OneNoteSync",e[e.K=700]="msoulscat_Wac_VisioApp",e[e.Z=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.X=800]="msoulscat_Wac_PptAnimation",e[e.Y=833]="msoulscat_Wac_PptLive",e[e.ee=834]="msoulscat_Wac_PptMWeb",e[e.te=835]="msoulscat_Wac_PptGc2General",e[e.ie=836]="msoulscat_Wac_PptGc2GraphicHost",e[e.oe=837]="msoulscat_Wac_PptGc2Operation",e[e.se=852]="msoulscat_Wac_PptGc2EditCanvas",e[e.ne=844]="msoulscat_Wac_PptDataSync",e[e.re=848]="msoulscat_Wac_PptFluidRuntime",e[e.ae=815]="msoulscat_Wac_PptShape",e[e.ce=817]="msoulscat_Wac_PptSession",e[e.de=830]="msoulscat_Wac_PptSlideshow",e[e.le=822]="msoulscat_Wac_PptView",e[e.he=846]="msoulscat_Wac_PptVideos",e[e.ue=1303]="msoulscat_Uci_Insights",e[e.pe=2300]="msoulscat_Wac_VersionHistory",e[e.fe=302]="msoulscat_Wac_WordPresence",e[e.me=3e3]="msoulscat_Wac_OAuth",e[e.we=3005]="msoulscat_Wac_WordVersionHistory",e[e.ge=3006]="msoulscat_Wac_LivePersonaCard",e[e.ve=3012]="msoulscat_Wac_CatchUpFlyout",e[e.Se=3016]="msoulscat_Wac_WordDesigner",e[e.Ie=3021]="msoulscat_Wac_ModernFontPicker",e[e._e=3027]="msoulscat_Wac_UnifiedUiHost",e[e.be=3033]="msoulscat_Wac_EquationTools",e[e.Te=1401]="msoulscat_Osf_Latency",e[e.Ce=1402]="msoulscat_Osf_Notification",e[e.Pe=1403]="msoulscat_Osf_Runtime",e[e.ye=3041]="msoulscat_Wac_AiMaker",e[e.Ae=3043]="msoulscat_Wac_AiRewrite",e[e.Ue=3044]="msoulscat_Wac_AiInsert",e[e.Ee=3047]="msoulscat_Wac_AiSummarize",e[e.Fe=3048]="msoulscat_Wac_CopilotCompose",e[e.Re=3049]="msoulscat_Wac_Skittles",e[e.We=3050]="msoulscat_Wac_CopilotChat",e[e.Oe=3051]="msoulscat_Wac_Syntex",e[e.ke=3052]="msoulscat_Wac_WireGraph",e[e.Ne=3053]="msoulscat_Wac_CshCopilot",e[e.Me=3054]="msoulscat_Wac_CopilotComposeLaunchpad",e[e.De=3055]="msoulscat_Wac_CopilotProactiveSummary",e[e.xe=3056]="msoulscat_Wac_CopilotProactiveShared",e[e.He=3057]="msoulscat_Wac_CopilotCursor"}(E||(E={})),function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Important=20]="Important",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(F||(F={}));const W={BUILD_NUMBER:"###VERSION###",BUILD_NUMBER_MINOR:-1};function O(){try{return W.BUILD_NUMBER}catch(e){return W.BUILD_NUMBER}}function k(){return W.BUILD_NUMBER_MINOR}var N,M;function D(e,t,i){!function(e,t,i,o=!0){const s={type:t.toString(),payloadJson:JSON.stringify(i)};R(JSON.stringify(s),e,o)}(e,N.JSAPI_STATE,{application:t,build:O(),state:i})}function x(){return window.performance.now()}function H(){return Math.round(window.performance.now()+window.performance.timeOrigin)}!function(e){e.JSAPI_STATE="JSAPI_STATE",e.H_V2="H_V2"}(N||(N={})),function(e){e[e.Trace=0]="Trace",e[e.Assert=1]="Assert"}(M||(M={}));class B{getTimeSpentLogging(){return this.Be}addLoggingTime(e){this.Be+=e}configure(e){const t=x();if(e.uploadCadenceInMs&&(this.Ve=e.uploadCadenceInMs),e.uploadTriggerSize&&(this.Le=e.uploadTriggerSize),e.sessionId&&(this.Je=e.sessionId),e.remoteUlsEndpoint){if(!e.sessionId&&this.Ge)throw new Error("Remote ULS endpoint is already set");this.Ge=this.$e(e.remoteUlsEndpoint),this.ze=H(),this.je()}this.Be+=x()-t}handleTrace(e){const t=x();e.message.length>3072&&(e.message=e.message.substring(0,3072-"... [Trimmed]".length)+"... [Trimmed]"),this.qe.push(e),(this.qe.length>this.Le||e.level===F.Error)&&this.je(),this.Be+=x()-t}getUserSessionId(){return this.Je}constructor(e){this.Ve=3e4,this.Le=30,this.Ke=0,this.qe=[],this.ze=H(),this.Ze=[],this.Je="",this.Be=0,this.flushOnClose=()=>{this.Xe(!1,!1)},this.flush=()=>{this.je()},this.flushAndSetNewEndpoint=(e,t)=>{var i;const o=this.$e(e);o.localeCompare(null!==(i=this.Ge)&&void 0!==i?i:"",void 0,{sensitivity:"accent"})&&(this.Ze.push(()=>{this.Ge=o,t&&t()}),this.Xe(!0,!0))},this.updateEndpointAndFlush=e=>{this.Ge=this.$e(e),this.Xe(!0,!0)},this.$e=e=>e+"?usid="+this.Je+"&officeserverversion="+O(),this.je=()=>{window.setTimeout(()=>this.Xe(!0,!0),0)},this.Xe=(e,t)=>{const i=x();window.clearTimeout(this.Qe),this.Ge&&(this.qe.length>0&&(this.Ke+=1,R(function(e,t,i,o){const s=[],n=e.map(e=>function(e,t,i){const o={};if(o.G=e.tag,o.T=e.timestamp-t,o.M=e.message,o.C=e.category,e.correlationId){let t=i.findIndex(t=>t===e.correlationId);t<0&&(t=i.push(e.correlationId)-1),o.I=t}const s=1e3*e.type+e.level;return o.D=s,o}(e,o,s)),r=function(e,t,i,o,s){const n={};return n.T=e,n.L=t,n.S=i,n.I=o,s&&s.length>0&&(n.W=s),n.V=1,n}(o,n,t,i,s);return JSON.stringify(r)}(this.qe.splice(0,e?this.Le:this.qe.length),this.Je,this.Ke,this.ze),this.Ge,t),this.ze=H()),0===this.qe.length&&this.Ze.length>0&&(this.Ze.forEach(e=>{"requestIdleCallback"in window?window.requestIdleCallback(e):window.setTimeout(e,0)}),this.Ze=[]),e&&(this.Qe=window.setTimeout(()=>{this.je()},this.qe.length>this.Le||this.Ze.length>0?1e3:this.Ve)),this.Be+=x()-i)},e&&this.configure(e)}}let V,L=[];var J,G,$,z,j,q,K;function Z(e){const t=new B(e);function i(e,i,o,s){const n=x();if(function(e){return 1===L[e]}(e))return;const r={timestamp:H(),category:i,tag:e,level:o,type:M.Trace,message:s,correlationId:""};t.addLoggingTime(x()-n),t.handleTrace(r)}return{ULS:{Ye:(e,t,o,s)=>{i(e,t,o,s)},shipAssertTag:(e,t,o,s)=>{o&&i(e,t,F.Error,s)},debugAssertTag:(e,t,i,o)=>{throw new Error("Debug Asserts not Implemented in the TypeScript bULS module")},flush:t.flush,flushOnClose:t.flushOnClose,setCorrelationId:()=>{}},configure:e=>{t.configure(e)},settingsChangeHandler:e=>{var i,o;i=e.et.getValue(J.tt,""),o=e.et.getValue(J.it,""),V&&o===V||(L=[],V=o,i&&i.split(",").forEach(e=>{const t=parseInt(e,10);t&&(L[t]=1)})),t.configure({uploadCadenceInMs:e.et.getValue(J.ot,6e4)});const s=e.et.getValue(J.st,"").toString();""!==s&&t.flushAndSetNewEndpoint(s)},getTimeSpentLogging:()=>t.getTimeSpentLogging(),getUserSessionId:()=>t.getUserSessionId(),flushAndSetNewEndpoint:(e,i)=>{t.flushAndSetNewEndpoint(e,i)},updateEndpointAndFlush:e=>{t.updateEndpointAndFlush(e)}}}function X(e){if(e){const t=e.lastIndexOf(".");if(-1!==t)return e.substring(t+1).toLowerCase()}return""}function Q(e,t){return void 0===t?null:t}function Y(e){if(!e)return"";const t=Object.getOwnPropertyNames(e),i=Object.getOwnPropertyNames(Object.getPrototypeOf(e));return JSON.stringify(e,[...t,...i])}function ee(e,t){return{isFeatureEnabled:i=>function(e,t,i){if(t)try{return t(e)}catch(e){i&&i.ULS.Ye(594883024,E.B,F.Error,"IsFeatureEnabled callback error: "+Y(e))}}(i,e,t)}}function te(e,t){const i={};if(Object.keys(G).forEach(t=>{const o=e.isFeatureEnabled(G[t]);void 0!==o&&(i[G[t]]=o?"1":"0")}),t&&t.wdFlights){const e=t.wdFlights.toLowerCase();for(const t of e.split(","))"et-treatment"!==t&&"et-control"!==t||(i[G.nt]="et-treatment"===t?"1":"0")}return JSON.stringify(i)}!function(e){e.rt="BootstrapperMaxUlsHeartbeatTime",e.ct="BootstrapperNoCompleteWarning1Time",e.dt="BootstrapperNoCompleteWarning2Time",e.it="RemoteUlsETag",e.tt="RemoteUlsSuppressions",e.lt="BootstrapperSettingsFetchPeriod",e.ht="timestamp",e.ut="BootstrapperUlsHeartbeatIntervalMs",e.pt="BootstrapperUlsHeartBeatIsEnabled",e.ot="BootstrapperUlsUploadCadenceMs",e.ft="WordConsumptionViewToEditRedirectIsEnabled",e.wt="RequestedCallThrottlingDefaultToViewMinimumValue",e.st="BulsEndpointUrl",e.gt="EnableCommonHostDiagnosticsParams",e.vt="EnableICNForWord",e.St="EnableModernEmbedViewForPowerPoint",e.It="EnableModernEmbedViewInOneUpForPowerPoint",e._t="EnableModernEmbedViewForPowerPointGlobalAppUrl",e.bt="EnableModernReadingViewForPowerPoint",e.Tt="EnableDefaultToModernForPowerPoint",e.Ct="ShouldLogJsApiKpisForWord",e.Pt="WordSwitchToViewInTeamsJsapiV1Enabled",e.yt="EnableWordSessionRefreshTelemetry",e.At="PowerPointUseEssDCHint",e.Ut="ModernEmbedViewBootstrapperFeatureGatesForPowerPoint",e.Et="ModernReadingViewBootstrapperFeatureGatesForPowerPoint",e.Ft="ModernEmbedViewForPowerPointEnabledPercentage",e.Rt="PowerPointESSCookieLookbackThresholdHour",e.Wt="PowerPointSetESSCookieLookbackExpEnabled",e.Ot="ExcelForceViewOnlyInTeamsJsapiV1",e.kt="EnableWordSessionRefreshLoggingCleanup",e.Nt="WordRefreshTelemetryExpirationInDays"}(J||(J={})),function(e){e.nt="EnterpriseTemplates",e.Mt="ExcelAdaptiveLayoutDownload",e.Dt="ExcelLandingPageOfflineTelemetry",e.xt="ExcelLandingPageObserverRetry",e.Ht="H2StaticContent",e.Bt="HashedUrl",e.Vt="ODCShareLinkPreload",e.Lt="OfficeComExcelJsApiV2",e.Jt="OfficeComPptJsApiV2",e.Gt="OfficeComUiHost",e.$t="OfficeComWordJsApiV2",e.zt="OfficeHwaUiHost",e.jt="OfficeUnifiedUiHostTeams",e.qt="WordViewToUnifiedRead",e.Kt="PowerPointEarlySessionStart"}(G||(G={}));class ie{add(e){e&&this.Zt.push(e)}remove(e){if(!e)return;const t=this.Zt.indexOf(e);t>-1&&this.Zt.splice(t,1)}removeAll(){this.Zt=[]}dispatch(e,t){this.Zt.forEach(i=>{try{i(e)}catch(e){t&&t(e)}})}constructor(){this.Zt=[]}}class oe{updateEnvironment(e){this.Xt=(n(e)?"FF":"Prod")+this.Qt+"Settings",this.Yt()}initializePeriodicFetch(e,t){this.Xt=(n(e)?"FF":"Prod")+this.Qt+"Settings",this.Yt(),this.ei=e+"AppSettingsHandler.ashx?app="+this.Qt+"&usid="+t+"&build="+O(),this.ti||(this.ti=window.setTimeout(this.ii,3e4))}getValue(e,t){if(this.oi||this.Yt(),!this.oi||!this.oi.hasOwnProperty(e))return t;const i=this.oi[e],o=typeof t;if(typeof i===o)return i;if("string"==typeof i){if("number"===o)return parseInt(i,10);if("boolean"===o)return"true"===i}return t}addSettingsChangeListener(e){this.si.add(e)}removeSettingsChangeListener(e){this.si.remove(e)}dispose(){this.ti&&window.clearTimeout(this.ti),this.ni&&self.cancelIdleCallback(this.ni),this.ti=void 0,this.ni=void 0,this.oi=void 0,this.si.removeAll()}constructor(e,t){this.ri=0,this.Yt=()=>{try{if(!window||!window.localStorage)return;const e=window.localStorage.getItem(this.Xt);if(!e)return;const t=JSON.parse(e);this.ai(t)}catch(e){this.ci.ULS.Ye(592836768,E.B,F.Warning,"Failed to get settings from localStorage: "+Y(e))}},this.ai=e=>!!this.di(e)&&(this.oi=e,this.si.dispatch({et:this},e=>{this.ci.ULS.Ye(592836769,E.B,F.Error,"Settings listener error: "+Y(e))}),!0),this.di=e=>{if(e&&"object"==typeof e){if(e.hasOwnProperty(J.ht)&&!isNaN(e.timestamp))return!0;this.ci.ULS.Ye(592836770,E.B,F.Error,"Received invalid settings")}return!1},this.ii=()=>{if(!this.ei)return;const e=new XMLHttpRequest;window.location.href.indexOf("wdkestrelrouting=true")>-1?e.setRequestHeader("X-KestrelRouting","true"):window.location.href.indexOf("wdkestrelrouting=false")>-1&&e.setRequestHeader("X-KestrelRouting","false"),e.open("GET",this.ei),e.responseType="json",e.timeout=5e3,e.send(),e.onload=()=>{if(200===e.status&&e.response?(this.li(e.response),this.ri=0):(this.ci.ULS.Ye(592836771,E.B,F.Error,`Fetch settings error. Status: ${e.status}, curErrors: ${this.ri}`),this.ri+=1),this.ri>7)return;let t=this.getValue(J.lt,3e5);this.ri>3&&(t+=(this.ri-3+1)*(t/2)),this.ti=window.setTimeout(this.ii,t)}},this.li=e=>{"requestIdleCallback"in window?(this.ni&&self.cancelIdleCallback(this.ni),this.ni=window.requestIdleCallback(()=>this.hi(e),{timeout:1e4})):window.setTimeout(()=>this.hi(e),0)},this.hi=e=>{if(!this.ai(e)||!window||!window.localStorage)return;const t=JSON.stringify(e);try{window.localStorage.setItem(this.Xt,t)}catch(e){this.ci.ULS.Ye(592836800,E.B,F.Warning,"Failed to set localStorage: "+Y(e))}},this.Qt=e,this.Xt="Prod"+e+"Settings",this.ci=t,this.si=new ie,this.Yt()}}!function(e){e.appReboot="appReboot",e.boot="boot",e.closeTab="closeTab",e.createNew="createNew",e.dispose="dispose",e.frameTrust="frameTrust",e.getAuthToken="getAuthToken",e.getHostKeyValue="getHostKeyValue",e.handleBootState="handleBootState",e.postWacToken="postWacToken",e.rename="rename",e.setOverlayContent="setOverlayContent",e.storeHostKeyValue="storeHostKeyValue",e.switchMode="switchMode",e.updateBootComplete="updateBootComplete",e.setWacFlightValue="setWacFlightValue"}($||($={})),function(e){e.blurFocus="blurFocus",e.boot="boot",e.completeCreateNew="completeCreateNew",e.continueAccessibilityLoop="continueAccessibilityLoop",e.createNew="createNew",e.dispose="dispose",e.grabFocus="grabFocus",e.moveToFolder="moveToFolder",e.popState="popState",e.sendChannelId="sendChannelId",e.sendConvId="sendConvId",e.teamsUsersReply="teamsUsersReply",e.teamsUserMentionReply="teamsUserMentionReply",e.backButtonPressed="backButtonPressed",e.getClientUrl="getClientUrl",e.getWebUrl="getWebUrl",e.rename="rename",e.completeSharedFilePicker="completeSharedFilePicker",e.sendAccessToken="sendAccessToken",e.sendAuthToken="sendAuthToken",e.sendCustomAuthConfig="sendCustomAuthConfig",e.sendEmbeddedViewUrl="sendEmbeddedViewUrl",e.sendFrameTrustResult="sendFrameTrustResult",e.sendHWRTelemetry="sendHWRTelemetry",e.sendSessionInfo="sendSessionInfo",e.sendUserAccessAndPermissions="sendUserAccessAndPermissions",e.sendWopiInfo="sendWopiInfo",e.sendDavUrl="sendDavUrl",e.switchMode="switchMode",e.signalShared="signalShared",e.postWacToken="postWacToken"}(z||(z={})),function(e){e.pi="App_AccessibilityLoopComplete",e.fi="Wac_ActionComplete",e.mi="WacInitialize_Ready",e.wi="Wac_AppFailed",e.gi="Wac_AppBootState",e.vi="Wac_AppCompleted",e.Si="BrowserEvent",e.Ii="UI_Close",e._i="App_CloseTab",e.bi="UI_Conversation",e.Ti="UI_CopyAndEdit",e.Ci="App_CreateNewDocument",e.Pi="Wac_AppDataSavedStatus",e.yi="UI_Download",e.Ai="UI_Edit",e.Ui="Error",e.Ei="UI_FileEmbed",e.Fi="UI_FileProperties",e.Ri="File_Rename",e.Wi="File_RenameFailed",e.Oi="UI_FileVersions",e.ki="StateChanged",e.Ni="App_IsFrameTrusted",e.Mi="GetAccessToken",e.Di="App_GetAuthToken",e.xi="App_GetCustomAuthConfig",e.Hi="App_GetHostKeyValue",e.Bi="App_WopiInfoFromUrl",e.Vi="App_DavUrlFromIds",e.Li="App_LoadingStatus",e.Ji="App_SwitchMode",e.Gi="App_MoveToFolder",e.$i="UI_OpenInMobileApp",e.zi="UI_OpenInBrowser",e.ji="UI_OpenInClient",e.qi="PageChanged",e.Ki="App_PushCommentContext",e.Zi="App_PushState",e.Xi="App_DocReboot",e.Qi="UI_RedeemForCommenting",e.Yi="App_RefreshSessionInfo",e.eo="UI_ReplyWithChanges",e.to="UI_ReportAbuse",e.io="App_FilePicker",e.oo="UI_SaveStatus",e.so="WopiSession_Complete_Ack",e.no="SetOverlayContent",e.ro="UI_Sharing",e.ao="UI_ShareForm",e.co="UI_SignIn",e.do="App_StoreHostKeyValue",e.lo="App_Unloaded",e.ho="App_UlsLog",e.uo="Wac_UnloadingApp",e.po="App_UpdateBootComplete",e.fo="PageCount",e.mo="UI_CheckUserAccessAndGrantPermissions",e.wo="User_Activity",e.vo="Edit_Notification",e.So="UI_Workflow",e.Io="ZoomChanged",e._o="CAAEMessage",e.bo="Excel_HostFrameCacheSave",e.To="Excel_HostFrameCacheEvict",e.Co="Excel_RegenerateFileBundle",e.Po="App_SwitchToWacFrame",e.yo="App_SaveSSRData",e.Ao="App_PurgeDataInHostCache",e.Uo="App_SaveHostRenderingV2Data",e.Eo="App_SaveHostUtilsData",e.Fo="AcquireOAuthTokenTeams",e.Ro="App_SwitchNotebook",e.Wo="FailedBoot_CheckFileInfo",e.Oo="GetTeamsUsers",e.ko="SendTeamsUserMention",e.No="NavigateBackToHost",e.Mo="App_GetClientUrlComplete",e.Do="App_GetWebUrlComplete",e.xo="App_CopyLinkComplete",e.Ho="App_SendConversationId",e.Bo="CloseTeamsConversation",e.Vo="PageLoaded",e.Lo="Visio_BRS",e.Jo="Visio_SendLicenseInfo",e.Go="Visio_Consumption_CLTComplete",e.$o="Visio_SwitchMode_FromViewFrame",e.zo="Visio_ModeSwitch_ToHost_Ack",e.jo="Visio_UpdateEditUrl",e.qo="Visio_PageViewLoaded",e.Ko="Visio_ActiveAppFrameLoadFailed",e.Zo="Visio_DisposeBkgFrame",e.Xo="Visio_ReadyToReceiveDocData",e.Qo="Visio_DocReboot_HostNav",e.Yo="Visio_SwitchToVisioFrame",e.es="WacAppPerfMetric",e.ts="App_ModifyURLState",e.os="App_WacTokenAck",e.ss="App_InitEnd",e.ns="App_SplashScreenShown",e.rs="App_SetWacFlightValue",e.as="App_PrintRedirect"}(j||(j={})),function(e){e.cs="Ack",e.ds="WacInitialize_Ready_Ack",e.ls="Wac_BeforeUnloadApp",e.hs="Blur_Focus",e.us="Wac_AppFailed_Ack",e.ps="Wac_AppCompleted_Ack",e.fs="WopiStartSession_Complete",e.ms="WopiPendingSession_Complete",e.ws="Host_AccessibilityLoopComplete",e.Ni="Host_IsFrameTrusted",e.gs="Grab_Focus",e.vs="HostCacheDiagnostic",e.Ss="Host_KeyValue",e.Is="JsApiDiagnostics",e.Gi="Host_MoveToFolder",e._s="PageChanged_Ack",e.bs="App_PopState",e.Ts="Host_SendChannelId",e.Cs="Host_SendConversationId",e.Ps="GetTeamsUsers_Reply",e.ys="SendTeamsUserMention_Reply",e.As="Host_BackButtonPressed",e.Us="Host_GetClientUrl",e.Es="Host_GetWebUrl",e.Fs="File_Rename",e.io="Host_FilePicker",e.Rs="PostAccessToken",e.Ws="Host_SetAuthToken",e.Os="Host_SetCustomAuthConfig",e.ks="App_PushCommentContext",e.Ns="CanEmbed",e.Ms="Host_RefreshSessionInfo",e.Ds="CheckUserAccessAndGrantPermissions_Result",e.xs="Host_WopiInfoFromUrl",e.Hs="Host_DavUrlFromIds",e.Bs="SetCurrentPage",e.Vs="SetZoomLevel",e.Ls="WopiPendingSession_Fail",e.Js="SetOverlayContent",e.Gs="WopiPendingApplicationComplete_Received",e.$s="Host_SwitchMode",e.zs="Host_Unload",e.js="PageCount_Ack",e.qs="ZoomChanged_Ack",e.Ks="Host_ShareUI",e.Zs="Host_Telemetry",e.Xs="Visio_ConsumptionCLTComplete_Ack",e.Qs="Visio_SwitchMode_FromHF_Ack",e.Ys="Visio_SwitchMode_FromHostFrame",e.en="Visio_FallbackToLegacySwitch",e.tn="Visio_DocumentData",e.in="Host_PostWacToken"}(q||(q={})),function(e){e.AccessibilityLoopCompleted="AccessibilityLoopCompleted",e.ActionCompleted="ActionCompleted",e.BrowserEvent="BrowserEvent",e.CAAEMessage="CAAEMessage",e.Close="Close",e.InitEnd="InitEnd",e.Conversation="Conversation",e.CopyAndEdit="CopyAndEdit",e.CreateNewDocument="CreateNewDocument",e.Download="Download",e.Edit="Edit",e.Error="Error",e.FileEmbed="FileEmbed",e.FileProperties="FileProperties",e.FileRenamed="FileRenamed",e.FileVersions="FileVersions",e.FrameStateChanged="FrameStateChanged",e.FrameTrust="FrameTrust",e.GetAccessToken="GetAccessToken",e.GetAuthToken="GetAuthToken",e.GetCustomAuthConfig="GetCustomAuthConfig",e.GetWopiInfoFromUrl="GetWopiInfoFromUrl",e.GetDavUrlFromIds="GetDavUrlFromIds",e.ModeSwitched="ModeSwitched",e.MoveToFolder="MoveToFolder",e.OpenInMobileApp="OpenInMobileApp",e.OpenInBrowser="OpenInBrowser",e.OpenInClient="OpenInClient",e.PageChanged="PageChanged",e.PushState="PushState",e.Reboot="Reboot",e.RedeemForCommenting="RedeemForCommenting",e.RefreshSessionInfo="RefreshSessionInfo",e.ReplyWithChanges="ReplyWithChanges",e.ReportAbuse="ReportAbuse",e.SharedFilePicker="SharedFilePicker",e.SaveStatus="SaveStatus",e.Share="Share",e.ShareForm="ShareForm",e.SignIn="SignIn",e.SplashScreenShown="SplashScreenShown",e.UserAccessAndPermissions="UserAccessAndPermissions",e.UserActivity="UserActivity",e.UserEditActivity="UserEditActivity",e.Workflow="Workflow",e.ZoomChanged="ZoomChanged",e.AcquireOAuthTokenTeams="AcquireOAuthTokenTeams",e.LoadingStatus="LoadingStatus",e.SwitchNotebook="SwitchNotebook",e.FailedBootCheckFileInfo="FailedBootCheckFileInfo",e.GetTeamsUsers="GetTeamsUsers",e.SendTeamsUserMention="SendTeamsUserMention",e.NavigateBackToHost="NavigateBackToHost",e.GetClientUrlComplete="GetClientUrlComplete",e.GetWebUrlComplete="GetWebUrlComplete",e.CopyLinkComplete="CopyLinkComplete",e.SendConversationId="SendConversationId",e.CloseTeamsConversation="CloseTeamsConversation",e.PageLoaded="PageLoaded",e.FrameChanged="FrameChanged",e.PrintRedirect="PrintRedirect"}(K||(K={}));const se={[z.boot]:{on:$.boot},[z.createNew]:{on:$.createNew},[z.dispose]:{on:$.dispose},[z.postWacToken]:{on:$.postWacToken},[z.rename]:{on:$.rename},[z.switchMode]:{on:$.switchMode},[j.gi]:{on:$.handleBootState},[j._i]:{on:$.closeTab},[j.Ni]:{on:$.frameTrust},[j.Di]:{on:$.getAuthToken},[j.Hi]:{on:$.getHostKeyValue},[j.Xi]:{on:$.appReboot},[j.rs]:{on:$.setWacFlightValue},[j.no]:{on:$.setOverlayContent},[j.do]:{on:$.storeHostKeyValue},[j.po]:{on:$.updateBootComplete},[z.blurFocus]:{sn:q.hs},[z.continueAccessibilityLoop]:{sn:q.ws},[z.grabFocus]:{sn:q.gs},[z.moveToFolder]:{sn:q.Gi},[z.popState]:{sn:q.bs},[z.sendChannelId]:{sn:q.Ts},[z.sendConvId]:{sn:q.Cs},[z.teamsUsersReply]:{sn:q.Ps},[z.teamsUserMentionReply]:{sn:q.ys},[z.backButtonPressed]:{sn:q.As},[z.getClientUrl]:{sn:q.Us},[z.getWebUrl]:{sn:q.Es},[z.sendAccessToken]:{sn:q.Rs},[z.sendAuthToken]:{sn:q.Ws},[z.sendHWRTelemetry]:{sn:q.Zs},[z.sendCustomAuthConfig]:{sn:q.Os},[z.sendDavUrl]:{sn:q.Hs},[z.sendEmbeddedViewUrl]:{sn:q.Ns},[z.sendFrameTrustResult]:{sn:q.Ni},[z.sendSessionInfo]:{sn:q.Ms},[z.sendUserAccessAndPermissions]:{sn:q.Ds},[z.sendWopiInfo]:{sn:q.xs},[z.signalShared]:{sn:q.Ks},[z.completeSharedFilePicker]:{sn:q.io},[j.pi]:{nn:K.AccessibilityLoopCompleted},[j.fi]:{nn:K.ActionCompleted},[j.Si]:{nn:K.BrowserEvent},[j._o]:{nn:K.CAAEMessage},[j.Ii]:{nn:K.Close},[j.bi]:{nn:K.Conversation},[j.Ti]:{nn:K.CopyAndEdit},[j.Ci]:{nn:K.CreateNewDocument},[j.yi]:{nn:K.Download},[j.Ai]:{nn:K.Edit},[j.Ui]:{nn:K.Error},[j.Ei]:{nn:K.FileEmbed},[j.Fi]:{nn:K.FileProperties},[j.Ri]:{nn:K.FileRenamed},[j.Oi]:{nn:K.FileVersions},[j.Mi]:{nn:K.GetAccessToken},[j.Vi]:{nn:K.GetDavUrlFromIds},[j.xi]:{nn:K.GetCustomAuthConfig},[j.Bi]:{nn:K.GetWopiInfoFromUrl},[j.ki]:{nn:K.FrameStateChanged},[j.Ji]:{nn:K.ModeSwitched},[j.Gi]:{nn:K.MoveToFolder},[j.$i]:{nn:K.OpenInMobileApp},[j.zi]:{nn:K.OpenInBrowser},[j.ji]:{nn:K.OpenInClient},[j.qi]:{nn:K.PageChanged},[j.Zi]:{nn:K.PushState},[j.Qi]:{nn:K.RedeemForCommenting},[j.Yi]:{nn:K.RefreshSessionInfo},[j.eo]:{nn:K.ReplyWithChanges},[j.io]:{nn:K.SharedFilePicker},[j.to]:{nn:K.ReportAbuse},[j.oo]:{nn:K.SaveStatus},[j.ro]:{nn:K.Share},[j.ao]:{nn:K.ShareForm},[j.co]:{nn:K.SignIn},[j.mo]:{nn:K.UserAccessAndPermissions},[j.wo]:{nn:K.UserActivity},[j.vo]:{nn:K.UserEditActivity},[j.So]:{nn:K.Workflow},[j.Io]:{nn:K.ZoomChanged},[j.Fo]:{nn:K.AcquireOAuthTokenTeams},[j.Li]:{nn:K.LoadingStatus},[j.Ro]:{nn:K.SwitchNotebook},[j.Wo]:{nn:K.FailedBootCheckFileInfo},[j.Oo]:{nn:K.GetTeamsUsers},[j.ko]:{nn:K.SendTeamsUserMention},[j.No]:{nn:K.NavigateBackToHost},[j.Mo]:{nn:K.GetClientUrlComplete},[j.Do]:{nn:K.GetWebUrlComplete},[j.xo]:{nn:K.CopyLinkComplete},[j.Ho]:{nn:K.SendConversationId},[j.Bo]:{nn:K.CloseTeamsConversation},[j.Vo]:{nn:K.PageLoaded},[j.ss]:{nn:K.InitEnd},[j.ns]:{nn:K.SplashScreenShown},[j.as]:{nn:K.PrintRedirect}};function ne(){const e=new Uint8Array(31),t=function(e){const t={crypto:!1,perfNow:!1,exceptions:[]},i=window.crypto||window.msCrypto;if(i){t.crypto=!0;try{return i.getRandomValues(e),t}catch(e){t.exceptions.push("crypto: "+Y(e))}}t.perfNow=!0;for(let i=0;i<e.length;i+=1){try{let e=Math.floor(100*window.performance.now())%10;(e<0||e>9)&&(e=0);for(let t=0;t<e;t+=1)Math.random()}catch(e){t.exceptions.push("Math.random: "+Y(e))}e[i]=Math.floor(16*Math.random())}return t}(e);let i=0;return["xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const o=15&e[i];return i+=1,("x"===t?o:3&o|8).toString(16)}),t]}function re(){return"xxxxxxxx-xxxx-4xxx-xxxx-xxxxxxxxxxxx".replace(/[x]/g,ae)}function ae(){const e=new Uint8Array(1);return window.self.crypto&&window.self.crypto.getRandomValues?(window.self.crypto.getRandomValues(e),Math.floor(e[0]/16).toString(16)):window.msCrypto&&window.msCrypto.getRandomValues?(window.msCrypto.getRandomValues(e),Math.floor(e[0]/16).toString(16)):Math.floor(16*Math.random()).toString(16)}var ce;!function(e){e[e.Firefox=0]="Firefox",e[e.Opera=1]="Opera",e[e.IE=2]="IE",e[e.Edge=3]="Edge",e[e.Chrome=4]="Chrome",e[e.Safari=5]="Safari",e[e.TeamsElectron=6]="TeamsElectron",e[e.Unknown=7]="Unknown"}(ce||(ce={}));const de=window.navigator,le=de?de.userAgent:void 0;function he(){if(le){if(le.indexOf("Firefox")>-1)return ce.Firefox;if(le.indexOf("Opera")>-1||le.indexOf("OPR")>-1)return ce.Opera;if(le.indexOf("Trident")>-1)return ce.IE;if(le.indexOf("Electron")>-1&&le.indexOf("Teams")>-1)return ce.TeamsElectron;if(le.indexOf("Edg")>-1)return ce.Edge;if(le.indexOf("Chrome")>-1)return ce.Chrome;if(le.indexOf("Safari")>-1)return ce.Safari}return ce.Unknown}function ue(){try{return!!le&&le.indexOf("iPad")>=0||!!le&&le.indexOf("Macintosh")>=0&&ve()&&!me()||!!le&&le.indexOf("Android")>=0||ve()}catch{return!1}}function pe(){try{return window.matchMedia("screen and (-ms-high-contrast: active)").matches}catch{return!1}}function fe(){try{return window.external&&window.external.getHostEnvironmentValue&&'{"os-sku":"189"}'===window.external.getHostEnvironmentValue("os-sku")}catch(e){return!1}}function me(){return!!le&&le.indexOf("iPhone")>=0}function we(){return me()||/android.+mobile/i.test(de.userAgent)}function ge(){return window.devicePixelRatio||(window.screen?window.screen.deviceXDPI/window.screen.logicalXDPI:1)||1}function ve(){return!!de&&de.maxTouchPoints>0}function Se(e,t){t&&Object.keys(t).forEach(i=>{e[i]=t[i]})}function Ie(e,t){try{if(void 0===window.performance)return void t.ULS.Ye(595948609,E.B,F.Info,"Performance not supported");const i=window.performance.getEntriesByType("resource");if(void 0===i||i.length<=0)return void t.ULS.Ye(595948610,E.B,F.Info,"No resources under performance");const o=new RegExp(e+"(-boot\\.min|(\\.(app|preview))?\\.boot)(\\.[0-9a-f]{20})?\\.js","i");for(let e=i.length-1;e>=0;e-=1){const s=i[e],n=s.name.match(o);if(n){let e=JSON.stringify(s);return e=e.replace(new RegExp(s.name,"g"),n[0]),void t.ULS.Ye(595948616,E.B,F.Info,e)}}t.ULS.Ye(595948484,E.B,F.Info,"Could not find JSAPI resource timing entry")}catch(e){t.ULS.Ye(595948617,E.B,F.Info,"Could not trace the resource timing: "+Y(e))}}function _e(e){var t,i;const o={...e.host,sessionId:e.hostSessionId,domain:location?location.host:void 0};delete o.siteId,delete o.webId,delete o.uiHostTabId;const s={};if(e.wdParams){const t=JSON.parse(JSON.stringify(e.wdParams).toLowerCase());["wdorigin","wdpreviouscorrelation","wdprevioussession","wdtf"].forEach(e=>{t[e]&&(s[e]=t[e])});const i=/^\w{8}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{4}(-|%2d)\w{12}$/i;s.wdprevioussession&&!i.test(s.wdprevioussession)&&delete s.wdprevioussession,s.wdpreviouscorrelation&&!i.test(s.wdpreviouscorrelation)&&delete s.wdpreviouscorrelation}const n={...e.rebootOverride};delete n.ackExpected,delete n["ui-language"],delete n.wdUserSession,delete n.rebootMode,delete n.documentUrl;const r=e.wopi;return{accessToken:r?{length:r.accessToken.length,expiry:r.expiry}:"N/A",wacToken:r&&r.wacToken?{length:r.wacToken.length}:void 0,bootParams:e.bootParams,build:O(),host:o,intent:e.intent,jsApiVersion:"v2",rebootOverride:n,region:a(e.appBaseUrl),sessionOrigin:e.hostInitDiagnostics?e.hostInitDiagnostics.entryPoint:void 0,sessionContext:e.sessionContext,throttling:e.throttling,ui:e.ui,viewMode:e.viewMode,meeting:e.meeting?{id:null===(t=e.meeting)||void 0===t?void 0:t.id,isPresenter:null===(i=e.meeting)||void 0===i?void 0:i.isPresenter}:void 0,wdParams:s}}function be(){const e={perfNowSupported:!0,browser:ce[he()],touchMode:ue(),highContrast:pe(),windows10x:fe()};try{const t=window.navigator,i=t.connection||t.mozConnection||t.webkitConnection;i&&(e.netDownlink=i.downlink,e.netDownlinkMax=i.downlinkMax,e.netEffectiveType=i.effectiveType,e.netRtt=i.rtt,e.netSaveData=i.saveData,e.netType=i.type),e.deviceMemory=t.deviceMemory,e.logicalProcessors=t.hardwareConcurrency}catch{}return e}function Te(e){try{const t=e.hostInitDiagnostics;e.logger.ULS.Ye(558155803,E.B,F.Info,"HostInitDiagnostics: "+(t?JSON.stringify(t):"N/A")),e.logger.ULS.Ye(596444237,E.B,F.Info,JSON.stringify({session:_e(e),client:e.clientDiagnostics}))}catch(t){e.logger.ULS.Ye(558155804,E.B,F.Error,"Failed to log init info: "+Y(t))}}function Ce(){try{return localStorage.setItem("Test","Test"),localStorage.removeItem("Test"),!0}catch{return!1}}function Pe(e,t){try{const i=parseInt(e,10);if(!i)return;if(i<=H()-6e4)t.ULS.Ye(558155805,E.B,F.Warning,"Bad userClickTime or host took 60+s to kick off the session from click");else if(Ce()){const e=i.toString(),o=localStorage.getItem("lastUserClickTime");if(o){const s=parseInt(o,10);s&&i<=s?t.ULS.Ye(558155806,E.B,F.Warning,"Bad userClickTime: less than or equal to lastUserClickTime, delta: "+(s-i)):localStorage.setItem("lastUserClickTime",e)}else localStorage.setItem("lastUserClickTime",e)}}catch(e){t.ULS.Ye(558155807,E.B,F.Error,"Error when tracking userClickTime: "+Y(e))}}var ye;function Ae(e){const t=window.performance.timing;t&&(e.hostPageNavigationStartTime||(e.hostPageNavigationStartTime=t.navigationStart),e.hostPageFetchStartTime||(e.hostPageFetchStartTime=t.fetchStart),e.hostPageRequestStartTime||(e.hostPageRequestStartTime=t.requestStart),e.hostPageResponseStartTime||(e.hostPageResponseStartTime=t.responseStart),e.hostPageResponseEndTime||(e.hostPageResponseEndTime=t.responseEnd),e.hostPageDomCompleteTime||(e.hostPageDomCompleteTime=t.domComplete));const i=window.performance.navigation;if(i&&(void 0===e.hostPageRedirectCount&&(e.hostPageRedirectCount=i.redirectCount),!e.hostPageNavigationType)){let t="UNKNOWN";switch(i.type){case 0:t="NAVIGATE";break;case 1:t="RELOAD";break;case 2:t="BACK_FORWARD";break;case 255:t="RESERVED"}e.hostPageNavigationType=t}}!function(e){e[e.Unknown=0]="Unknown",e[e.Normal=1]="Normal",e[e.Minor=2]="Minor",e[e.Medium=3]="Medium",e[e.Major=4]="Major",e[e.Critical=5]="Critical"}(ye||(ye={}));class Ue{dispose(){window.removeEventListener("beforeunload",this.rn,{capture:!0}),window.removeEventListener("pagehide",this.an,{capture:!0}),window.removeEventListener("visibilitychange",this.cn,{capture:!0}),window.removeEventListener("unload",this.dn,{capture:!0})}constructor(e,t){this.rn=()=>Ee(e,"OnBeforeUnload",t),this.an=()=>Ee(e,"OnPageHide",t),this.cn=()=>Ee(e,"VisibilityChange_"+document.visibilityState,t),this.dn=()=>Ee(e,"OnUnload",t),window.addEventListener("beforeunload",this.rn,{capture:!0,once:!0}),window.addEventListener("pagehide",this.an,{capture:!0}),window.addEventListener("visibilitychange",this.cn,{capture:!0}),window.addEventListener("unload",this.dn,{capture:!0,once:!0})}}function Ee(e,t,i){e.ULS.Ye(595957843,E.B,F.Info,`Page lifecycle: ${t} fired`+(i?", flushing logger":"")),i&&e.ULS.flush()}const Fe=["https://augloop.office.com/v2","api://visio.officeapps.live.com/va/00695ed2-3202-4156-8da1-69f60065e255","394866fc-eedb-4f01-8536-3ff84b16be2a","https://officescripting.microsoft.com","https://officescripting-int.microsoft.com","https://nleditor.osi.office.net/nleditor","e03a13ee-9730-4cae-8525-47559c8cf18a","https://powerquery.microsoft.com","api://app.powerbi.com/00000009-0000-0000-c000-000000000000"];class Re{async isResourceTrustedForMessage(e){if(!e||!e.Resource)return!1;const t=e.Resource,i=e.AddinTrustId,o=function(e){if(!e)return!1;const t=e.toLowerCase();for(const e of Fe)if(e===t||e+"/"===t)return!0;return!1}(t);if(o||!i)return o;if(this.ln[i])return We(t,this.ln[i]);let s;const n=new Promise(e=>{s=(o,s)=>{i===o&&e(We(t,s))},this.hn.push(s)});let r=-1;const a=new Promise(e=>{r=window.setTimeout(()=>{this.ci.ULS.Ye(560754786,E.B,F.Warning,"isResourceTrustedForMessage - timeout waiting for addinTrustId: "+i),e(!1)},2e3)}),c=await Promise.race([n,a]);return this.hn=this.hn.filter(e=>e!==s),window.clearTimeout(r),c}dispose(){this.ln={},this.hn=[],window.removeEventListener("message",this.un)}constructor(e){this.ln={},this.hn=[],this.un=e=>{if(e&&e.origin)try{const t=e.data;if("string"==typeof t&&t.includes("AddinTrustedOrigin")){const i=JSON.parse(t),o=i.AddinTrustId;o&&"AddinTrustedOrigin"===i.MessageId&&(this.ci.ULS.Ye(560754784,E.B,F.Info,"didReceiveMessage addinTrustId "+o),this.ln[o]=e.origin,this.hn.forEach(t=>{t(o,e.origin)}))}}catch(e){this.ci.ULS.Ye(560754785,E.B,F.Error,"AuthTokenTrustValidator didReceiveMessage failed")}},this.ci=e,window.addEventListener("message",this.un)}}function We(e,t){try{if(!e||!t)return!1;const i=33,o=126,s=/[?&#%\\]/;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<i||n>o)return!1;const r=e.charAt(t);if(s.test(r))return!1}const n="api:",r="https:";let a=e;a.substring(0,n.length).toLowerCase()===n&&(a=`${r}${a.substring(n.length)}`);const c=new URL(a);return c.protocol===r&&t.toLowerCase()===c.origin.toLowerCase()}catch{return!1}}class Oe{get diagnostics(){return{hostInitDiagnostics:this.hostInitDiagnostics,appInitDiagnostics:this.appInitDiagnostics}}raiseEvent(e,t){this.logger.ULS.Ye(574654541,E.B,F.Info,"Raising event: "+e);try{this.pn(e,t)}catch(e){this.logger.ULS.Ye(593506838,E.B,F.Error,"Event handler error: "+Y(e))}}addActionHandler(e,t){this.fn[e]||(this.fn[e]=[]),this.fn[e].push(t)}removeActionHandler(e,t){const i=this.fn[e];if(i&&i.length>0){const e=i.indexOf(t);e>-1&&i.splice(e,1)}}run(e,t,i){if(this.state===U.Disposed&&this.backgroundSession)return this.logger.ULS.Ye(525203609,E.B,F.Info,"Redirecting to background session: "+e),this.backgroundSession.run(e,t,i);const o=[],s=this.fn[e];if(s&&s.length>0)o.push(this.mn(e,t));else{const s=se[e];if(s){const n=s.on,r=s.sn;if(n){this.logger.ULS.Ye(574654542,E.B,F.Info,"Running flow: "+n);const s=this.wn[n](e,t,this,this.gn[n],i).catch(e=>(this.vn(n,e),{completion:"failure",errorSource:"jsapi",error:e}));o.push(s)}else r&&(this.container&&this.container.postMessage(r,t),o.push(Promise.resolve({completion:"success"})))}else o.push(Promise.resolve({completion:"failure"})),this.logger.ULS.Ye(593500189,E.B,F.Warning,"Unhandled command: "+e)}return Promise.race(o)}dispose(){if(this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.et.dispose(),this.pageStateObserver.dispose(),this.authTokenTrustValidator.dispose(),this.fn={},!this.pendingReboot){const e=this.application.sessions,t=e.indexOf(this.session);t>-1&&e.splice(t,1)}}constructor(e,t,i,o,s,n,r){var a;this.successTime=0,this.failureTime=0,this.timeoutTime=0,this.pendingReboot=!1,this.skipWopiValidation=!1,this.skipFileNameCheck=!1,this.appContext={},this.isLoggerFromOwl=!1,this.appUrl="",this.appBaseUrl="",this.appBasePath="",this.remoteTelemetryUrl="",this.fn={},this.onMessage=e=>{const t=e.MessageId,i=e.Values||{},o=this.fn[t];if(o&&o.length>0)this.mn(t,i);else{const o=se[t];if(o){const s=o.on,n=o.nn;s?(this.logger.ULS.Ye(574654543,E.B,F.Info,"Running flow: "+s),this.wn[s](t,i,this,this.gn[s]).catch(e=>{this.vn(s,e)})):n&&(n===K.Share&&(i.sendTimeAsClickTime=e.SendTime),this.raiseEvent(n,i))}}},this.vn=(e,t)=>{this.logger.ULS.Ye(596459925,E.B,F.Error,`${e} flow error: ${Y(t)}`),this.remoteTelemetryUrl&&D(this.remoteTelemetryUrl,this.appInfo.name,"flowException")},this.mn=(e,t)=>{this.logger.ULS.Ye(574654544,E.B,F.Info,"Dispatching action: "+e);const i=this.fn[e].slice().reverse();for(let o=i.length-1;o>-1;o-=1)try{i[o](e,t)}catch(t){this.logger.ULS.Ye(596444186,E.B,F.Error,`${e} action handler error: ${Y(t)}`)}return Promise.resolve({completion:"success"})},this.state=U.Unknown;const[c,d]=ne();this.isLoggerFromOwl=!!i.logger,this.logger=null!==(a=i.logger)&&void 0!==a?a:Z(),this.logger.ULS.Ye(593506837,E.B,F.Info,JSON.stringify(d)),this.sessionId=c,this.hostSessionId=i.hostSessionId,this.host=e.host,this.hostName=this.host.uiHostName||this.host.storageHostName,this.user=e.user,this.bootstrapperUrl=e.bootstrapperUrl,this.ui=e.ui||{},this.viewMode=e.viewMode,this.application=o,this.appInfo=t,this.session=s,this.featureManager=ee(e.host.capabilities&&e.host.capabilities.isFeatureEnabledCallback,this.logger),this.et=new oe(t.name,this.logger),this.preloader=t.preloader,[this.wn,this.gn]=n(this.featureManager),this.pn=r,this.clientDiagnostics=be(),this.pageStateObserver=new Ue(this.logger,!0),this.authTokenTrustValidator=new Re(this.logger)}}class ke{get id(){return this.Sn.sessionId}get diagnostics(){return this.Sn.diagnostics}run(e,t,i){return this.Sn.run(e,t,i)}boot(e,t){return this.Sn.run(z.boot,e,t)}dispose(e){return this.Sn.run(z.dispose,void 0,e)}constructor(e,t,i,o,s,n){!function(e){if(!e)throw new TypeError("SessionInitParams");if(!e.hostSessionId)throw new TypeError("HostSessionId")}(i),this.Sn=new Oe(e,t,i,o,this,n,(e,t)=>s({type:e,data:t,session:this})),this.Sn.state=U.Initialized}}function Ne(e){if(!e)return"";const t=""+document.cookie,i=new RegExp("(?:^|; )"+e+"=([^;]*)"),o=t.match(i);return!o||o.length<2?"":o[1]}function Me(e,t,i,o=De.none,s){const n=e+"="+t;let r="";const a=new Date;a.setTime(a.getTime()+31536e6);let c=new Date;c.setTime(c.getTime()+864e5*i),c>a&&(c=a),c&&(r=";expires="+c.toUTCString());const d=n+r+";SameSite="+De[o];return document.cookie=s?d+"; Secure":d,!(!document.cookie||-1===document.cookie.indexOf(n))||o===De.none&&Me(e,t,i,De.doNotSet,s)}var De,xe;!function(e){e[e.doNotSet=0]="doNotSet",e[e.none=1]="none",e[e.lax=2]="lax",e[e.strict=3]="strict"}(De||(De={}));class He{setTargetOrigin(e){const t=d(e).toLowerCase();this.In&&this.In!==t&&this.ci.ULS.Ye(593232847,E.B,F.Warning,`Updating origin: [${P(this.In)}]->[${P(t)}]`),this.In=t,this._n=l(t,2),this.bn=n(t),this.Tn=r(t)}setTargetFrame(e,t){this.Cn=e,this.Pn=!!t}setMessageHandler(e){this.yn=e}removeMessageHandler(){this.yn=void 0}postMessage(e,t,i){if(!this.Cn||!this.Cn.contentWindow)return void this.ci.ULS.Ye(593232848,E.B,F.Error,"Missing target to send message: "+e);this.ci.ULS.Ye(593232849,E.B,F.Info,"Sending message: "+e);const o={MessageId:e,SendTime:H(),CorrelationId:i,Values:t};this.Cn.contentWindow.postMessage(JSON.stringify(o),this.In)}dispose(){window.removeEventListener("message",this.An,!1),this.yn=void 0}constructor(e,t,i,o){var s;this.In="",this._n="",this.bn=!1,this.Tn=!1,this.Pn=!1,this.Un=!1,this.An=e=>{let t,i=!1,o=!0,s="",n=!1;if(this.Cn&&this.Cn.contentWindow&&(i=!0,o=e.source===this.Cn.contentWindow),e.origin&&(s=l(e.origin,2).toLowerCase(),n=s===this._n,!n&&this.En&&(s=l(e.origin).toLowerCase(),n=this.En.includes(s))),!this.bn&&(!this.Tn||n&&o)||this.ci.ULS.Ye(593232850,E.B,F.Info,"Window: available["+i+"] valid["+o+"]; Origin: valid["+n+"] expected["+this._n+"] actual["+s+"]"),!n||this.Pn&&!o)return;try{t=JSON.parse(e.data)}catch(e){return void this.ci.ULS.Ye(593232851,E.B,F.Info,"Failed to parse event data: "+Y(e))}const r=t.MessageId;if(r){var a;if(this.ci.ULS.Ye(593232854,E.B,F.Info,`Received message: ${r}, correlation: ${t.CorrelationId}`),r!==j.vi&&r!==j.Li||this.setTargetOrigin(e.origin),t.Values&&t.Values.ackExpected&&this.postMessage(q.cs,void 0,t.CorrelationId),this.Un&&r===j.es)return window._pageTimings=null!==(a=window._pageTimings)&&void 0!==a?a:{},void(window._pageTimings[t.Values.name]=t.Values.time);if(this.yn)try{this.yn(t)}catch(e){this.ci.ULS.Ye(594556386,E.B,F.Error,"Message handler error: "+Y(e))}else this.ci.ULS.Ye(591933923,E.B,F.Error,"No message handler")}else(this.bn||this.Tn)&&this.ci.ULS.Ye(593232853,E.B,F.Info,"Missing message id")},this.ci=t,this.setTargetOrigin(e),this.En=o,i&&this.setMessageHandler(i),this.Un=!(null===(s=window.location)||void 0===s||null===(s=s.search)||void 0===s||!s.match(/wdpa=1/gi))||"1"===Ne("EnableMetricLogging"),window.addEventListener("message",this.An,!1)}}function Be(e,t){he()===ce.Safari?e.style.display=t?"none":"block":e.style.visibility=t?"hidden":"visible"}function Ve(e){try{return window===window.top||window.parent===window.top&&window.location.origin===window.top.origin}catch(t){return e&&e.ULS.Ye(591525084,E.B,F.Info,"Trust check error: "+Y(t)),!1}}function Le(e){return!(!e||!e.parentNode)&&(e.id?!!document.getElementById(e.id):void 0!==e.isConnected?e.isConnected:document.body.contains(e))}!function(e){e.Fn="access_token",e.Rn="access_token_ttl",e.Wn="wac_token",e.On="bundleSrc",e.kn="bundleStaleness",e.Nn="DocID",e.Mn="SiteID",e.Dn="WebID",e.xn="ETag",e.Hn="feature_status",e.Bn="fileExtension",e.Vn="fileGetUrl",e.Ln="customFontCatalogUrl",e.Jn="fileName",e.Gn="fileSize",e.$n="forceSLR",e.zn="frameHeightPx",e.jn="frameWidthtPx",e.qn="highContrast",e.Kn="highDpi",e.Zn="host_diagnostics",e.Xn="hostName",e.Qn="huictrls",e.Yn="owner_id",e.er="sc",e.tr="softBlockedBrowser",e.ir="templateUrl",e.or="touchMode",e.sr="user_id",e.nr="hfck",e.rr="hfcv",e.ar="timeZoneId",e.cr="darkCssMedia",e.dr="caae",e.lr="meetingId",e.hr="meetingTitle",e.ur="meetingType",e.pr="scheduledStartTime",e.mr="scheduledEndTime",e.wr="isPresenter",e.gr="meetingOrganizerId",e.vr="meetingJoinUrl",e.Sr="isMeetingTeamsRoom",e.Ir="jsapibuild",e._r="owlver",e.br="owlro",e.Tr="caaemode",e.Cr="traceparent",e.Pr="tracestate",e.yr="supports_zipit"}(xe||(xe={}));class Je{get element(){return this.Ar}get frameId(){return this.Ur}get formId(){return this.Er}get isTopFrameTrusted(){return this.Fr}boot(e,t,i,o){this.ci=i,this.Rr=new He(e,i,this.yn,o.additionalReceivingDomainList);const s=o.useAdditionalDiv,n=o.permissionsPolicy;this.Wr&&!s?(this.Wr.setAttribute("allow",n),this.ci.ULS.Ye(588793045,E.B,F.Info,"Wac frame reused")):(this.Wr=function(e,t,i,o,s,n,r,a){e.style.top="0",e.style.bottom="0",e.style.left="0",e.style.right="0",e.style.height="100%",e.style.width="100%";const c=e.ownerDocument,d=c.createElement("iframe");if(d.id=t,d.name=t,d.src="",d.title="Office on the web Frame",d.marginWidth="0",d.marginHeight="0",d.style.top="0",d.style.bottom="0",d.style.left="0",d.style.right="0",d.style.height="100%",d.style.width="100%",d.style.display="block",d.style.position="absolute",d.style.backgroundColor="transparent",d.style.border="none",d.frameBorder="0",d.setAttribute("allowfullscreen","true"),d.setAttribute("allowTransparency","true"),d.setAttribute("allow",i),Be(d,r),o&&(e.style.minHeight=o,d.style.minHeight=o),s&&(e.style.minWidth=s,d.style.minWidth=s),a&&d.setAttribute("role","none"),n){const t=c.createElement("div");t.style.top="0",t.style.bottom="0",t.style.left="0",t.style.right="0",t.style.height="100%",t.style.width="100%",t.style.backgroundColor="#393a3d",t.style.backfaceVisibility="hidden",o&&(t.style.minHeight=o),s&&(t.style.minWidth=s),t.appendChild(d),e.appendChild(t)}else e.appendChild(d);return d}(this.Ar,this.Ur,n,o.minHeight,o.minWidth,s,o.isInvisible,o.setNoneRole),this.ci.ULS.Ye(588793046,E.B,F.Info,"Wac frame created")),this.Rr.setTargetFrame(this.Wr,o.enforceSameWindow),s&&(this.Or=this.Wr.parentElement),o.useFrameFixForTeams&&i.ULS.Ye(509143245,E.B,F.Info,"Frame fix enabled for teams uiHost"),function(e,t,i){u(t,xe.zn,String(i?window.outerHeight:e.offsetHeight)),u(t,xe.jn,String(i?window.outerWidth:e.offsetWidth)),u(t,xe.or,String(ue())),u(t,xe.qn,String(pe())),u(t,xe.$n,String(fe())),u(t,xe.cr,String(function(){try{return window.matchMedia("(prefers-color-scheme: dark)").matches}catch{return!1}}()))}(this.Wr,t,o.useFrameFixForTeams),this.kr=function(e,t,i,o,s){const n=e.ownerDocument,r=n.createElement("form");r.id=i,r.name=i,r.action=o,r.target=t,r.method="POST";for(const e in s){const t=n.createElement("input");t.type="hidden",t.name=e,t.value=s[e],r.appendChild(t)}return e.appendChild(r),r}(this.Ar,this.Ur,this.Er,e,t);try{this.kr.submit()}catch(e){this.ci.ULS.Ye(507909977,E.B,F.Warning,"WAC frame failed to submit, will retry. Error: "+Y(e)),new Promise(e=>{window.setTimeout(e,10)}).then(()=>{this.kr.submit()}).catch(e=>{throw this.ci.ULS.Ye(507909976,E.B,F.Error,"WAC frame failed to submit on retry. Error: "+Y(e)),e})}}setVisibility(e){this.Wr&&Be(this.Wr,e)}setMessageHandler(e){this.yn=e,this.Rr&&this.Rr.setMessageHandler(e)}setWrapperPostMessage(e){this.Nr=e}removeMessageHandler(){this.yn=void 0,this.Rr&&this.Rr.removeMessageHandler()}postMessage(e,t){this.Nr?this.Nr(e,t):this.Rr&&this.Rr.postMessage(e,t)}dispose(e,t){return new Promise(i=>{if(this.kr&&(this.Ar.removeChild(this.kr),this.kr=void 0),this.Rr&&(this.Rr.dispose(),this.Rr=void 0,this.yn=void 0),this.Nr&&(this.Nr=void 0),this.ci=void 0,!this.Wr||!this.Or&&e)i();else{const e=()=>{this.Or?(this.Or.removeChild(this.Wr),this.Ar.removeChild(this.Or)):this.Ar.removeChild(this.Wr),this.Wr=void 0,this.Or=void 0,i()};t?e():(this.Wr.src="about:blank",window.setTimeout(e,0))}})}constructor(e,t){!function(e){if(!e||!e.appendChild)throw TypeError("Container")}(e),this.Ar=e,this.Ur=t,this.Er=t+"_Form",this.Fr=Ve()}}class Ge{get name(){return this.Mr.name}get version(){return O()}addEventListener(e){this.Dr.add(e)}removeEventListener(e){this.Dr.remove(e)}createContainer(e){const t=`WacFrame_${this.Mr.name}_${this.containers.length}`,i=new Je(e,t);return this.containers.push(i),i}createSession(e){const t=new ke(this.xr,this.Mr,e,this,this.Hr,this.Br);return this.sessions.push(t),t}dispose(e){const t=this.sessions.map(t=>t.dispose(e).catch(e=>{}));return Promise.all(t).then(e=>(this.Dr.removeAll(),this.sessions=[],this.containers=[],{completion:"success"}))}constructor(e,t,i){this.sessions=[],this.containers=[],this.Hr=e=>{this.Dr.dispatch(e)},function(e){if(!e)throw new TypeError("ApplicationInitParams");const t=e.host;if(!t||!t.storageHostName)throw new TypeError("HostInfo");const i=e.user;if(!i||null==i.id)throw new TypeError("UserInfo")}(e),this.xr=e,this.Mr=t,this.Br=i,this.Dr=new ie,function(e){if(e&&(W.BUILD_NUMBER=e,e.includes("."))){const t=e.split(".");W.BUILD_NUMBER_MINOR=parseInt((t[0]||"").concat((t[1]||"").padStart(3,"0")),10)}}(e.host.owlVersion)}}const $e=(e,t,i)=>new Promise(t=>{i.logger.ULS.Ye(590111070,E.B,F.Error,"Unsupported flow: "+e),t({completion:"failure"})});function ze(e){return!(!(e&&e.source&&e.accessToken)||!e.expiry&&0!==e.expiry)}function je(e){return function(e,t){const i={};return t&&Object.keys(t).forEach(e=>{i[e.toLowerCase()]=t[e]}),e.split("&").forEach(e=>{if(/^wd\w+=.+/i.test(e)){const t=e.split("=");i[t[0].toLowerCase()]=t[1]}}),i}(window.location.search.substring(1),e)}function qe(e){const t={};u(t,"jsapi","1"),u(t,"jsapiver","v2"),u(t,"corrid",e.sessionId),u(t,"usid",e.sessionId),u(t,"newsession","1"),u(t,"sftc","1"),e.hostSessionId&&u(t,"hid",encodeURIComponent(e.hostSessionId));const i=e.host;i.uiHostName&&u(t,"uih",i.uiHostName),i.uiHostIntegrationType&&u(t,"uihit",encodeURIComponent(i.uiHostIntegrationType)),i.metaUiHostVersion&&u(t,"muv",encodeURIComponent(i.metaUiHostVersion));const o=i.capabilities;o&&(o.accessibilityLoop&&u(t,"accloop","1"),o.rebootDoc&&u(t,"sdr",o.rebootDoc.toString()),o.createNewDoc&&u(t,"scnd","1"),o.authToken&&u(t,"sat","1"),o.customAuthConfig&&u(t,"cac","1"),o.refreshAccessToken&&u(t,"rat","1"),o.atMentions&&u(t,"sams","1"),o.moveToFolder&&u(t,"mtf","1"),o.noBrowserModalDialogs&&u(t,"nbmd","1"),o.commonFilePicker&&u(t,"sfp","1"),o.directDownload&&u(t,"sdd","1"),o.directPrint&&u(t,"sdp","1"),o.disableOfficeAddins&&u(t,"doa","1"));const s=e.ui;s.language&&u(t,"ui",encodeURIComponent(s.language)),s.uiEmbed&&u(t,"uiembed","1"),(s.hideHeader||"DocGen"===s.contentAssemblyMode||"Templatization"===s.contentAssemblyMode||"ContentAssemblyEdit"===s.contentAssemblyMode||"ContentAssemblyView"===s.contentAssemblyMode)&&u(t,"hhdr","1"),s.highContrast&&u(t,"hcm",encodeURIComponent(s.highContrast)),s.hideFileLocationPicker&&u(t,"hodflp","1"),s.hideAppLauncherInHeader&&u(t,"halh","1"),s.hideChatInHeader&&u(t,"hch","1"),s.hideMeInHeader&&u(t,"hmh","1"),s.hideSearchInHeader&&u(t,"hsh","1"),s.hideWorkflowInHeader&&u(t,"hwfh","1"),s.hideSettingsInHeader&&u(t,"hsth","1"),s.showAppIconInHeader&&u(t,"sih","1"),s.useNeutralColorInHeader&&u(t,"unh","1"),s.openLinksInNewWindow&&u(t,"onw","1"),s.useDarkTheme&&u(t,"udt","1"),"DocGen"!==s.contentAssemblyMode&&"ContentAssemblyView"!==s.contentAssemblyMode||u(t,"readOnly","1");const n=e.wopi;n&&n.source&&u(t,"wopisrc",encodeURIComponent(n.source));const r=e.bootParams;r&&(r.dataLanguage&&u(t,"rs",encodeURIComponent(r.dataLanguage)),r.readOnly&&u(t,"readonly","1"),r.disableChat&&u(t,"dchat","1"),r.cookieCompliant&&u(t,"mscc","1"),r.isNewFile&&(u(t,"new","1"),r.isFromHostTemplate&&u(t,"wdtpl","fromhost"))),e.user.isLicensed&&u(t,"islicenseduser","1"),e.user.isSynthetic&&u(t,"syn","1"),e.actNavId&&u(t,"actnavid",e.actNavId),e.sessionContext&&u(t,"sc",encodeURIComponent(e.sessionContext));const a=e.wdParams;if(a)for(const e in a)u(t,e,a[e]);const c=e.preseededSession;c&&(c.key&&u(t,"preseededsessionkey",encodeURIComponent(c.key)),c.id&&u(t,"preseededwacsessionid",encodeURIComponent(c.id)));const d=e.throttling;d&&(d.protection&&u(t,"ctp",d.protection),d.request&&u(t,"rct",d.request));const l=e.hostInitDiagnostics;l&&(l.entryPoint&&u(t,"wdorigin",encodeURI(l.entryPoint)),l.userClickTime&&u(t,"wdhostclicktime",l.userClickTime.toString()));const h=e.rebootOverride;return h&&h.previousSessionId&&u(t,"wdprevioussession",h.previousSessionId),p(t,"region"),t}function Ke(e,t,i){let o={...w(e.appUrl),...qe(e),...i};const s=e.rebootOverride;return s&&s.queryOverrides&&(o={...o,...s.queryOverrides}),function(e,t,i){const o=[];for(const e in i)i[e]&&o.push(e+"="+i[e]);return e+t+(o.length>0?"?"+o.join("&"):"")}(e.appBasePath,t,o)}function Ze(e,t){const i=function(e){const t={};u(t,"highdpi",String(window.devicePixelRatio>1.24)),u(t,"softblockedbrowser",String(he()===ce.IE&&!(he()===ce.IE&&null!=document.documentMode&&void 0!==document.documentMode&&document.documentMode>=11))),u(t,"hostname",e.hostName),u(t,"feature_status",te(e.featureManager,e.wdParams)),u(t,"jsapibuild",O());const i=e.wopi;i&&(u(t,"access_token",i.accessToken),u(t,"access_token_ttl",i.expiry.toString()),i.wacToken&&u(t,"wac_token",i.wacToken));const o=e.customFontCatalogUrl;o&&u(t,"customfontcatalogurl",o);const s=e.contentBundle;if(s){if(s.url){u(t,"bundlesrc",s.url);const i=s.staleness,o=null!=i;o&&u(t,xe.kn,i.toString()),e.logger.ULS.Ye(577783775,E.B,F.Info,"Content bundle staleness: "+(o?i:"N/A"))}s.urlNoAuth&&u(t,"bundleurlnoauth",s.urlNoAuth),s.bundleCode&&u(t,"bundlecode",s.bundleCode)}const n=e.file,r=n.name;if(r){u(t,"filename",r);const e=X(r);e&&u(t,"fileextension",e)}n.getUrl&&u(t,"filegeturl",n.getUrl),n.downloadCode&&u(t,"filedownloadcode",n.downloadCode),n.urlNoAuth&&u(t,"fileurlnoauth",n.urlNoAuth),n.size&&u(t,"filesize",n.size.toString()),n.eTag&&u(t,"etag",n.eTag),n.cTag&&u(t,"revid",n.cTag),n.uniqueId&&u(t,"docid",n.uniqueId),void 0!==n.immutableReason&&u(t,"immutableReason",n.immutableReason.toString()),void 0!==n.supportsZipIt&&u(t,"supports_zipit",n.supportsZipIt.toString());const a=e.newFileTemplate;a&&(a.getUrl&&u(t,"templateurl",a.getUrl),a.size&&u(t,"filesize",a.size.toString()),a.eTag&&u(t,"etag",a.eTag),a.uniqueId&&u(t,"docid",a.uniqueId)),e.user.id&&u(t,"user_id",e.user.id),e.ownerId&&u(t,"owner_id",e.ownerId),e.sessionContext&&u(t,"sc",e.sessionContext);const c=e.ui;c.controls&&u(t,"huictrls",JSON.stringify(c.controls)),"Templatization"!==c.contentAssemblyMode&&"DocGen"!==c.contentAssemblyMode&&"ContentAssemblyEdit"!==c.contentAssemblyMode&&"ContentAssemblyView"!==c.contentAssemblyMode||u(t,"caae","1"),c.contentAssemblyMode&&u(t,"caaemode",c.contentAssemblyMode);const d=e.meeting;d&&(d.id&&u(t,"meetingId",d.id),d.title&&u(t,"meetingTitle",d.title),d.type&&u(t,"meetingType",d.type),d.scheduledStartTime&&u(t,"scheduledStartTime",d.scheduledStartTime),d.scheduledEndTime&&u(t,"scheduledEndTime",d.scheduledEndTime),d.isPresenter&&u(t,"isPresenter",d.isPresenter.toString()),d.organizerId&&u(t,"meetingOrganizerId",d.organizerId),d.joinUrl&&u(t,"meetingJoinUrl",encodeURIComponent(d.joinUrl)),d.isMeetingTeamsRoom&&u(t,"isMeetingTeamsRoom",d.isMeetingTeamsRoom.toString()));const l=e.host;return l.owlVersion&&u(t,"owlver",l.owlVersion),l.owlRollout&&u(t,"owlro",l.owlRollout),t}(e);return Object.keys(t).forEach(e=>{t[e]?i[e]=t[e]:delete i[e]}),i}const Xe=(e,t,i,o,s)=>e!==z.createNew?Promise.reject("Wrong flow"):new Promise(n=>{const r={wopiPendingInitializeTime:H()},a=!!(o&&o.parallelizeStartSessionRequest&&o.buildStartSessionRequestParams)&&o.parallelizeStartSessionRequest(i);let c=!1,d=!1,l=!1,h=!1,u=void 0,p=void 0,f=!1,m=!1;if(he()===ce.IE||o&&o.fallBackToSingleStepBootFlow&&o.fallBackToSingleStepBootFlow(i,t))return void function(){i.logger.ULS.Ye(578074079,E.B,F.Info,"Waiting for WOPI info to start boot");const e=(e,n)=>{if(c)i.logger.ULS.Ye(578074080,E.B,F.Warning,"completeCreateNew already called");else{if(c=!0,r.wopiPendingCompleteTime=H(),"failure"===n.state)return A(n.reason),i.state=U.Failed,void o({completion:"failure"});Qe(n.newFile),i.run(z.boot,{...t,wopi:n.wopi},s).then(e=>{o(e)})}};i.addActionHandler(z.completeCreateNew,e);const o=t=>{i.removeActionHandler(z.completeCreateNew,e),n(t)};s&&s.subscribe(()=>{o({completion:"cancelled"})})}();const w=(e,t)=>{c?i.logger.ULS.Ye(587236372,E.B,F.Warning,"completeCreateNew already called"):(c=!0,r.wopiPendingCompleteTime=H(),"failure"!==t.state?(u=t.wopi,ze(u)?(i.wopi=u,i.logger.ULS.Ye(587286030,E.B,F.Info,"WOPI info received. Access token: "+JSON.stringify({length:u.accessToken.length,expiry:u.expiry})+", current state: "+JSON.stringify({parallelizeStartSessionRequest:a,wacFrameLoaded:d,wacCanAcceptStartSessionResponse:l})),!a||d&&!l?d&&b():v(),d&&i.container&&i.container.postMessage(q.Gs,void 0),Qe(t.newFile)):g("InvalidWopiInfo")):g(t.reason))},g=e=>{A(e),d&&i.container&&i.container.postMessage(q.Ls,void 0)},v=()=>{i.logger.ULS.Ye(587233056,E.B,F.Info,"Making parallelized StartSession request");const t=o.buildStartSessionRequestParams(i,e,u),s=Ke(i,t.appPageName,t.queryParamsOverrides),n="access_token="+encodeURIComponent(u.accessToken)+"&access_token_ttl="+encodeURIComponent(u.expiry.toString());r.startSessionStartTime=H(),function(e,t,i,o){const s=new XMLHttpRequest;s.onreadystatechange=()=>{if(s&&4===s.readyState){if(void 0===s.status||0===s.status)return;try{o&&o(s)}finally{null!=s&&(s.onreadystatechange=()=>{})}}},s.open("POST",e);for(const e in i)s.setRequestHeader(e,i[e]);s.send(t)}(s,n,{"Content-Type":"application/x-www-form-urlencoded"},S)},S=e=>{const t=H();r.startSessionCompleteTime=t,i.logger.ULS.Ye(587233057,E.B,F.Info,`StartSession request completed. Status code: ${e.status}, time: ${t}`),p={RequestStatus:e.status,ResponseText:e.responseText},d&&l?_():i.logger.ULS.Ye(587233058,E.B,F.Info,"StartSession response not yet sent: "+JSON.stringify({wacFrameLoaded:d,wacCanAcceptStartSessionResponse:l,wopiInfoSent:f,startSessionResponseSent:m}))},I=(e,t)=>{r.readyMessageReceiveTime=H(),i.container&&i.container.postMessage(q.ds,void 0),d||(d=!0,l=t.CanAcceptStartSessionComplete,i.logger.ULS.Ye(587321567,E.B,F.Info,"App ready: "+JSON.stringify({parallelizeStartSessionRequest:a,wacCanAcceptStartSessionResponse:l,startSessionResponseAvailable:!!p,wopiInfoAvailable:!!u})),c&&i.container&&i.container.postMessage(u?q.Gs:q.Ls,void 0),a&&l?_():b(),Se(i.appInitDiagnostics,t.Diagnostics))},_=()=>{m||f||!p||(200===p.RequestStatus?(m=!0,r.completeMessageCreateTime=H(),T(q.fs,{StartSessionResponse:p,Diagnostics:r},3)):b())},b=()=>{m||f||!u||(f=!0,r.completeMessageCreateTime=H(),o&&o.sendCreateNewWopiInfo?o.sendCreateNewWopiInfo(i):T(q.ms,{WopiDetails:{WopiSrc:u.source,AccessToken:u.accessToken,AccessTokenTtl:u.expiry.toString()},Diagnostics:r},3))},T=(e,t,o)=>{const s=H();o<=0?i.logger.ULS.Ye(587233165,E.B,F.Error,"Attempted to complete but no ack. Time: "+s):(i.logger.ULS.Ye(587233166,E.B,F.Info,`Sending complete message. Retries left: ${o-1}, Time: ${s}`),r.completeMessageSendTime=s,i.container&&i.container.postMessage(e,t),window.setTimeout(C,1e3,e,t,o-1))},C=(e,t,o)=>{h||(i.logger.ULS.Ye(587233167,E.B,F.Info,"Timeout session complete ack. Retries left: "+o),T(e,t,o))},P=(e,t)=>{h=!0},y=e=>{i.removeActionHandler(z.completeCreateNew,w),i.removeActionHandler(j.mi,I),i.removeActionHandler(j.so,P),n(e)};function A(e){i.logger.ULS.Ye(596444188,E.B,F.Warning,"Fail with reason: "+(e?JSON.stringify(e):"N/A"))}i.addActionHandler(z.completeCreateNew,w),i.addActionHandler(j.mi,I),i.addActionHandler(j.so,P),s&&s.subscribe(()=>{y({completion:"cancelled"})}),i.skipWopiValidation=!0,i.skipFileNameCheck=!0,i.wopi=void 0,i.run(z.boot,t,s).then(e=>{i.skipWopiValidation=!1,i.wopi=u,y(e)})});function Qe(e){e&&(e.path&&history.replaceState({},"",e.path),e.title&&(document.title=e.title))}class Ye{get isCancelled(){return this.Vr}get timeoutInMs(){return this.Lr}get reason(){return this.Jr}cancel(){this.Gr(!1)}subscribe(e){this.Vr?e():this.$r.push(e)}constructor(e){this.Vr=!1,this.Jr="",this.$r=[],this.Gr=e=>{this.Vr||(this.Vr=!0,this.Jr=e?"timeout":"cancelled",this.$r.map(e=>e()),this.$r=[])},this.Lr=e,window.setTimeout(()=>this.Gr(!0),e)}}function et(e){return new Ye(e)}const tt=(e,t,i,o,s)=>e!==z.dispose?Promise.reject("Wrong flow"):new Promise(e=>{i.logger.ULS.Ye(595714433,E.B,F.Info,"start disposing the application");const n=i.host.requireExplicitUnload,r={disposeStartTime:H(),forceAppUnload:n};i.state=U.Disposing;const a=()=>{i.state=U.Disposed,e({completion:"success"})},c=e=>{o&&o.disposeAppSpecificResources&&o.disposeAppSpecificResources(i,t),i.dispose(),r.disposeEndTime=H(),function(e,t,i){if(i){const e=Number(i.hostMessageReceived);t.appUnloadStartTime&&!isNaN(e)&&(t.hostToAppPostMessageLatency=e-t.appUnloadStartTime);const o=Number(i.appMessageSent);!isNaN(o)&&t.appUnloadEndTime&&(t.appToHostPostMessageLatency=t.appUnloadEndTime-o);const s=Number(i.appUnloadStart),n=Number(i.appUnloadEnd);if(isNaN(s)||isNaN(n)||(t.appUnloadLatency=n-s),i.serverTimings){const e=i.serverTimings;for(const i in e)t["st-"+i.toString()]=e[i]}}e.logger.ULS.Ye(592524822,E.B,F.Info,"App disposed: "+JSON.stringify(t)),e.logger.ULS.flushOnClose()}(i,r,e),i.container?i.container.dispose(i.pendingReboot,n).then(a):a()};if(n){r.appUnloadStartTime=H();const e=(e,t)=>{r.appUnloadEndTime=H(),c(t)};i.addActionHandler(j.lo,e),(s||new Ye(5e3)).subscribe(()=>{i.state===U.Disposing&&(r.appUnloadTimedOut=!0,c())}),i.container&&i.container.postMessage(q.zs,void 0)}else c()}),it=(e,t,i,o,s)=>e!==j.Ni?Promise.reject("Wrong flow"):new Promise(e=>{if(i.host.capabilities&&i.host.capabilities.frameTrustCheck)i.raiseEvent(K.FrameTrust,t);else{const e=!!i.container&&i.container.isTopFrameTrusted;i.logger.ULS.Ye(592445957,E.B,F.Info,"Top frame is trusted: "+e),i.container&&i.container.postMessage(q.Ni,{isTopFrameTrusted:e})}e({completion:"success"})}),ot=(e,t,i,o,s)=>e!==j.Di?Promise.reject("Wrong flow"):new Promise(e=>{i.authTokenTrustValidator.isResourceTrustedForMessage(t).then(o=>{o?i.raiseEvent(K.GetAuthToken,t):(i.container.postMessage(q.Ws,{AuthToken:"",Error:"accessDenied",RequestId:t.RequestId,IdentityType:t.IdentityType}),e({completion:"success"}))},o=>{i.container.postMessage(q.Ws,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:t.RequestId,IdentityType:t.IdentityType}),e({completion:"failure",error:o})})}),st=(e,t,i,o,s)=>e!==j.gi?Promise.reject("Wrong flow"):new Promise(e=>{const s=t&&t.state?t.state:"Unknown";i.logger.ULS.Ye(592839750,E.B,F.Info,`Boot state: [${s}]`),o&&o.beforeComplete&&o.beforeComplete(s),e({completion:"success"})}),nt=(e,t,i,o,s)=>{if(e!==z.postWacToken)return Promise.reject("Wrong flow");const n=x();return i.logger.ULS.Ye(507774685,E.B,F.Important,"postWacToken flow initiated"),new Promise(e=>{const o=(e,t)=>{i.logger.ULS.Ye(507597017,E.B,F.Info,`postWacToken flow completed in ${x()-n} ms`),window.clearInterval(a),window.clearTimeout(c);const o={completion:"success"};t&&void 0!==t.TokenAlreadySet&&(o.data={TokenAlreadySet:t.TokenAlreadySet}),s(o)},s=t=>{i.removeActionHandler(j.os,o),e(t)},r=()=>{var e;return null===(e=i.container)||void 0===e?void 0:e.postMessage(q.in,t)};i.addActionHandler(j.os,o),r();const a=window.setInterval(r,100),c=window.setTimeout(()=>{window.clearInterval(a),i.logger.ULS.Ye(507844190,E.B,F.Warning,"postWacToken flow timed out after 60000 milliseconds"),s({completion:"timeout"})},6e4)})},rt=(e,t,i,o,s)=>e!==z.rename?Promise.reject("Wrong flow"):new Promise(e=>{const o=(e,i)=>{const o={completion:i.NewName===t.NewName?"success":"failure"};r(o)},n=(e,t)=>{r({completion:"failure"})},r=t=>{i.removeActionHandler(j.Ri,o),i.removeActionHandler(j.Wi,n),e(t)};i.addActionHandler(j.Ri,o),i.addActionHandler(j.Wi,n),(s||new Ye(5e3)).subscribe(()=>{r({completion:"cancelled"})}),i.container&&i.container.postMessage(q.Fs,t)}),at=(e,t,i,o,s)=>e!==j.no?Promise.reject("Wrong flow"):new Promise(e=>{!function(e){const t=window.navigator;t&&t.virtualKeyboard&&void 0!==t.virtualKeyboard.overlaysContent&&window===top&&(t.virtualKeyboard.overlaysContent=e)}(t.overlayContent),i.container&&i.container.postMessage(q.Js,void 0),e({completion:"success"})}),ct=(e,t,i,o,s)=>e!==j.rs?Promise.reject("Wrong flow"):new Promise(e=>{const o=t.flightKey,s=t.flightValue;var n;i.logger.ULS.Ye(507343134,E._e,F.Info,`setWacFlightValue ${o}: ${s}`),n=t,localStorage.setItem(n.flightKey,n.flightValue.toString()),e({completion:"success"})});var dt;!function(e){e[e.NotCreateNew=0]="NotCreateNew",e[e.UnifiedCreateNew=1]="UnifiedCreateNew",e[e.LegacyCreateNew=2]="LegacyCreateNew"}(dt||(dt={}));const lt="powerpoint.officeapps.live.com",ht="https://ffc-"+lt,ut="https://ppc-"+lt,pt="https://eurppc-"+lt,ft="https://usc-"+lt,mt="https://euc-"+lt,wt="https://cac-"+lt,gt="https://ukc-"+lt,vt="https://auc-"+lt,St="https://jpc-"+lt,It="https://inc-"+lt,_t="https://krc-"+lt,bt="https://frc-"+lt,Tt="https://sgc-"+lt,Ct="https://zac-"+lt,Pt="https://aec-"+lt,yt="https://gbc-"+lt,At="https://dec-"+lt,Ut="https://chc-"+lt,Et="https://noc-"+lt,Ft="https://brc-"+lt,Rt="https://sec-"+lt,Wt="https://qtc-"+lt,Ot="https://plc-"+lt,kt="https://"+lt,Nt="https://cnc-powerpoint.partner.officewebapps.cn",Mt="https://powerpoint.gov.online.office365.us",Dt="https://powerpoint.dod.online.office365.us",xt="https://powerpoint.wac.online.office.eaglex.ic.gov",Ht="https://powerpoint.wac.online.office.microsoft.scloud",Bt="https://devpr.officeapps.live-int.com",Vt="https://c4-powerpoint-15.cdn.office.net/pods/s/",Lt="https://c1-powerpoint-15.cdn.office.net/pods/s/",Jt=function(){const e={};return e[ht]=$t(ht,"https://c5-powerpoint-15.cdn.office.net/pods/s/"),e[ut]=$t(ut,Vt),e[pt]=$t(pt,Vt),e[kt]=$t(kt),e[ft]=$t(ft),e[mt]=$t(mt),e[wt]=$t(wt),e[gt]=$t(gt),e[vt]=$t(vt),e[St]=$t(St),e[It]=$t(It),e[_t]=$t(_t),e[bt]=$t(bt),e[Tt]=$t(Tt),e[Ct]=$t(Ct),e[Pt]=$t(Pt),e[At]=$t(At),e[Ut]=$t(Ut),e[Et]=$t(Et),e[Ft]=$t(Ft),e[Rt]=$t(Rt),e[Wt]=$t(Wt),e[Ot]=$t(Ot),e["https://powerpoint.online.office.de"]=$t("https://powerpoint.online.office.de","https://powerpoint.cdn.office.de/pods/s/"),e[Nt]=$t(Nt,"https://cdn.partner.officewebapps.cn/pods/s/"),e[Mt]=$t(Mt,"https://powerpoint.cdn.office365.us/pods/s/"),e[yt]=$t(yt,"https://powerpoint.cdn.office365.us/pods/s/"),e[Dt]=$t(Dt,"https://powerpoint.dod.cdn.office365.us/pods/s/"),e[xt]=$t(xt,"https://powerpoint.cdn.wac.online.office.eaglex.ic.gov/pods/s/"),e[Ht]=$t(Ht,"https://powerpoint.cdn.wac.online.office.microsoft.scloud/pods/s/"),e[Bt]=$t(Bt,Bt+"/pods/s/"),e}(),Gt={"https://ffc-powerpoint.officeapps.live.com":"ring1","https://ppc-powerpoint.officeapps.live.com":"ring2_2","https://eurppc-powerpoint.officeapps.live.com":"ring2_1","https://powerpoint.officeapps.live.com":"ring5_3","https://usc-powerpoint.officeapps.live.com":"ring5_3","https://euc-powerpoint.officeapps.live.com":"ring5_3","https://cac-powerpoint.officeapps.live.com":"ring5_2","https://ukc-powerpoint.officeapps.live.com":"ring5_2","https://auc-powerpoint.officeapps.live.com":"ring5_2","https://jpc-powerpoint.officeapps.live.com":"ring5_2","https://inc-powerpoint.officeapps.live.com":"ring5_2","https://krc-powerpoint.officeapps.live.com":"ring5_2","https://frc-powerpoint.officeapps.live.com":"ring5_2","https://sgc-powerpoint.officeapps.live.com":"ring5_2","https://zac-powerpoint.officeapps.live.com":"ring5_2","https://aec-powerpoint.officeapps.live.com":"ring5_2","https://dec-powerpoint.officeapps.live.com":"ring5_1","https://chc-powerpoint.officeapps.live.com":"ring5_1","https://noc-powerpoint.officeapps.live.com":"ring5_1","https://brc-powerpoint.officeapps.live.com":"ring5_1","https://sec-powerpoint.officeapps.live.com":"ring5_1","https://qtc-powerpoint.officeapps.live.com":"ring5_1","https://plc-powerpoint.officeapps.live.com":"ring5_0"};function $t(e,t=Lt){return{PodsUrl:e+"/pods/",WacCdnStaticServer:t}}function zt(e){const t=e.substring(0,e.indexOf("/p/"));return Jt[t.toLowerCase()]}const jt=["wdPodsUrl","wdPopsUrl","wdNewPodsFrame","wdNewEnabled","wdfs","wdfsection","wdIncludeHostUrl","wdoverrides"];function qt(e,t,i){if(!t)return e;let o=e;const s=null==i,n=o.indexOf("?");if(-1===n)return s?e:o+"?"+t+"="+i;const r=o.substr(n+1),a=r.split("&"),c=t+"=";let d=!1;for(let e=0;e<a.length;e+=1)if(0===a[e].indexOf(c)){o=o.replace(a[e],s?"":c+i),d=!0;break}return d||s||(r.length>0&&(o+="&"),o+=c+i),o}function Kt(e,t){return!e||"wd"!==e.substring(0,2)||jt.indexOf(e)>=0?"":e+"="+t}function Zt(e){let t=e,i="";const o=window.location.search.substring(1).split("&");for(const e of o){const o=e.split("=");"wdoverrides"===o[0]&&(i=o[1]);const s=Kt(o[0],o[1]);s&&(t+="&"+s)}i=i||"";const s=[];for(const e of i.split(/,|%2C/)){const t=e.split(/:|%3A/);2===t.length&&"devicepixelratio"!==t[0].toLowerCase()&&s.push(t[0]+":"+t[1])}return s.push("devicepixelratio:"+ge()),s.push("RenderGifSlideShow:true"),t=qt(t,"wdoverrides",s.join(",")),t}function Xt(e){let t=_("wdPodsUrl");return t&&!C(t)&&(t=""),t||(t=e),"/"!==t.substr(t.length-1)&&(t+="/"),t}function Qt(e,t){const i=e.bootParams,o=e.file;if(!i.isNewFile){if(!o.getUrl)throw Error("Missing FileGetUrl");if(!o.name)throw Error("Missing FileName")}const s=e.preseededSession;s&&s.key&&("_._._."===s.key.slice(0,6)&&"-.-.-."===s.key.slice(-6)||(s.key="_._._."+s.key+"-.-.-."));const n=e.appContext;n.wopiInfoSent=!1,n.bootComplete=!1,n.bootFlowResolve=t,n.bootRecorded=!1;const r=Jt[e.appBaseUrl];e.appBasePath=r?r.PodsUrl:e.appBaseUrl+"/pods/";const a=e.wdParams;let c=a.wdpodsurl;c&&!C(c)&&(c=""),c||(c=e.appBasePath);const d=/\/$/;if(d.test(c)||(c+="/"),!c)throw Error("Invalid PODS URL");n.podsUrl=c;let l=a.wdpopsurl;if(l&&!C(l)&&(l=""),l||(l=c,l=l.substring(0,l.indexOf("/pods/"))),d.test(l)||(l+="/"),!l)throw Error("Invalid POPS URL");if(n.popsUrl=l,e.bootstrapperUrl){const t="/pods/s/";n.cdnBasePath=e.bootstrapperUrl.split(t)[0]+t}else n.cdnBasePath=r?r.WacCdnStaticServer:Lt;n.createNewScenario=function(e,t,i,o){let s=dt.NotCreateNew,n="NotCreateNew";t.isNewFile?i.size?(s=dt.LegacyCreateNew,n="CreateNewWithNonZeroByteFile"):(s=dt.UnifiedCreateNew,n="IsNewFile"):t.isFromHostTemplate?(s=dt.UnifiedCreateNew,n="CreateNewFromHostTemplate"):o&&o.getUrl&&(s=dt.UnifiedCreateNew,n="CreateNewFromTemplateSourceUrl");const r={CreateNewScenario:dt[s],reason:n};return e.ULS.Ye(34932951,E.B,F.Info,JSON.stringify(r)),s}(e.logger,i,o,e.newFileTemplate),n.shouldUsePods=function(e,t,i,o,s,n,r){let a=!1,c=!1,d="";t?(a="false"!==t,c=!0,d="wdPodsEnabled is available"):i?e===dt.LegacyCreateNew?(a=!1,c=!1,d="Legacy Create New Scenario because non-zero file size"):o?(a=!1,c=!1,d="Embed View fallback to WAC"):(a=!0,c=!0,d="Supported Region"):(a=!1,c=!1,d="Wac region not currently supported by PODS",r.ULS.Ye(589168768,E.B,F.Warning,d+": "+n)),s||e!==dt.NotCreateNew||(a=!1,c=!1,d+=" | FileGetUrl is empty");const l={ShouldUsePodsOrCached:a,ShouldUsePods:a,CanUsePods:c,ApplicationUrl:n,Reason:d,CreateNewScenario:dt[e]};return r.ULS.Ye(561640788,E.B,F.Info,JSON.stringify(l)),a}(n.createNewScenario,a.wdpodsenabled,!!r,S(e.appUrl,"embed"),!!o.getUrl,P(e.appBaseUrl),e.logger);const h=e.hostInitDiagnostics;h&&h.userClickTime&&Pe(h.userClickTime,e.logger),function(e){const t=e.hostInitDiagnostics,i=e.bootParams,o=e.file,s=!!o.getUrl,n=!!e.customFontCatalogUrl,r=e.contentBundle,a={BootstrapperType:"TypeScript",JsApiVersion:"v2",Preview:!1,Scenario:"Unified App",ApplicationUrl:P(e.appBaseUrl),IsDeepLink:!!_("nav"),BootstrapperInstanceId:re(),IsMobileView:we(),ApplicationCustomSettings:{OnDemandServer:P(e.appBasePath),EnableWacFallback:!0},SessionInformation:{HostName:e.hostName,HostSessionId:e.hostSessionId,UiLocale:e.ui.language,DataLocale:i.dataLanguage,DocumentClickTime:t.userClickTime,CurrentTime:H(),UiHost:e.host.uiHostName,WdParams:e.wdParams},Diagnostics:{EntryPoint:t.entryPoint,FileHost:e.host.storageHostName,PodsRing:"",UnifiedUiHostDiagnostics:t.unifiedUiHostDiagnostics},WopiPrecheckInfo:{FileSize:o.size,FileGetUrlBool:s,CustomFontCatalogBool:n,FileGetUrlLength:s?o.getUrl.length:null,FileNameBool:!!o.name,ReadOnly:i.readOnly,IrmEnabled:i.irmEnabled,SupportsDecryptedContentDownload:i.supportsDecryptedContentDownload,ViewOnly:i.viewOnly,PreseededSessionKey:!!e.preseededSession&&!!e.preseededSession.key,FileExtension:X(o.name)||null,BundleInfo:r?{MajorVersion:r.majorVersion,URLBool:!!r.url}:{}},AppInfo:{AppVersionMajor:1,AppVersionMinor:k(),Environment:"wac",UserAgent:window.navigator.userAgent},AdditionalTelemetry:{PostMessageToken:e.sessionId}};e.logger.ULS.Ye(22357763,E.B,F.Info,JSON.stringify(a,Q))}(e)}function Yt(e){return e.appBasePath}function ei(e){return e.appBasePath+"RemoteTelemetry.ashx"+((t=e.sessionId)?"?usid="+t:"");var t}function ti(e){return!e.appContext.shouldUsePods}function ii(e){const t=e.ownerDocument.createElement("div");t.id="highContrastDetectionDiv",t.ariaHidden="true";const i=e.ownerDocument.createElement("a");i.id="highContrastDetectionAnchor",i.setAttribute("href","#"),i.ariaHidden="true",t.appendChild(i),e.appendChild(t);const o=e.ownerDocument.createElement("style");o.innerHTML="\n  @media screen and (-ms-high-contrast:active)\n  {\n   div#highContrastDetectionDiv a#highContrastDetectionAnchor\n   {\n  \tbackground-image: none !important;\n   }\n  }\n\n  div#highContrastDetectionDiv\n  {\n   background-color: Window;\n   position: absolute;\n   top: 0px;\n   left: -99999px;\n   width: 1px;\n   height: 1px;\n   opacity: 0;\n   overflow: hidden;\n  }\n\n  div#highContrastDetectionDiv a#highContrastDetectionAnchor\n  {\n   background-image: url('data:image/png;base64,highcontrastdetectordefault');\n  }\n",e.ownerDocument.head.appendChild(o);const s=()=>{e.ownerDocument.head.removeChild(o),e.removeChild(t)},n=ni(t),r=ni(i);if(n&&r){if(-1===r.backgroundImage.toLowerCase().indexOf("highcontrastdetectordefault")){const e=function(e,t,i){const o=oi(e),s=oi(t),n=oi(i);if(o&&s&&n)return{foregroundTextColor:o,backgroundColor:s,linkColor:n}}(n.color.toLowerCase(),n.backgroundColor.toLowerCase(),r.color.toLowerCase());return s(),{isInHighContrastMode:!0,highContrastColors:e}}return s(),{isInHighContrastMode:!1}}s()}function oi(e){return new RegExp("#[0-9A-Fa-f]{6}").test(e)?e:"transparent"===e||"window"===e?"transparent":function(e){const t=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);if(t&&4===t.length){return function(e,t,i){return"#"+si(Number(e),2)+si(Number(t),2)+si(Number(i),2)}(t[1],t[2],t[3])}}(e)}function si(e,t){let i=e.toString(16);for(;i.length<t;)i="0"+i;return i.toLowerCase()}function ni(e){if(e.ownerDocument&&e.ownerDocument.defaultView&&e.ownerDocument.defaultView.getComputedStyle)return e.ownerDocument.defaultView.getComputedStyle(e)}function ri(){const e=function(e){const t={width:e.width,height:e.height};let i=t.width<320;return i&&(t.height-=17),t.height<256&&(t.width-=17),!i&&t.width<320&&(i=!0,t.height-=17),t.width=Math.max(t.width,320),t.height=Math.max(t.height,256),t}({width:window.document.documentElement.clientWidth,height:window.document.documentElement.clientHeight-50});return(""+document.cookie).indexOf("WACRibbonMinimizedPPT=true")>=0&&(e.height-=ue()?108:94),e.height-=30,e.height-=23,e}function ai(e){return function(e){const t={width:e.width-20,height:e.height-20};return t.width<424?t.width=424:t.width>1696&&(t.width=1696),t.height<238.5?t.height=238.5:t.height>954&&(t.height=954),t}({height:e.height-32-1,width:e.width-238-1-17})}function ci(e){if(e.Diagnostics&&e.Diagnostics.entryPoint)return e.Diagnostics.entryPoint;if(!e.ApplicationUrl)return null;return I(e.ApplicationUrl,"wdOrigin")||null}function di(e,t,i){if(e)for(let o=0;o<e.length;o+=1){const s=e[o];if(s.name.indexOf(t)>=0)return s.name.toLowerCase()!==t.toLowerCase()&&i.ULS.Ye(38147726,E.B,F.Info,"Found partial match for bootstrapper URL perf entry"),s}}function li(e,t){if(t)try{if(!e)return void t.ULS.Ye(557454687,E.B,F.Info,"Missing BootstrapperUrl");if(!window.performance)return void t.ULS.Ye(557454688,E.B,F.Info,"Performance API not found on browser");let i=void 0;if(window.performance.getEntriesByName&&(i=di(window.performance.getEntriesByName(e),e,t)),!i&&window.performance.getEntries&&(t.ULS.Ye(557454689,E.B,F.Info,"Searching all entries for bootstrapper timing entry"),i=di(window.performance.getEntries(),e,t)),!i)return void t.ULS.Ye(557454690,E.B,F.Info,"Unable to extract Bootstrapper perf info");const o={name:e,logReason:"UnifiedTSBoot",nameMatchesExpected:i.name===e,connectEnd:i.connectEnd,connectStart:i.connectStart,domainLookupEnd:i.domainLookupEnd,domainLookupStart:i.domainLookupStart,fetchStart:i.fetchStart,initiatorType:i.initiatorType,redirectEnd:i.redirectEnd,redirectStart:i.redirectStart,requestStart:i.requestStart,responseEnd:i.responseEnd,responseStart:i.responseStart,duration:i.duration,entryType:i.entryType,startTime:i.startTime,nextHopProtocol:i.nextHopProtocol,workerStart:i.workerStart,secureConnectionStart:i.secureConnectionStart,transferSize:i.transferSize,encodedBodySize:i.encodedBodySize,decodedBodySize:i.decodedBodySize};t.ULS.Ye(34928845,E.B,F.Info,JSON.stringify(o))}catch(e){t.ULS.Ye(557454691,E.ce,F.Warning,"Exception extracting Bootstrapper perf info: "+Y(e))}}function hi(e){return!e||e.toLowerCase().indexOf("#")>-1?Math.random().toString(36).substring(2,25):e}function ui(e){const t=e.SessionInformation,i=e.Diagnostics;return{HostName:t.HostName,HostSessionId:t.HostSessionId,UiLocale:t.UiLocale,DataLocale:t.DataLocale,DocumentClickTime:i&&i.userClickTime?i.userClickTime:t.DocumentClickTime?t.DocumentClickTime.getTime():void 0,HostInitTime:t.HostInitTime,UiHost:pi(t.HostName),WdParams:t.WdParams}}function pi(e){if(!e)return"";switch(e){case"MSTeams":case"TeamsAndroid":case"TeamsiOS":return"teams";case"ParticipantApp":case"DragonGate":return e;default:return""}}function fi(e){if(!e)return"";switch(e){case"MSTeams":case"TeamsAndroid":case"TeamsiOS":case"OneDrive":case"ParticipantApp":case"DragonGate":return"SharePoint Online";default:return e}}function mi(e,t,i){if(!e)return;let o="Page lifecycle: "+t+" fired.";i&&(o+="Flushing ULS logger",e.ULS.flushOnClose()),e.ULS.Ye(579384268,E.B,F.Warning,o)}function wi(e){return e.toLocaleLowerCase().indexOf("pod")>=0||e.toLocaleLowerCase().indexOf("pop")>=0}function gi(e){let t="";for(const i in e)wi(i)||(t+="&"+i+"="+e[i]);return t}function vi(e){var t;const i=e.wdParams,o=we(),s="true"===i.wdembedview||S(e.appUrl,"embed"),n=e.appContext;let r=o?"pptmobileapp.aspx":s?"pptembed.aspx":"ppt.aspx";const a={},c={};jt.forEach(e=>{p(a,e)});const d=["devicepixelratio:"+ge(),"RenderGifSlideShow:true"],l=i.wdoverrides;l&&l.split(/,|%2C/).forEach(e=>{const t=e.split(/:|%3A/);2===t.length&&"devicepixelratio"!==t[0].toLowerCase()&&d.push(t[0]+":"+t[1])}),u(a,"wdoverrides",d.join(",")),s&&(p(a,"corrid"),p(a,"usid")),ue()&&u(c,"touchdevice","1");const h=window.document.documentElement;h&&(void 0!==h.clientWidth&&u(c,"windowwidth",h.clientWidth.toString()),void 0!==h.clientHeight&&u(c,"windowheight",h.clientHeight.toString()));const m=_("previoussessionid");if(m&&u(c,"previoussessionid",m),e.featureManager.isFeatureEnabled(G.Kt)||null!==(t=e.et)&&void 0!==t&&t.getValue(J.At,!1)){const t=window;if(t){const i=t._wopiContextJson;if(i&&i.PredictedOfficeAppEndPointHintForRealSession){const t=i.PredictedOfficeAppEndPoint;if(t)if(e.et.getValue(J.Wt,!1)){const o=i.PredictedOfficeAppEndPointAccessTime;if(o){const i=new Date(o),s=3e5;((new Date).getTime()-i.getTime()+s)/36e5<=e.et.getValue(J.Rt,48)&&u(a,"wdwaccluster",t)}else e.logger.ULS.Ye(507299216,E.B,F.Important,"PredictedOfficeAppEndPointAccessTime is null")}else u(a,"wdwaccluster",t)}}}Ce()&&u(c,"lssupported","1");const w=e.host.capabilities;w&&(w.rebootDoc&&(u(c,"sdr",w.rebootDoc.toString()),p(a,"sdr")),w.createNewDoc&&(u(c,"scnd","1"),p(a,"scnd")),w.authToken&&(u(c,"sat","1"),p(a,"sat")),w.customAuthConfig&&(u(c,"cac","1"),p(a,"cac")),w.refreshAccessToken&&(u(c,"rat","1"),p(a,"rat")),w.atMentions&&(u(c,"sams","1"),p(a,"sams")),w.moveToFolder&&(u(c,"mtf","1"),p(a,"mtf")),w.noBrowserModalDialogs&&(u(c,"nbmd","1"),p(a,"nbmd")),w.commonFilePicker&&(u(c,"sfp","1"),p(a,"sfp")),w.directDownload&&(u(c,"sdd","1"),p(a,"sdd")),w.directPrint&&(u(c,"sdp","1"),p(a,"sdp")),w.disableOfficeAddins&&(u(c,"doa","1"),p(a,"doa")));const g=e.ui;(g.hideHeader||"DocGen"===g.contentAssemblyMode||"Templatization"===g.contentAssemblyMode||"ContentAssemblyEdit"===g.contentAssemblyMode||"ContentAssemblyView"===g.contentAssemblyMode)&&(u(c,"hhdr","1"),p(a,"hhdr")),g.hideFileLocationPicker&&(u(c,"hodflp","1"),p(a,"hodflp")),g.hideAppLauncherInHeader&&(u(c,"halh","1"),p(a,"halh")),g.hideChatInHeader&&(u(c,"hch","1"),p(a,"hch")),g.hideMeInHeader&&(u(c,"hmh","1"),p(a,"hmh")),g.hideSearchInHeader&&(u(c,"hsh","1"),p(a,"hsh")),g.hideWorkflowInHeader&&(u(c,"hwfh","1"),p(a,"hwfh")),g.hideSettingsInHeader&&(u(c,"hsth","1"),p(a,"hsth")),g.showAppIconInHeader&&(u(c,"sih","1"),p(a,"sih")),g.useNeutralColorInHeader&&(u(c,"unh","1"),p(a,"unh")),e.hostName&&u(c,"filesrc",e.hostName),e.user.id&&u(c,"userid",e.user.id),g.openLinksInNewWindow&&(u(c,"onw","1"),p(a,"onw")),g.useDarkTheme&&(u(c,"udt","1"),p(a,"udt"));const v=e.viewMode;v&&v.hideToolbar&&u(c,"hvt","1");const I=e.file;I.name&&(u(a,"filename",b(I.name)),p(c,"filename")),I.getUrl&&(u(c,"fileurl",I.getUrl),p(c,"filegeturl")),u(a,"filegeturlbool",I.getUrl?"true":"false"),I.size&&(u(a,"fs",I.size.toString()),p(c,"filesize"));const C=e.newFileTemplate;C&&C.size&&(u(a,"fs",C.size.toString()),p(c,"filesize"));const P=e.contentBundle;P&&P.url&&(u(c,"bundleurl",P.url),p(c,"bundlesrc"));const y=e.bootParams;y.irmEnabled&&u(c,"irmenabled",y.irmEnabled.toString()),y.supportsDecryptedContentDownload&&u(c,"supportsdecryptedcontentdownload",y.supportsDecryptedContentDownload.toString()),y.readOnly&&p(a,"readonly"),u(a,"ro",y.readOnly?y.readOnly.toString():"false"),y.viewOnly&&u(c,"viewonly",y.viewOnly.toString()),y.openViewByDefault&&u(c,"ovbd",y.openViewByDefault.toString());const A=e.preseededSession;A&&(A.key&&(s||u(c,"preseededsessionkey",A.key),p(a,"preseededsessionkey")),A.id&&p(a,"preseededwacsessionid"));const U=e.throttling;U&&(U.protection&&(u(c,"ctp",U.protection),p(a,"ctp")),U.request&&(u(c,"rct",U.request),p(a,"rct")));let R=_("nav");if(R||(R=e.actNavId?e.actNavId:f(e.appUrl,"actnavid")),R){try{const e=T(R),t=JSON.parse(e),i=t.sId;i&&(u(a,"wdslideid",i),u(a,"dc","1"));const o=t.commentId;o&&"null"!==o&&u(a,"wdcommentid",o);const s=t.openMode;s&&"null"!==s&&u(a,"wdopenmode",s)}catch{e.logger.ULS.Ye(560329684,E.B,F.Error,"Failed to parse navigation id: "+R)}p(a,"actnavid")}if(n.shouldUsePods){e.appBasePath=n.podsUrl,p(a,"powerpointview"),u(a,"wdpodsurl",b(n.podsUrl)),u(a,"wdpopsurl",b(n.popsUrl)),u(a,"fastboot","true"),u(a,"noauth","1");const t=ri(),o=ai(t);u(a,"thpanel",t.height.toString()),u(a,"sw",o.width.toString()),u(a,"sh",o.height.toString());const s=i.wdfs;s&&u(a,"fslide",s);const r=i.wdfsection;r&&u(a,"fsection",r),(s||r||i.wdincludehosturl&&"false"!==i.wdincludehosturl)&&u(a,"frameurl",b(window.location.href));const d=_("automation");d&&u(a,"automation",d);const l=_("startrehearsal");if(l&&u(a,"startrehearsal",l),u(a,"postmessagetoken",e.sessionId),u(c,"postmessagetoken",e.sessionId),e.wdParams){const t=gi(e.wdParams);t&&u(c,"wdparams",t)}u(c,"jsapiversionminor",k().toString());const h=e.wopi;if(h&&h.source&&(u(c,"wopisrc",h.source),p(a,"wopisrc")),e.container){const t=ii(e.container.element);t&&t.isInHighContrastMode&&(u(c,"isinhighcontrastmode","true"),t.highContrastColors&&u(c,"clientcolorsettings",t.highContrastColors.foregroundTextColor+"_"+t.highContrastColors.backgroundColor+"_"+t.highContrastColors.linkColor))}}else{e.appBasePath||u(a,"nolog","True");const t=e.appUrl.substring(0,e.appUrl.indexOf("?")),i=t.lastIndexOf("/")+1;e.appBasePath=t.substring(0,i),r=t.substring(i);const o=e.wopi;if(o&&o.source){let e=o.source;e.toLowerCase().indexOf("powerpointframe.aspx")>=0&&(e=decodeURIComponent(f(e,"wopisrc"))),u(a,"wopisrc",b(e))}u(a,"wdenableroaming","1"),u(a,"wdo","1")}return{appPageName:r,queryParamsOverrides:a,postDataOverrides:c}}function Si(e){if(e.appContext.shouldUsePods){const t=(i,o)=>{Ii(e),e.removeActionHandler(j.mi,t)};e.addActionHandler(j.mi,t);const i=(t,i)=>{t===j.ho&&function(e,t){const i=t;if(i&&"number"==typeof i.Tag&&"number"==typeof i.Category&&"number"==typeof i.Level&&"string"==typeof i.Message)try{e.logger.ULS.Ye(i.Tag,i.Category,i.Level,i.Message)}catch(t){e.logger.ULS.Ye(512235072,E.B,F.Error,"ulsLog exception: "+t)}}(e,i)};e.addActionHandler(j.ho,i)}li(e.bootstrapperUrl,e.logger),window.setTimeout(()=>{e.logger.ULS.flush()},1e4)}function Ii(e){var t,i;const o=e.appContext;if(o.wopiInfoSent||!e.wopi)return;o.wopiInfoSent=!0;let s="";e.wdParams&&(s=Object.keys(e.wdParams).filter(e=>!/po[d/p]/i.test(e)).reduce((t,i)=>`${t}&${i}=${e.wdParams[i]}`,""));const n=e.bootParams,r=e.wopi,a=e.hostInitDiagnostics,c={WopiSrc:r.source,AccessToken:r.accessToken,AccessTokenTTL:r.expiry,ReadOnly:n.readOnly,IrmEnabled:n.irmEnabled,SupportsDecryptedContentDownload:n.supportsDecryptedContentDownload,FileName:e.file.name,SessionContext:e.sessionContext,WdParams:s,DocumentURL:window.location.href,PreviousSessionID:_("PreviousSessionID"),FirstPageFlushTime:null!==(t=window.WOPIPerf_FirstPageFlush)&&void 0!==t?t:a.hostPageFirstFlushTime,BootJsStartTime:window.WOPIPerf_BootJsStartTime,BootJsEndTime:window.WOPIPerf_BootJsEndTime,InitializeWacTime:window.WOPIPerf_InitializeWac,UserClickTime:null!==(i=window.WOPIPerf_UserClick)&&void 0!==i?i:a.userClickTime,UnifiedUiHostDiagnostics:a.unifiedUiHostDiagnostics,ClientDiagnostics:e.clientDiagnostics};if(r.wacToken&&(c.WacToken=r.wacToken),e.hostSessionId){const t=e.hostSessionId.indexOf(".");c.HostSessionId=t>0?e.hostSessionId.substring(0,t):e.hostSessionId}if(a.legacyPerformanceData){const e=a.legacyPerformanceData.host;e&&(void 0!==e.timing.navigationStart&&(c.NavigationStart=e.timing.navigationStart),void 0!==e.timing.fetchStart&&(c.FetchStart=e.timing.fetchStart),void 0!==e.timing.requestStart&&(c.RequestStart=e.timing.requestStart),void 0!==e.timing.responseStart&&(c.ResponseStart=e.timing.responseStart),void 0!==e.timing.responseEnd&&(c.ResponseEnd=e.timing.responseEnd),void 0!==e.navigation.type&&(c.NavigationType=e.navigation.type),void 0!==e.navigation.redirectCount&&(c.NavigationRedirects=e.navigation.redirectCount))}else if(window.performance){const e=window.performance.timing;e&&(c.NavigationStart=e.navigationStart,c.FetchStart=e.fetchStart,c.RequestStart=e.requestStart,c.ResponseStart=e.responseStart,c.ResponseEnd=e.responseEnd);const t=window.performance.navigation;t&&(c.NavigationType=t.type,c.NavigationRedirects=t.redirectCount)}e.container.postMessage(q.ms,c)}var _i;!function(e){e.bootWithoutWopiInfo="",e.unifiedSingleFlush="Unified_SingleFlush",e.unifiedIrmEnabled="Unified_IrmEnabled",e.unifiedViewActionUrl="Unified_ViewActionUrl",e.unifiedNotEditOrViewActionUrl="Unified_NotEditOrViewActionUrl",e.forceSingleStepBoot="Force_SingleStepBoot",e.wordUiEmbedReadOnlyEarlyRedirect="WordUiEmbed_ReadOnlyEarlyRedirect",e.wordUiEmbedIrmEnabledEarlyRedirect="WordUiEmbed_IrmEnabledEarlyRedirect",e.wordViewToUnifiedReadRedirect="WordView_UnifiedReadRedirect"}(_i||(_i={}));function bi(e,t){const i=document.createElement("input");return i.type="hidden",i.name=e,i.value=t,i}class Ti{GetApplicationType(){return"PowerPoint"}GetVersion(){return O()}GetSessionId(){return this.zr}RegisterEventHandler(){}RemoveEventHandler(){}RegisterErrorHandler(){}RemoveErrorHandler(){}PostCommand(){}Dispose(){}constructor(e){this.zr=e}}function Ci(e,t){var i;if(!e.IsFileNew){if(!e.WopiPrecheckInfo.FileGetUrl)throw Error("Missing FileGetUrl from contentParams");if(!e.WopiPrecheckInfo.FileName)throw Error("Null or Empty Filename")}const o=Xt(e.OnDemandServer);if(!o)throw Error("Invalid Pods URL");const s=function(e){let t=_("wdPopsUrl");return t&&!C(t)&&(t=""),t||(t=Xt(e),t=t.substr(0,t.indexOf("/pods/"))),"/"!==t.substr(t.length-1)&&(t+="/"),t}(e.OnDemandServer);if(!s)throw Error("Invalid Pops URL");const n=ri(),r=ai(n),a="true"===_("wdEmbedView")||S(e.ApplicationUrl,"embed");let c=a?"pptembed.aspx":"ppt.aspx";const d=we();t.ULS.Ye(51380293,E.B,F.Info,"IsRequestForMobileView:"+d),c=d?"pptmobileapp.aspx":c;let l=o+c+"?wdPodsUrl="+b(o)+"&wdPopsUrl="+b(s)+"&fastBoot=true&sw="+r.width+"&sh="+r.height+"&thPanel="+n.height+"&ro="+e.WopiPrecheckInfo.ReadOnly+"&sftc=1&NoAuth=1&jsApi=1&jsapiver=v1";e.WopiPrecheckInfo.FileName&&(l+="&fileName="+b(e.WopiPrecheckInfo.FileName)),"DocGen"!==e.SessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==e.SessionInformation.ContentAssemblyMode||(l+="&readonly=1");const h=_("wdfs");h&&(l+="&fslide="+h);const u=_("wdfsection");if(u&&(l+="&fsection="+u),e.FeatureManager.isFeatureEnabled(G.Kt)||null!==(i=e.SettingsManager)&&void 0!==i&&i.getValue(J.At,!1)){const t=window;if(t){const i=t._wopiContextJson;if(i&&i.PredictedOfficeAppEndPointHintForRealSession){const t=i.PredictedOfficeAppEndPoint;if(t)if(e.SettingsManager.getValue(J.Wt,!1)){const o=i.PredictedOfficeAppEndPointAccessTime;if(o){const i=new Date(o),s=3e5;((new Date).getTime()-i.getTime()+s)/36e5<=e.SettingsManager.getValue(J.Rt,48)&&(l+="&wdwaccluster="+t)}}else l+="&wdwaccluster="+t}}}const p=_("wdIncludeHostUrl");(h||u||p&&"false"!==p)&&(l=qt(l,"frameURL",b(window.location.href))),l=Zt(l),l=function(e,t){let i=e;const o=function(e){return e.SessionInformation.UiLocale?e.SessionInformation.UiLocale:I(e.ApplicationUrl,"ui")}(t);o&&(i=qt(i,"ui",o));const s=function(e){return e.SessionInformation.DataLocale?e.SessionInformation.DataLocale:I(e.ApplicationUrl,"rs")}(t);s&&(i=qt(i,"rs",s));const n=f(t.ApplicationUrl,"mscc");n&&(i=qt(i,"mscc",n));const r=f(t.ApplicationUrl,"wdFR");r&&(i=qt(i,"wdFR",r));const a=ci(t);a&&(i=qt(i,"wdOrigin",b(a)));const c=hi(t.PostMessageToken);return t.PostMessageToken&&(i+="&postMessageToken="+c),(t.SessionInformation.DisableChat||t.ApplicationUrl.toLowerCase().indexOf("dchat=1")>-1)&&(i=qt(i,"dchat","1")),i=function(e,t){const i=t.indexOf("?");if(-1===i)return e;const o=t.substring(i+1).split("&");let s=e;for(const t of o){const i=t.split("=");if(""===f(e,i[0])){const e=Kt(i[0],i[1]);e&&(s+="&"+e)}}return s}(i,t.ApplicationUrl),i}(l,e),e.IsFileNew&&(l+="&new=1"),e.NewFileTemplateSource&&e.NewFileTemplateSource.FileSize?l+="&fs="+e.NewFileTemplateSource.FileSize:e.WopiPrecheckInfo.FileSize&&(l+="&fs="+e.WopiPrecheckInfo.FileSize);const m=!(w=e.SessionInformation.HostSessionId)||w.toLowerCase().indexOf("#")>-1?Math.random().toString(36).substring(2,25):w;var w;e.SessionInformation.HostSessionId&&(l+="&hid="+m);const g=_("Automation");g&&(l+="&Automation="+g);const v=_("StartRehearsal");v&&(l+="&StartRehearsal="+v),a||(l+="&usid="+e.SessionId),e.ApplicationUrl.toLowerCase().indexOf("uiembed=1")>-1&&(l+="&uiEmbed=1"),e.SessionInformation.SupportsAccessibilityLoop&&(l+="&accloop=1"),e.SessionInformation.IsSynthetic&&(l+="syn=1");const P=I(e.ApplicationUrl,"uih");P&&(l+="&uih="+P),e.SessionInformation.UiHostIntegrationType&&(l+="&uihit="+b(e.SessionInformation.UiHostIntegrationType)),"Microsoft Teams"===e.SessionInformation.HostName&&(t.ULS.Ye(507121920,E.B,F.Important,"PowerPoint setting Force View only for Teams WXP Files session."),l+="&fvo=1"),e.SessionInformation.MetaUiHostVersion&&(l+="&muv="+b(e.SessionInformation.MetaUiHostVersion)),e.SessionInformation.HighContrastMode&&(l+="&hcm="+b(e.SessionInformation.HighContrastMode));let y=_("nav");if(y||(y=f(e.ApplicationUrl,"actNavId")),y)try{const e=T(y),t=JSON.parse(e),i=t.sId;i&&(l=qt(l,"wdSlideId",i),l=qt(l,"DC","1"));const o=t.commentId;o&&"null"!==o&&(l=qt(l,"wdCommentId",o));const s=t.openMode;s&&"null"!==s&&(l=qt(l,"wdOpenMode",s))}catch{t.ULS.Ye(38580688,E.B,F.Error,"Failed to parse navigation ID: "+y)}const A=e.Container;if(A){const i=document.createElement("iframe");i.id="WebApplicationFrame",i.name="wac_frame",i.title="Office Online Frame",i.frameBorder="0",i.style.top="0",i.style.bottom="0",i.style.left="0",i.style.right="0",i.style.height="100%",i.style.width="100%",i.style.minHeight="200px",i.style.minWidth="300px",i.style.position="absolute",i.setAttribute("allowfullscreen","true"),i.setAttribute("allowTransparency","true");let s="";if(he()===ce.Safari)s+="autoplay;",s+="microphone;",s+="camera;",s+="clipboard-read;",s+="clipboard-write;",s+="display-capture;";else{const t=o+" "+function(e,t){if(t){const e="/pods/s/";return t.split(e)[0]+e}if(e){const t=zt(e);if(t)return t.WacCdnStaticServer;throw Error("Application url provided but region not in region allow list")}return Lt}(e.ApplicationUrl,e.BootstrapperUrl)+";";s+="autoplay "+t,s+="microphone "+t,s+="camera "+t,s+="clipboard-read "+t,s+="clipboard-write "+t,s+="display-capture "+t}i.setAttribute("allow",s),A.style.top="0",A.style.bottom="0",A.style.left="0",A.style.right="0",A.style.height="100%",A.style.width="100%",A.style.minHeight="200px",A.style.minWidth="300px",A.appendChild(i);const n=Date.now(),r=e.WopiPrecheckInfo.FileGetUrl;t.ULS.Ye(38580689,E.B,F.Info,r?r.toString().length.toString():"null"),l+="&fileGetUrlBool="+!!r;const c=document.createElement("form");if(c.name="frameForm",c.id="frameForm",c.target="wac_frame",c.action=l,c.method="post",A.appendChild(c),e.WopiInfo){const t=e.WopiInfo.WopiSrc;t&&c.appendChild(bi("WOPISrc",t));const i=e.WopiInfo.AccessToken;i&&c.appendChild(bi("access_token",b(i)));const o=e.WopiInfo.AccessTokenExpiry;o&&c.appendChild(bi("access_token_ttl",o.getTime().toString()));const s=e.WopiInfo.WacToken;s&&c.appendChild(bi("wac_token",b(s)))}const d=e.SessionInformation.SessionContext;if(d&&c.appendChild(bi("sc",d)),e.SessionInformation.WdParams){const t=gi(e.SessionInformation.WdParams);t&&c.appendChild(bi("wdparams",t))}c.appendChild(bi("jsapiversionminor",k().toString())),e.SessionInformation.HideViewerToolbar&&c.appendChild(bi("hvt","1")),r&&c.appendChild(bi("fileUrl",r));const h=e.WopiPrecheckInfo.CustomFontCatalogUrl;h&&c.appendChild(bi("customFontCatalogUrl",h)),e.NewFileTemplateSource&&e.NewFileTemplateSource.FileGetUrl&&c.appendChild(bi("templateUrl",e.NewFileTemplateSource.FileGetUrl)),e.SessionInformation.UserId&&(c.appendChild(bi("UserID",e.SessionInformation.UserId)),c.appendChild(bi("user_id",e.SessionInformation.UserId))),e.WopiPrecheckInfo.IrmEnabled&&c.appendChild(bi("irmEnabled",e.WopiPrecheckInfo.IrmEnabled.toString())),e.WopiPrecheckInfo.SupportsDecryptedContentDownload&&c.appendChild(bi("SupportsDecryptedContentDownload",e.WopiPrecheckInfo.SupportsDecryptedContentDownload.toString())),e.WopiPrecheckInfo.ViewOnly&&c.appendChild(bi("ViewOnly",e.WopiPrecheckInfo.ViewOnly.toString())),e.NewFileTemplateSource&&e.NewFileTemplateSource.ETag?c.appendChild(bi("ETag",e.NewFileTemplateSource.ETag)):e.WopiPrecheckInfo.ETag&&c.appendChild(bi("ETag",e.WopiPrecheckInfo.ETag)),e.WopiPrecheckInfo.CTag&&c.appendChild(bi("RevID",e.WopiPrecheckInfo.CTag)),e.NewFileTemplateSource&&e.NewFileTemplateSource.DocUniqueId?c.appendChild(bi("DocID",e.NewFileTemplateSource.DocUniqueId)):e.WopiPrecheckInfo.DocUniqueId&&c.appendChild(bi("DocID",e.WopiPrecheckInfo.DocUniqueId)),e.WopiPrecheckInfo.BundleInfo&&e.WopiPrecheckInfo.BundleInfo.Url&&c.appendChild(bi("bundleUrl",e.WopiPrecheckInfo.BundleInfo.Url)),e.WopiPrecheckInfo.PreseededSessionKey&&!a&&c.appendChild(bi("PreseededSessionKey",e.WopiPrecheckInfo.PreseededSessionKey)),e.SessionInformation.HostName&&c.appendChild(bi("fileSrc",e.SessionInformation.HostName)),e.ApplicationCustomSettings&&e.ApplicationCustomSettings.HostUIControls&&c.appendChild(bi("huictrls",JSON.stringify(e.ApplicationCustomSettings.HostUIControls))),c.appendChild(bi("feature_status",te(e.FeatureManager,{wdFlights:_("wdFlights")}))),ue()&&c.appendChild(bi("touchDevice","1")),window.document.documentElement&&(void 0!==window.document.documentElement.clientWidth&&c.appendChild(bi("windowWidth",window.document.documentElement.clientWidth.toString())),void 0!==window.document.documentElement.clientHeight&&c.appendChild(bi("windowHeight",window.document.documentElement.clientHeight.toString())));const u=_("PreviousSessionID");if(u&&c.appendChild(bi("PreviousSessionID",u)),Ce()&&c.appendChild(bi("LSSupported","1")),c.appendChild(bi("postMessageToken",e.PostMessageToken)),(e.SessionInformation.HideHeader||"teams"===P&&"UnifiedUiHostTeams"!==e.SessionInformation.UiHostIntegrationType&&"TeamsModern"!==e.SessionInformation.UiHostIntegrationType||"owa"===P||"DocGen"===e.SessionInformation.ContentAssemblyMode||"Templatization"===e.SessionInformation.ContentAssemblyMode||"ContentAssemblyEdit"===e.SessionInformation.ContentAssemblyMode||"ContentAssemblyView"===e.SessionInformation.ContentAssemblyMode)&&c.appendChild(bi("hhdr","1")),e.SessionInformation.HideAppLauncherInHeader&&c.appendChild(bi("halh","1")),e.SessionInformation.HideSearchInHeader&&c.appendChild(bi("hsh","1")),e.SessionInformation.HideMeInHeader&&c.appendChild(bi("hmh","1")),e.SessionInformation.HideChatInHeader&&c.appendChild(bi("hch","1")),e.SessionInformation.HideWorkflowInHeader&&c.appendChild(bi("hwfh","1")),e.SessionInformation.HideSettingsInHeader&&c.appendChild(bi("hsth","1")),e.SessionInformation.ShowAppIconInHeader&&c.appendChild(bi("sih","1")),e.SessionInformation.UseNeutralColorInHeader&&c.appendChild(bi("unh","1")),e.SessionInformation.SupportsAuthToken&&c.appendChild(bi("sat","1")),e.SessionInformation.SupportsCustomAuthConfig&&c.appendChild(bi("cac","1")),e.SessionInformation.SupportsCreateNewDocument&&c.appendChild(bi("scnd","1")),e.SessionInformation.UseDarkTheme&&c.appendChild(bi("udt","1")),e.SessionInformation.SupportsDirectPrint&&c.appendChild(bi("sdp","1")),e.SessionInformation.DisableOfficeAddins&&c.appendChild(bi("doa","1")),e.SessionInformation.SupportsDirectDownload&&c.appendChild(bi("sdd","1")),"Templatization"!==e.SessionInformation.ContentAssemblyMode&&"DocGen"!==e.SessionInformation.ContentAssemblyMode&&"ContentAssemblyEdit"!==e.SessionInformation.ContentAssemblyMode&&"ContentAssemblyView"!==e.SessionInformation.ContentAssemblyMode||c.appendChild(bi("caae","1")),e.SessionInformation.ContentAssemblyMode&&c.appendChild(bi("caaemode",e.SessionInformation.ContentAssemblyMode)),e.ApplicationUrl.toLowerCase().indexOf("uiembed=1")>-1&&e.SessionInformation.SupportsDocReboot&&c.appendChild(bi("sdr",!0===e.SessionInformation.SupportsDocReboot?"1":e.SessionInformation.SupportsDocReboot.toString())),e.SessionInformation.HideWACOneDriveFileLocationPicker&&c.appendChild(bi("hodflp","1")),e.SessionInformation.SupportsAtMentions&&c.appendChild(bi("sams","1")),e.WopiPrecheckInfo.RequestedCallThrottling){const t=e.WopiPrecheckInfo.RequestedCallThrottling;c.appendChild(bi("rct",t))}if(e.WopiPrecheckInfo.ClientThrottlingProtection){const t=e.WopiPrecheckInfo.ClientThrottlingProtection;c.appendChild(bi("ctp",t))}e.WopiPrecheckInfo.OpenViewByDefault&&c.appendChild(bi("ovbd",e.WopiPrecheckInfo.OpenViewByDefault.toString())),e.SessionInformation.SupportsMoveToFolder&&c.appendChild(bi("mtf","1")),e.SessionInformation.NoBrowserModalDialogs&&c.appendChild(bi("nbmd","1")),e.SessionInformation.SupportsCommonFilePicker&&c.appendChild(bi("sfp","1")),e.SessionInformation.OpenLinksInNewWindow&&c.appendChild(bi("onw","1"));const p=ii(A);p&&p.isInHighContrastMode&&(c.appendChild(bi("IsInHighContrastMode","true")),p.highContrastColors&&c.appendChild(bi("ClientColorSettings",p.highContrastColors.foregroundTextColor+"_"+p.highContrastColors.backgroundColor+"_"+p.highContrastColors.linkColor)));const f=e.SessionInformation.OwlVersion;f&&c.appendChild(bi("owlver",f));const m=e.SessionInformation.OwlRollout;return m&&c.appendChild(bi("owlro",m)),c.appendChild(bi("jsapibuild",O())),c.submit(),{IFrameElement:i,FrameCreateTime:n}}}function Pi(e){const t=e.appContext;let i="";if(he()===ce.Safari)i+="autoplay;microphone;camera;clipboard-read;clipboard-write;display-capture;";else{const e=t.podsUrl+" "+t.cdnBasePath+";";i+="autoplay "+e,i+="microphone "+e,i+="camera "+e,i+="clipboard-read "+e,i+="clipboard-write "+e,i+="display-capture "+e}return{permissionsPolicy:i,minHeight:t.shouldUsePods?"200px":"150px",minWidth:"300px",useAdditionalDiv:!t.shouldUsePods}}var yi;function Ai(e,t){return function(e,t){return e+"RemoteTelemetry.ashx"+(t?"?usid="+t:"")}(function(e){const t=e.match(/^(.*?\/\/[^\/]+\/[^\/]+\/)(.*)$/);if(!t)throw new Error("Invalid URL");return t[1]}(e),t)}!function(e){e.AppInitError="AppInitError",e.ApiDisabledError="ApiDisabledError",e.CannotLoadFirstPage="CannotLoadFirstPage",e.InvalidWopiInfo="InvalidWopiInfo",e.TimeoutWacReady="TimeoutWacReady",e.WacFailed="WacFailed"}(yi||(yi={}));const Ui={errorType:yi.AppInitError,errorObject:"Timed out waiting for FnOnInitializeSuccess",Category:0,Code:5,ErrorName:"TimeoutInitialize",EventType:13,ExtraInfo:"Initialization timeout"};class Ei{constructor(e,t){if(this.jr=0,this.qr=0,this.Kr=0,this.Zr=0,this.Xr=!1,this.Qr=(e,t)=>{this.jr=H();let i=6e5;const o=_("wdOnSuccessTimeout");o&&parseInt(o,10).toString()===o&&(i=parseInt(o,10),t.ULS.Ye(527521921,E.B,F.Warning,"App Timeout is overridden with url override param wdOnSuccessTimeout: "+i)),i&&window.setTimeout(()=>this.Yr(e,t),i)},this.ea=(e,t,i,o)=>{const s={Message:`Received ${e} callback after timeout had elapsed`,timeoutTimeMs:this.Zr,successTimeMs:this.qr,startTimeMs:this.jr,appInitDiagnostics:i,error:o};t&&t.ULS.Ye(38589660,E.B,F.Info,JSON.stringify(s))},this.Yr=(e,t)=>{if(!(this.Kr||this.qr||this.Zr)){this.Zr=H();try{if(Le(e.Container)){if(t){const i=`Timed out waiting for FnOnInitializeSuccess to be called. startMs:${this.jr}, timeoutMs:${this.Zr}, scenario:Unified, hostSessionId:${e.SessionInformation.HostSessionId}, host: ${e.SessionInformation.HostName}`;t.ULS.Ye(38589661,E.B,F.Error,i),Fi(e,5,"TimeoutInitialize",i,t,this.Zr,!0)}e.FnOnInitializeFailure&&e.FnOnInitializeFailure(Ui)}else t&&(t.ULS.Ye(579604899,E.B,F.Warning,"App container is unloaded. Scenario: Unified"),Fi(e,7,"AppContainerUnloadedTimeout","App container is unloaded",t,this.Zr,!1))}catch(e){t&&t.ULS.Ye(579604898,E.B,F.Error,"timeoutIfSuccessNotCalled exception: "+Y(e))}}},e.FnOnInitializeSuccess){const i=e.FnOnInitializeSuccess;e.FnOnInitializeSuccess=(o,s)=>{this.qr=H(),this.Xr||(this.Xr=!0,this.Zr?this.ea("success",t,s):(t&&(t.ULS.Ye(38836226,E.B,F.Info,"TimeoutWrapper: Calling fnOnInitializeSuccess"),Fi(e,void 0,void 0,void 0,t,H(),!1,s)),i(o,s)))}}if(e.FnOnInitializeFailure){const i=e.FnOnInitializeFailure;e.FnOnInitializeFailure=(o,s)=>{this.Kr=H(),this.Xr||(this.Xr=!0,this.Zr&&o!==Ui?this.ea("failure",t,s,o):(t&&(Fi(e,o.Code,o.ErrorName,o.errorObject,t,H(),!1,s),t.ULS.Ye(38836227,E.B,F.Info,"TimeoutWrapper: Calling fnOnInitializeFailure")),i(o,s)))}}this.Qr(e,t)}}function Fi(e,t,i,o,s,n,r,a){const c=null==t&&null==i&&null==o&&!r,d=e.SessionInformation,l=e.WopiPrecheckInfo,h=l.BundleInfo;let u=0;null!=d.DocumentClickTime&&d.DocumentClickTime.getTime&&(u=d.DocumentClickTime.getTime());const p={AppMetadata:{BrowserTechnology:"",Browser:"",FileSizeHint:l.FileSize,ApiStartTime:0,HostInitTime:d.HostInitTime,AppVersion:"1."+k(),UseBabylon:"",EntryPoint:ci(e),SessionId:e.SessionId,UserAgent:window.navigator.userAgent,WACRegion:P(e.ApplicationUrl),FileHost:fi(d.HostName),Host:d.HostName,PodsRing:"",UiHost:pi(d.HostName)},BootInfo:{PreloadCompleteTime:0,DocumentClickTime:u,BootSuccess:c,BootTime:n,BootMode:""},BundleMetadata:"[]",FatalErrors:c?"":{ErrorCategory:"fatal",ExtraInfo:"",CorrelationId:"",ErrorCode:t,ErrorName:i,Message:o},NonFatalErrors:[],WopiPrecheckInfo:{FileGetUrlBool:!!l.FileGetUrl,FileNameBool:!!l.FileName,ReadOnly:l.ReadOnly,SupportsDecryptedContentDownload:l.SupportsDecryptedContentDownload,ViewOnly:l.ViewOnly,PreseededSessionKey:l.PreseededSessionKey,BundleInfo:h?{MajorVersion:h.MajorVersion,URLBool:!!h.Url}:""},AppBootTimings:a?a.appBootTimingDict:""};s.ULS.Ye(r?592007955:587843200,E.B,r?F.Error:F.Info,JSON.stringify(p)),D(Ai(e.ApplicationUrl,e.SessionId),"PowerPoint",c?"bootSuccess":"bootFailure")}function Ri(e){let t=6e5;const i=e.wdParams.wdonsuccesstimeout;return i&&parseInt(i,10).toString()===i&&(t=parseInt(i,10)),t}function Wi(e){e.appContext.bootComplete=!0,Oi(e),e.logger.ULS.Ye(34932955,E.B,F.Warning,JSON.stringify(e.diagnostics)),ki(e)}function Oi(e){if(!e.appContext.shouldUsePods)return;const t=e.appInitDiagnostics;t.officeFrameServerDocumentFlushTime=t.documentFlushTime,t.officeFrameServerFirstFlushTime=t.serverFirstFlushTime,t.officeFrameServerStartTime=t.serverStartTime,t.officeServerDocumentProcessStartTime=t.bootStartMs,t.officeServerDocumentProcessEndTime=t.bootEndMs,t.fileRequestsData=[{browserRequest:!1,status:200,isAppCompleteCritical:!0,isDocumentLoadCritical:!0,name:"BootRequest",correlationId:t.downloadCorrelation,startTime:t.downloadStartMs,endTime:t.downloadEndMs,size:t.downloadSize,incremental:t.incDownload}],delete t.documentFlushTime,delete t.serverFirstFlushTime,delete t.serverStartTime,delete t.bootStartMs,delete t.bootEndMs,delete t.downloadCorrelation,delete t.downloadStartMs,delete t.downloadEndMs,delete t.downloadSize,delete t.incDownload}function ki(e,t,i,o){const s=e.appContext;if(s.bootRecorded)return;s.bootRecorded=!0;const n=void 0!==t||void 0!==i||void 0!==o,r=!!e.timeoutTime,a=!!e.failureTime,c=!(!e.successTime||r||a||n),d=c?e.successTime:a?e.failureTime:e.timeoutTime,l=e.file,h=e.hostInitDiagnostics,u=e.bootParams,p=e.contentBundle,f=e.preseededSession,m=e.appInitDiagnostics,w={AppMetadata:{BrowserTechnology:"",Browser:"",FileSizeHint:l.size,ApiStartTime:0,HostInitTime:h.hostInitializeCallTime,AppVersion:"1."+k(),UseBabylon:"",EntryPoint:h.entryPoint,SessionId:e.sessionId,UserAgent:window.navigator.userAgent,WACRegion:P(e.appBasePath),FileHost:e.host.storageHostName,Host:e.hostName,PodsRing:"",UiHost:e.host.uiHostName},BootInfo:{PreloadCompleteTime:0,DocumentClickTime:h.userClickTime,BootSuccess:c,BootTime:d,BootMode:""},BundleMetadata:"[]",FatalErrors:c?"":{ErrorCategory:"fatal",ExtraInfo:"",CorrelationId:"",ErrorCode:t,ErrorName:i,Message:o},NonFatalErrors:[],WopiPrecheckInfo:{FileGetUrlBool:!!l.getUrl,FileNameBool:!!l.name,ReadOnly:u.readOnly,SupportsDecryptedContentDownload:u.supportsDecryptedContentDownload,ViewOnly:u.viewOnly,PreseededSessionKey:f?f.key:void 0,BundleInfo:p?{MajorVersion:p.majorVersion,URLBool:!!p.url}:""},AppBootTimings:m?m.appBootTimingDict:""};e.logger.ULS.Ye(r?592007955:587843200,E.B,r?F.Error:F.Info,JSON.stringify(w))}function Ni(e,t){ki(e,void 0,t.errorType,Y(t.errorObject))}function Mi(e){try{const t=!e.container||!Le(e.container.element),i=t?7:5,o=t?"AppContainerUnloadedTimeout":"TimeoutInitialize",s=t?"App container is unloaded":`Timed out waiting for boot success. startMs:${e.hostInitDiagnostics.hostInitializeCallTime}, timeoutMs:${e.timeoutTime}, scenario:Unified, hostSessionId:${e.hostSessionId}, host: ${e.hostName}`;if(t)e.failureTime=e.timeoutTime,e.timeoutTime=0;else if(e.appContext.shouldUsePods){const t=(i,o)=>{Se(e.appInitDiagnostics,o.Diagnostics),Oi(e);const s={message:"Received success message after timeout had elapsed",timeoutTime:e.timeoutTime,currentTime:H(),...e.diagnostics};e.logger.ULS.Ye(558195677,E.B,F.Info,JSON.stringify(s)),e.removeActionHandler(j.vi,t)};e.addActionHandler(j.vi,t)}ki(e,i,o,s)}catch(t){e.logger.ULS.Ye(558893250,E.B,F.Error,"onTimeout exception: "+Y(t))}}function Di(e,t){ki(e,void 0,"AppInitError",Y(t))}function xi(){return!1}function Hi(e){e.appContext.shouldUsePods&&Ii(e)}const Bi=(e,t,i,o,s)=>e!==j.Xi?Promise.reject("Wrong flow"):i.ui.uiEmbed?((e,t,i,o,s)=>e!==j.Xi?Promise.reject("Wrong flow"):new Promise(e=>{i.pendingReboot=!0;let o=void 0;if(t.queryOverrides)try{o=JSON.parse(t.queryOverrides)}catch(e){i.logger.ULS.Ye(592217694,E.B,F.Error,"Failed to parse queryOverrides: "+o)}i.raiseEvent(K.Reboot,{...t,previousSessionId:i.sessionId,queryOverrides:o}),e({completion:"success"})}))(e,t,i):new Promise(e=>{let o=window.location.href;S(o,"wdccsoff")&&(o=g(o,"wdccsoff")),o=m(o,"previoussessionid",i.sessionId,!0),t.controllerServicesParam&&(o=m(o,t.controllerServicesParamName,t.controllerServicesParam)),i.logger.ULS.Ye(560740507,E.B,F.Info,"Updating window.location.href"),window.location.href=o,e({completion:"success"})});function Vi(e,t,i=!1){if(!e)throw new TypeError("SessionBootParams");const o=e.appUrl,s=e.appBaseUrl;if(!o&&!s)throw new TypeError("Either appUrl or appBaseUrl should exist");if(o&&"string"!=typeof o)throw new TypeError("AppUrl");if(s&&"string"!=typeof s)throw new TypeError("AppBaseUrl");const n=e.file;if(!n||!i&&!n.name)throw new TypeError("FileInfo");const r=e.container;if(!r||!(r instanceof Je)&&!r.appendChild)throw new TypeError("Container");if(!t&&!ze(e.wopi))throw new TypeError("WopiInfo")}class Li{restart(){const e=this.ta.getValue(J.pt,!1);this.ia=x()+(this.oa?this.oa:this.ta.getValue(J.rt,6e5));const t=this.bn?3e3:5e3;this.sa=window.setInterval(()=>{e&&this.ci.ULS.Ye(595724178,E.B,F.Info,"Boot_HeartBeat"),x()>this.ia&&(this.stop(),Ji(this.ci),this.na&&this.na())},this.ta.getValue(J.ut,t)),this.ra.push(window.setTimeout(Ji,this.ta.getValue(J.ct,6e4),this.ci,1)),this.ra.push(window.setTimeout(Ji,this.ta.getValue(J.dt,18e4),this.ci,2))}stop(){this.ia=0,this.sa&&(window.clearInterval(this.sa),this.sa=void 0),this.ra.forEach(e=>{window.clearTimeout(e)}),this.ra=[]}constructor(e,t,i,o,s){this.ia=0,this.ra=[],this.bn=!1,this.bn=e,this.ta=t,this.ci=i,this.na=o,this.oa=s,this.restart()}}function Ji(e,t){e.ULS.Ye(594901218,E.B,F.Warning,"Boot_NotComplete_"+(t||"Final")),e.ULS.flush()}const Gi=(e,t,i,o,s)=>{var r,a,l,u,p;if(e!==z.boot)return Promise.reject("Wrong flow");let m=t.appBaseUrl?t.appBaseUrl.toLowerCase():d(t.appUrl).toLowerCase();t.appUrl&&(m=c(m,f(t.appUrl,"region")));const w=Jt[m];let g;g=w?w.PodsUrl:m+"/pods/",i.et.updateEnvironment(g);const _=i.et.getValue(J.St,!1),b=i.et.getValue(J.Ft,100),T=_&&b>window.crypto.getRandomValues(new Uint8Array(1))[0]%100,C=i.et.getValue(J.It,!1),P=i.et.getValue(J.bt,!1);let y=S((t.appUrl||"").toLowerCase(),"wdhostscenario","oneuplightspeed")?C:T;"true"===f(t.appUrl||"","wdForceModernEmbedView").toLowerCase()&&(y=!0);let A="editor";A=S(t.appUrl||"","embed","1")&&S(t.appUrl||"","PowerPointView","ChromelessView")||void 0!==t.intent&&-1!==t.intent.indexOf("embed")||"interactivepreview"===t.intent?"embed":null!==(r=i.bootParams)&&void 0!==r&&r.viewOnly||null!==(a=i.bootParams)&&void 0!==a&&a.openViewByDefault&&"default"===(null!==(l=t.intent)&&void 0!==l?l:"default")||"view"===t.intent?"reading":"editor";let R=A;P||"reading"!==R||(R="embed");const W="editor"===A||"embed"===A&&!y;W&&(R="editor");const k="embed"===A?i.et.getValue(J.Ut,"{}"):"reading"===A?i.et.getValue(J.Et,"{}"):"{}";return i.logger.ULS.Ye(507863259,E.B,F.Info,JSON.stringify({requestedUiType:A,actualUiType:R,modernEmbedEnabled:y,modernReadingEnabled:P,intent:t.intent,uiEmbed:i.ui.uiEmbed,viewOnly:null===(u=i.bootParams)||void 0===u?void 0:u.viewOnly,openViewByDefault:null===(p=i.bootParams)||void 0===p?void 0:p.openViewByDefault,featureGates:k})),W?((e,t,i,o,s)=>e!==z.boot?Promise.reject("Wrong flow"):new Promise(e=>{const r=H();if(i.state=U.Booting,i.pendingReboot=!1,Vi(t,i.skipWopiValidation,i.skipFileNameCheck),i.intent=t.intent,i.file=t.file,i.customFontCatalogUrl=t.customFontCatalogUrl,i.wopi=t.wopi,i.contentBundle=t.contentBundle,i.newFileTemplate=t.newFileTemplate,i.ownerId=t.ownerId,i.sessionContext=t.sessionContext,i.actNavId=t.actNavId,i.preseededSession=t.preseededSession,i.throttling=t.throttling,i.meeting=t.meeting,i.tenantId=t.tenantId,i.wdParams=je(t.wdParams),i.pinnedTarget=t.pinnedTarget,i.rebootOverride=t.rebootOverride,i.bootParams=t.bootParams||{},i.hostInitDiagnostics={...t.diagnostics,hostInitializeCallTime:r},i.et.getValue(J.gt,!1)&&Ae(i.hostInitDiagnostics),t.appUrl){const e=t.appUrl;i.appUrl=e;const o=i.bootParams;if(S(e,"new")&&(o.isNewFile=!0),!o.dataLanguage){const t=I(e,"rs");t&&(o.dataLanguage=t)}const s=i.ui;if(S(e,"uiembed")&&(s.uiEmbed=!0),!s.language){const t=I(e,"ui");t&&(s.language=t)}if(!i.hostInitDiagnostics.entryPoint){const t=I(e,"wdorigin");t&&(i.hostInitDiagnostics.entryPoint=t)}if(!i.host.uiHostName){const t=I(e,"uih");t&&(i.host.uiHostName=t)}}else i.appUrl="";i.appBaseUrl=t.appBaseUrl?t.appBaseUrl.toLowerCase():d(t.appUrl).toLowerCase(),i.appBaseUrl=c(i.appBaseUrl,f(i.appUrl,"region")),i.et.updateEnvironment(i.appBaseUrl),o.initializeAppContext(i,e,t),i.appBasePath=o.buildAppBasePath(i);let a=!1;const l=i.preseededSession;i.appInfo.usePreseededSessionId&&l&&l.id&&(i.sessionId=l.id,a=!0);let u=!1;const p=t.hostGeneratedSessionId;let m;if(!a&&p&&(i.sessionId=p,u=!0),t.rebootOverride&&(a||u||([i.sessionId,m]=ne()),i.pageStateObserver=new Ue(i.logger,!0),i.authTokenTrustValidator=new Re(i.logger)),i.logger.ULS.Ye(38580693,E.B,F.Info,`User session id: ${i.sessionId}, is preseeded: ${a}, is host generated: ${u}`),i.remoteTelemetryUrl=o.buildRemoteTelemetryUrl(i),D(i.remoteTelemetryUrl,i.appInfo.name,"init"),!i.isLoggerFromOwl){let e=i.et.getValue(J.st,"").toString();e||(e=h(i.appBasePath)),i.logger.configure({remoteUlsEndpoint:e,sessionId:i.sessionId})}if(i.et.initializePeriodicFetch(i.appBasePath,i.sessionId),m&&i.logger.ULS.Ye(590966790,E.B,F.Info,JSON.stringify(m)),Te(i),o.onContextReady&&o.onContextReady(i),i.appInitDiagnostics={officeSessionId:i.sessionId,officeBootstrapperVersion:O(),hostName:i.hostName,documentLoadedWithTabSwitch:"hidden"===document.visibilityState},document.addEventListener("visibilitychange",()=>{i.appInitDiagnostics.documentLoadedWithTabSwitch=!0},{once:!0}),!i.container){const e=t.container;i.container=e instanceof Je?e:i.application.createContainer(e)}i.container.setMessageHandler(i.onMessage);const w=!!o.ignoreCompletionMessage&&o.ignoreCompletionMessage(i),g=(e,t)=>{i.successTime=H(),w||(i.container.postMessage(q.ps,void 0),Se(i.appInitDiagnostics,t.Diagnostics)),i.et.addSettingsChangeListener(i.logger.settingsChangeHandler),o.onSuccess&&o.onSuccess(i,t),i.logger.ULS.Ye(596448985,E.B,F.Info,JSON.stringify(i.diagnostics)),D(i.remoteTelemetryUrl,i.application.name,"bootSuccess"),i.logger.ULS.flush(),i.container.postMessage(q.Is,{HostInitializeDiagnostics:i.hostInitDiagnostics,ClientDiagnostics:i.clientDiagnostics}),i.state=U.Booted,b({completion:"success"}),Ie(i.appInfo.name,i.logger)},_=(e,t)=>{var s;i.failureTime=H(),o.onFailure&&o.onFailure(i,t.Error),i.logger.ULS.Ye(596448986,E.B,F.Error,JSON.stringify({error:t.Error,diagnostics:i.diagnostics})),D(i.remoteTelemetryUrl,i.application.name,"bootFailure"),i.logger.ULS.flush(),i.state=U.Failed,b({completion:"failure",error:t.Error,errorSource:"app",documentLoadedWithTabSwitch:null===(s=i.appInitDiagnostics)||void 0===s?void 0:s.documentLoadedWithTabSwitch}),Ie(i.appInfo.name,i.logger)},b=t=>{w||(i.bootHeartBeat&&i.bootHeartBeat.stop(),i.removeActionHandler(j.vi,g),i.removeActionHandler(j.wi,_)),e(t)};s&&s.subscribe(()=>{var e;b({completion:s.reason||"cancelled",documentLoadedWithTabSwitch:null===(e=i.appInitDiagnostics)||void 0===e?void 0:e.documentLoadedWithTabSwitch})}),w||(i.addActionHandler(j.vi,g),i.addActionHandler(j.wi,_)),function(e){return"wdjs"in e||"wd1js"in e}(i.wdParams)&&("true"!==window.sessionStorage.getItem("sideLoadingIsEnabled")?Me("sideLoadingIsEnabled","false",0):function(e,t){const i=Ne("sideLoadingIsEnabled");return"true"===i||"false"!==i&&!1}()||Me("sideLoadingIsEnabled","true",1));const T=o.buildBootRequestParams(i),C=Ke(i,T.appPageName,T.queryParamsOverrides),P=Ze(i,T.postDataOverrides);if(i.bootstrapperUrl&&i.preconnector&&i.preconnector.shouldPreconnect(i.hostName)&&i.preconnector.preconnect(i.bootstrapperUrl),i.bootstrapperUrl&&i.preloader&&i.preloader.shouldPreload(C,i.host.origin))try{o.beforePreload&&o.beforePreload(i);let e=i.bootstrapperUrl;i.featureManager.isFeatureEnabled(G.Ht)&&(i.logger.ULS.Ye(590966791,E.B,F.Info,"HTTP2 preload enabled"),e=v(e)),i.preloader.preload(e,i.ui.language,i.logger,i.featureManager)}catch(e){i.logger.ULS.Ye(590966792,E.B,F.Error,"Error preloading")}o.beforeContainerBoot&&o.beforeContainerBoot(i,C),i.appInitDiagnostics.officeFrameCreateTime=H(),i.container.boot(C,P,i.logger,o.buildContainerBootParams(i)),w?g(j.vi,{Diagnostics:{}}):(i.bootHeartBeat=new Li(n(i.appBaseUrl),i.et,i.logger,()=>{var e;i.timeoutTime=H(),o.onTimeout&&o.onTimeout(i),D(i.remoteTelemetryUrl,i.application.name,"bootTimeout"),b({completion:"timeout",error:{documentLoadedWithTabSwitch:null===(e=i.appInitDiagnostics)||void 0===e?void 0:e.documentLoadedWithTabSwitch}}),s&&s.cancel()},s&&o.overrideBootTimeout?Math.min(s.timeoutInMs,o.overrideBootTimeout(i)):s?s.timeoutInMs:o.overrideBootTimeout?o.overrideBootTimeout(i):void 0),o.beforeBootCompletionMessage&&o.beforeBootCompletionMessage(i))}).catch(e=>{throw i.failureTime=H(),o.onException&&o.onException(i,e),i.remoteTelemetryUrl&&D(i.remoteTelemetryUrl,i.application.name,"bootException"),i.bootHeartBeat&&i.bootHeartBeat.stop(),{error:e.toString(),errorStack:e.stack}}))(e,t,i,o,s):new Promise(async e=>{var s,n,r,a,c,d,l,u,p,w,v,_;const b=H();if(i.state=U.Booting,i.pendingReboot=!1,Vi(t,!0),i.intent=t.intent,i.file=t.file,i.customFontCatalogUrl=t.customFontCatalogUrl,i.contentBundle=t.contentBundle,i.newFileTemplate=t.newFileTemplate,i.ownerId=t.ownerId,i.sessionContext=t.sessionContext,i.actNavId=t.actNavId,i.preseededSession=t.preseededSession,i.throttling=t.throttling,i.meeting=t.meeting,i.tenantId=t.tenantId,i.wdParams=je(t.wdParams),i.pinnedTarget=t.pinnedTarget,i.rebootOverride=t.rebootOverride,i.bootParams=t.bootParams||{},i.hostInitDiagnostics={...t.diagnostics,hostInitializeCallTime:b},i.et.getValue(J.Tt,!0)&&(i.wdParams.wdForceModernSlideShowInTeams="true"),i.et.getValue(J.gt,!1)&&Ae(i.hostInitDiagnostics),t.appUrl){const e=t.appUrl;i.appUrl=e;const o=i.bootParams;if(S(e,"new")&&(o.isNewFile=!0),!o.dataLanguage){const t=I(e,"rs");t&&(o.dataLanguage=t)}const s=i.ui;if(S(e,"uiembed")&&(s.uiEmbed=!0),!s.language){const t=I(e,"ui");t&&(s.language=t)}if(!i.hostInitDiagnostics.entryPoint){const t=I(e,"wdorigin");t&&(i.hostInitDiagnostics.entryPoint=t)}if(!i.host.uiHostName){const t=I(e,"uih");t&&(i.host.uiHostName=t)}}else i.appUrl="";i.appBaseUrl=m,i.appBasePath=g,i.remoteTelemetryUrl=o.buildRemoteTelemetryUrl(i),D(i.remoteTelemetryUrl,i.appInfo.name,"init");let T=i.et.getValue(J.st,"").toString();""===T&&(T=h(i.appBasePath)),i.logger.configure({remoteUlsEndpoint:T,sessionId:i.sessionId}),i.et.initializePeriodicFetch(i.appBasePath,i.sessionId),Te(i),i.appInitDiagnostics={officeSessionId:i.sessionId,officeBootstrapperVersion:O(),hostName:i.hostName,documentLoadedWithTabSwitch:"hidden"===document.visibilityState},document.addEventListener("visibilitychange",()=>{i.appInitDiagnostics.documentLoadedWithTabSwitch=!0},{once:!0});const C=(t,o)=>{i.failureTime=H(),i.logger.ULS.Ye(596448986,E.B,F.Error,JSON.stringify({diagnostics:i.diagnostics})),D(i.remoteTelemetryUrl,i.application.name,"bootFailure"),i.logger.ULS.flush(),i.state=U.Failed,e({completion:"failure",error:{...t,errorSource:o}}),Ie(i.appInfo.name,i.logger)};try{if(!i.bootstrapperUrl)throw new Error("No bootstrapperUrl");const e=new URL(m).hostname;if(!e.includes("powerpoint"))throw new Error("Invalid appBaseUrl");const t=Gt[m];if(i.logger.ULS.Ye(507357262,E.B,F.Info,JSON.stringify({appBaseUrl:e,previewerRing:t})),!t)throw new Error("Unsupported region");const o=new URL(i.bootstrapperUrl);o.hostname=o.hostname.replace("wise.","res."),o.hostname=o.hostname.replace(".gcc.",".gcch."),o.pathname=`/pptlive-m/5mttl/bootstrap/${t}/powerpoint.preview.boot.js`;const s=async e=>new Promise((t,i)=>{const o=document.createElement("script");o.src=e.href,o.async=!0,o.onload=()=>{t()},o.onerror=e=>{i(e)},document.head.appendChild(o)});await s(o)}catch(e){return void C(e,"JsApi")}if(null===(s=window)||void 0===s||null===(s=s.Microsoft)||void 0===s||null===(s=s.Office)||void 0===s||null===(s=s.PowerPoint)||void 0===s||null===(s=s.Bootstrap)||void 0===s||!s.InitializeWopiPending)return void C(new Error("InitializeWopiPending not found"),"JsApi");const P=parseInt(f(t.appUrl||"","wdslideindex"),10),y={ApplicationUrl:i.appUrl,Container:t.container,SessionInformation:{HostName:i.hostName,HostSessionId:i.hostSessionId,UserId:i.user.id,DocumentClickTime:null===(n=i.hostInitDiagnostics)||void 0===n?void 0:n.userClickTime,EntryPoint:null===(r=i.hostInitDiagnostics)||void 0===r?void 0:r.entryPoint,HostInitTime:(new Date).toISOString(),WdParams:i.wdParams,UiHostRing:null==t||null===(a=t.diagnostics)||void 0===a?void 0:a.teamsRing,PptFeatureGates:k,UiLocale:i.ui.language},WopiPrecheckInfo:{FileName:i.file.name,FileGetUrl:i.file.getUrl,FileSize:i.file.size,ReadOnly:null===(c=i.bootParams)||void 0===c?void 0:c.readOnly,IrmEnabled:null===(d=i.bootParams)||void 0===d?void 0:d.irmEnabled,DocUniqueId:i.file.uniqueId,CTag:i.file.cTag,ETag:i.file.cTag,ViewOnly:null===(l=i.bootParams)||void 0===l?void 0:l.viewOnly},ApplicationCustomSettings:{ForceAccessibilityMode:!1,EnableWacFallback:!1,UseTransparentBackground:!1,UiType:R,StartingSlideIndex:!isNaN(P)&&P>=0?P:-1},Diagnostics:{entryPoint:null===(u=i.hostInitDiagnostics)||void 0===u?void 0:u.entryPoint,userClickTime:null===(p=i.hostInitDiagnostics)||void 0===p?void 0:p.userClickTime,hostPageFirstFlushTime:null===(w=i.hostInitDiagnostics)||void 0===w?void 0:w.hostPageFirstFlushTime,officeBootstrapperStartTime:null===(v=i.hostInitDiagnostics)||void 0===v?void 0:v.officeBootstrapperStartTime,officeBootstrapperEndTime:null===(_=i.hostInitDiagnostics)||void 0===_?void 0:_.officeBootstrapperEndTime},FnOnInitializeSuccess:()=>{i.successTime=H(),i.logger.ULS.Ye(596448985,E.B,F.Info,JSON.stringify(i.diagnostics)),D(i.remoteTelemetryUrl,i.application.name,"bootSuccess"),i.logger.ULS.flush(),Ie(i.appInfo.name,i.logger),i.state=U.Booted,e({completion:"success"})},FnOnInitializeFailure:e=>{C(e,"App")}};window.Microsoft.Office.PowerPoint.Bootstrap.InitializeWopiPending(y).Complete()})},$i=(e,t,i,o,s)=>e!==j.po?Promise.reject("Wrong flow"):new Promise(e=>{const o=i.appContext;"FatalError"===t.Reason?function(e,t){const i=e.hostInitDiagnostics,o={ErrorName:t,BootCompleted:e.appContext.bootComplete,SessionInfo:{HostName:e.hostName,HostSessionId:e.hostSessionId,UiLocale:e.ui.language,DataLocale:e.bootParams.dataLanguage,DocumentClickTime:i.userClickTime,HostInitTime:i.hostInitializeCallTime,UiHost:e.host.uiHostName,WdParams:e.wdParams}};e.logger.ULS.Ye(587236555,E.B,F.Error,JSON.stringify(o))}(i,t.ErrorName):i.logger.ULS.Ye(558421913,E.B,F.Info,`Updating boot complete - reason [${t.Reason}]`),o.bootComplete||(i.bootHeartBeat&&i.bootHeartBeat.stop(),o.bootFlowResolve({completion:"success"})),i.successTime=H(),ki(i),e({completion:"success"})}),zi=()=>[{[$.appReboot]:Bi,[$.boot]:Gi,[$.closeTab]:$e,[$.createNew]:Xe,[$.dispose]:tt,[$.frameTrust]:it,[$.getAuthToken]:ot,[$.getHostKeyValue]:$e,[$.handleBootState]:st,[$.postWacToken]:nt,[$.rename]:rt,[$.setOverlayContent]:at,[$.setWacFlightValue]:ct,[$.storeHostKeyValue]:$e,[$.switchMode]:$e,[$.updateBootComplete]:$i},{[$.boot]:{initializeAppContext:Qt,buildAppBasePath:Yt,buildRemoteTelemetryUrl:ei,ignoreCompletionMessage:ti,buildBootRequestParams:vi,beforeContainerBoot:Si,buildContainerBootParams:Pi,overrideBootTimeout:Ri,onSuccess:Wi,onFailure:Ni,onTimeout:Mi,onException:Di},[$.createNew]:{parallelizeStartSessionRequest:xi,sendCreateNewWopiInfo:Hi}}];var ji;!function(e){e[e.AppPageLoading=0]="AppPageLoading",e[e.AppReadyForPostMessage=1]="AppReadyForPostMessage",e[e.AppBootComplete=2]="AppBootComplete",e[e.DEPRECATED=3]="DEPRECATED",e[e.RefreshPage=4]="RefreshPage",e[e.UpdateInitializationComplete=6]="UpdateInitializationComplete",e[e.ProfileClientResourceUsage=7]="ProfileClientResourceUsage",e[e.ULSLog=8]="ULSLog"}(ji||(ji={}));class qi{static getInstance(){return this.aa||(this.aa=new qi),this.aa}add(e,t){this.ca[e]=t}get(e){return this.ca[e]}remove(e){this.ca[e]=null}constructor(){this.ca={},this.da=(e,t)=>{for(const i in this.ca){const o=this.ca[i];o&&o.log(e,t)}},this.la=e=>{let t;try{t=JSON.parse(e.data)}catch(e){t=null}if(!t)return;const i=t.m_id||t.Token;if(!i)return;const o=qi.getInstance(),s=o.get(i);s?s.onMessage(t,e.source):o.da("Message received with no targetApi. Id: "+i.toString(),e.data)},window.addEventListener("message",this.la)}}function Ki(e,t,i,o){return{ShouldUsePODS:e,CanUsePODS:t,Reason:i,CreateNewScenario:o}}function Zi(e,t){const i=e.WopiPrecheckInfo,o=e.ApplicationUrl,s=function(e,t,i,o){let s,n;e.CreateNewInfo?(n=dt.UnifiedCreateNew,s="CreateNewInfo"):e.IsNewFile?(n=dt.UnifiedCreateNew,s="CreateNewInfoIsNewFile"):e.IsNewFileFromHostTemplate?(n=dt.UnifiedCreateNew,s="CreateNewInfoFromHostTemplate"):i&&i.FileGetUrl?(n=dt.UnifiedCreateNew,s="CreateNewInfoFromTemplateSourceUrl"):S(t,"new")?0!==e.FileSize?(n=dt.LegacyCreateNew,s="ApplicationUrlContainsNewAndNonZeroByteFile"):(n=dt.UnifiedCreateNew,s="ApplicationUrlContainsNew"):(n=dt.NotCreateNew,s="NotCreateNew");const r={};return r.CreateNewScenario=dt[n],r.reason=s,o.ULS.Ye(34932951,E.B,F.Info,JSON.stringify(r)),n}(i,o,e.NewFileTemplateSource,t),n=_("wdPodsEnabled");return r=i.FileGetUrl,a=n?Ki("false"!==n,!0,"wdPodsEnabled is available",s):function(e,t,i){if(zt(e))return t===dt.LegacyCreateNew?Ki(!1,!1,"Legacy Create New Scenario because application url contains new, but non-zero file size",t):-1!==e.indexOf("&Embed=1")?Ki(!1,!1,"Embed View fallback to WAC",t):Ki(!0,!0,"Supported Region",t);const o="Wac region not currently supported by PODS: "+(P(e)||"");return i.ULS.Ye(589168768,E.B,F.Warning,o),Ki(!1,!1,o,t)}(o,s,t),r||a.CreateNewScenario!==dt.NotCreateNew?a:Ki(!1,!1,a.Reason+"| FileGetUrl is empty",a.CreateNewScenario);var r,a}class Xi{registerEventHandler(e){this.ha.push(e)}removeEventHandler(e){if(e){const t=this.ha.indexOf(e);this.ha.splice(t,1)}}stop(){document.removeEventListener("visibilitychange",this.ua)}getVisibilityChangeEvents(){return this.pa}dispose(){this.stop(),this.ha=[],this.pa=[]}constructor(){if(this.pa=[],this.ha=[],this.ua=()=>{const e={visibility:document.visibilityState,time:H(),initialState:!1};this.pa.push(e);for(const t of this.ha)t&&t(e)},"hidden"===document.visibilityState){const e={visibility:document.visibilityState,time:H(),initialState:!0};this.pa.push(e)}document.addEventListener("visibilitychange",this.ua)}}const Qi={[z.blurFocus]:q.hs,[z.continueAccessibilityLoop]:q.ws,[z.grabFocus]:q.gs,[z.moveToFolder]:q.Gi,[z.popState]:q.bs,[z.rename]:q.Fs,[z.sendAccessToken]:q.Rs,[z.sendAuthToken]:q.Ws,[z.sendCustomAuthConfig]:q.Os,[z.sendEmbeddedViewUrl]:q.Ns,[z.sendSessionInfo]:q.Ms,[z.sendUserAccessAndPermissions]:q.Ds,[z.sendWopiInfo]:q.xs,[z.sendDavUrl]:q.Hs,[z.completeSharedFilePicker]:q.io,[z.switchMode]:q.$s,[z.signalShared]:q.Ks};class Yi{registerMessagePayloadHandler(e,t){if(this.ha[e])throw new Error("Duplicate registration!");this.ha[e]=t}removeMessageHandler(e){delete this.ha[e]}sendPostMessage(e,t,i){if(!e||!e.contentWindow)return void this.ci.ULS.Ye(595948308,E.B,F.Info,"Missing target for SendPostMessage");this.ci.ULS.Ye(596464334,E.B,F.Info,"Sending message: "+t);const o={MessageId:t,SendTime:H(),Values:i};this.fa(e.contentWindow,JSON.stringify(o),this.In)}activate(e,t){this.ma=e,this.Pn=!!t,this.wa||(window.addEventListener("message",this.ga,!1),this.wa=!0)}postMessageForCommand(e,t,i){const o=Qi[t];o?(this.ci.ULS.Ye(595702598,E.B,F.Info,`Sending message ${o} for command ${t}`),this.sendPostMessage(e,o,i)):this.ci.ULS.Ye(595702599,E.B,F.Warning,"No mapping for command "+t)}dispose(){this.ha={},this.wa&&(window.removeEventListener("message",this.ga,!1),this.wa=!1)}constructor(e,t){var i;if(this.wa=!1,this.ha={},this.In="",this._n="",this.Pn=!1,this.bn=!1,this.Tn=!1,this.Un=!1,this.va=[],this.Sa=!0,this.Ia=(e,t,i)=>{if(!e)return void this.ci.ULS.Ye(595736136,E.B,F.Info,"Missing target to send Ack back");const o={MessageId:q.cs,CorrelationId:i,SendTime:H()};this.ci.ULS.Ye(595732176,E.B,F.Info,"Sending Ack back"),e.postMessage(JSON.stringify(o),t)},this.ga=e=>{let t,i=!1,o=!0,s="",n=!1;if(this.ma&&this.ma.contentWindow&&(i=!0,o=e.source===this.ma.contentWindow),e.origin&&(s=l(e.origin,2).toLowerCase(),n=s===this._n,!n&&this.En&&(s=l(e.origin).toLowerCase(),n=this.En.includes(s))),!this.bn&&(!this.Tn||n&&o)||this.ci.ULS.Ye(595730526,E.B,F.Info,`Window is available: ${i}, window is valid: ${o}, origin is valid: ${n}, expected origin: ${this._n}, actual origin: ${s}`),!n||this.Pn&&!o)return;try{t=JSON.parse(e.data)}catch(e){return void this.ci.ULS.Ye(596464282,E.B,F.Info,`Failed to parse event data: ${Y(e)}.`)}const r=t.MessageId;if(!r)return void((this.bn||this.Tn)&&this.ci.ULS.Ye(595730520,E.B,F.Info,"Could not find message id"));var a;if(this.ci.ULS.Ye(595714715,E.B,F.Info,`Received messageId: ${r}, correlation: ${t.CorrelationId}`),r!==j.vi&&r!==j.Li||this._a(e.origin),this.Un&&r===j.es)return window._pageTimings=null!==(a=window._pageTimings)&&void 0!==a?a:{},void(window._pageTimings[t.Values.name]=t.Values.time);t.Values&&t.Values.ackExpected&&this.Ia(e.source,e.origin,t.CorrelationId);const c=this.ha[r];if(!c)return this.ci.ULS.Ye(596464289,E.B,F.Info,"No handler found for message id: "+r),void(this.Sa&&r===j.Di&&(this.va.push(t),this.ci.ULS.Ye(543207888,E.B,F.Info,"Kept for later process: "+r)));this.ci.ULS.Ye(596464288,E.B,F.Info,"Processing message: "+r),r===j.ro&&(t.Values={...t.Values||{},sendTimeAsClickTime:t.SendTime});try{c(t.Values||{})}catch(e){this.ci.ULS.Ye(593773704,E.B,F.Error,"Handler error: "+Y(e))}},this.ba=()=>{this.Sa=!1,this.va.forEach(e=>{const t=e.MessageId,i=this.ha[t];if(i){this.ci.ULS.Ye(543207890,E.B,F.Info,"Processing message after boot complete: "+t);try{i(e.Values||{})}catch(e){this.ci.ULS.Ye(543207891,E.B,F.Error,"Handler error: "+Y(e))}}else this.ci.ULS.Ye(543207889,E.B,F.Info,"No handler found after boot complete: "+t)}),this.va=[]},this.fa=(e,t,i)=>{e.postMessage(t,i)},this._a=e=>{const t=e.toLowerCase();this.In&&this.In!==t&&this.ci.ULS.Ye(596128131,E.B,F.Warning,`Updating origin: [${P(this.In)}]->[${P(t)}]`),this.In=t,this._n=l(t,2),this.bn=n(t),this.Tn=r(t)},!e)throw new Error("Missing origin for PostMessageHandler");this.bn=n(e),this.Tn=r(e),this.ci=t,this._a(e),this.Un=!(null===(i=window.location)||void 0===i||null===(i=i.search)||void 0===i||!i.match(/wdpa=1/gi))||"1"===Ne("EnableMetricLogging")}}var eo;!function(e){e.BrowserEvent="BrowserEvent",e.AcquireOAuthTokenTeams="AcquireOAuthTokenTeams",e.PageChanged="PageChanged",e.ZoomChanged="ZoomChanged",e.ContentRefreshBegin="ContentRefreshBegin",e.ContentRefreshEnd="ContentRefreshEnd",e.AppClosed="UI_Close",e.UserEdit="Edit_Notification",e.FileRename="File_Rename",e.FileShare="UI_Sharing",e.ShowFileVersions="UI_FileVersions",e.UIWorkflow="UI_Workflow",e.IsDisabled="IsDisabled",e.AccessibilityLoopComplete="App_AccessibilityLoopComplete",e.Unloaded="Unloaded",e.Disposed="Disposed",e.SwitchMode="App_SwitchMode",e.DocumentReboot="DocReboot",e.WopiInfoFromUrl="WopiInfoFromUrl",e.DavUrlFromIds="DavUrlFromIds",e.ModeSwitched="ModeSwitched",e.CreateNewDocument="App_CreateNewDocument",e.GetAuthToken="GetAuthToken",e.GetCustomAuthConfig="GetCustomAuthConfig",e.SetOverlayContent="SetOverlayContent",e.MoveToFolder="MoveToFolder",e.SharedFilePicker="SharedFilePicker"}(eo||(eo={}));let to=!1,io=!1;function oo(e){if(!to)try{to=!0,io=!1,function(e){e.innerApplicationFrame&&(e.innerApplicationFrame.src="about:blank",window.setTimeout(()=>{e.innerApplicationFrame&&e.innerApplicationFrame.parentElement&&e.innerApplicationFrame.parentElement.removeChild(e.innerApplicationFrame),e.onFrameRemoved&&e.onFrameRemoved()},0))}(e),function(e){const t={disposeStartTime:e.disposeStartTime,disposeEndTime:H(),forceAppUnload:e.forceAppUnload,appUnloadTimedOut:e.appUnloadTimedOut};if(e.forceAppUnloadStartTime&&(t.appUnloadStartTime=e.forceAppUnloadStartTime),e.forceAppUnloadEndTime&&(t.appUnloadEndTime=e.forceAppUnloadEndTime),e.appUnloadedMessageValues){const i=e.appUnloadedMessageValues,o=Number(i.hostMessageReceived);e.forceAppUnloadStartTime&&!isNaN(o)&&(t.hostToAppPostMessageLatency=o-e.forceAppUnloadStartTime);const s=Number(i.appMessageSent);!isNaN(s)&&e.forceAppUnloadEndTime&&(t.appToHostPostMessageLatency=e.forceAppUnloadEndTime-s);const n=Number(i.appUnloadStart),r=Number(i.appUnloadEnd);if(isNaN(n)||isNaN(r)||(t.appUnloadLatency=r-n),i.serverTimings){const e=i.serverTimings;for(const i in e)t["st-"+i.toString()]=e[i]}}e.logger.ULS.Ye(595855436,E.B,F.Info,"App disposed "+JSON.stringify(t)),e.logger.ULS.flushOnClose()}(e),e.onDisposed&&e.onDisposed()}catch(t){e.logger.ULS.Ye(595714434,E.B,F.Error,"Error disposing: "+Y(t))}}class so extends class{GetApplicationType(){return"PowerPoint"}GetVersion(){return O()}GetSessionId(){return this.zr}RegisterEventHandler(e,t){switch(e){case eo.Unloaded:case eo.Disposed:case eo.DocumentReboot:case eo.WopiInfoFromUrl:case eo.DavUrlFromIds:case eo.GetAuthToken:case eo.GetCustomAuthConfig:case eo.MoveToFolder:case eo.SharedFilePicker:case eo.SetOverlayContent:case eo.FileShare:if(this.ha[e])throw new Error("Duplicate registration");this.ha[e]=t;break;default:this.Ta.registerMessagePayloadHandler(e,t)}}RemoveEventHandler(e,t){switch(e){case eo.Unloaded:case eo.Disposed:case eo.DocumentReboot:case eo.FileShare:case eo.WopiInfoFromUrl:case eo.DavUrlFromIds:case eo.GetAuthToken:case eo.GetCustomAuthConfig:case eo.MoveToFolder:case eo.SharedFilePicker:case eo.SetOverlayContent:if(this.ha[e]!==t)throw new Error("The handler requested to be removed does not exist for the eventType");delete this.ha[e];break;default:this.Ta.removeMessageHandler(e)}}RegisterErrorHandler(e){}RemoveErrorHandler(e){}PostCommand(e,t){this.Ta.postMessageForCommand(this.ma,e,t)}Dispose(e,t){!function(e,t,i,o,s,n,r){if(t.ULS.Ye(595714433,E.B,F.Info,`Starting disposing the application. unloadApp:${e}; disposed:${to}; unloading:${io}`),to||io&&e)return void t.ULS.Ye(595714908,E.B,F.Info,"Application is already disposed or unloading");const a={logger:t,postMessenger:i,innerApplicationFrame:o,onDisposed:s,onFrameRemoved:n,unloadTimeoutInMs:r||1e3,forceAppUnload:!1,disposeStartTime:H(),appUnloadTimedOut:!1};if(e&&o)return io=!0,a.forceAppUnload=!0,(c=a).forceAppUnloadStartTime=H(),c.logger.ULS.Ye(595855490,E.B,F.Info,"Sending postmessage to unload app"),c.logger.ULS.flush(),c.postMessenger.registerMessagePayloadHandler(j.lo,e=>function(e,t){e.forceAppUnloadEndTime=H(),e.appUnloadedMessageValues=t,e.logger.ULS.Ye(595855491,E.B,F.Info,"AppUnloaded received from app"),oo(e)}(c,e)),c.postMessenger.sendPostMessage(c.innerApplicationFrame,q.zs,{}),void window.setTimeout(()=>function(e){!io&&to||(e.appUnloadTimedOut=!0,e.logger.ULS.Ye(595855492,E.B,F.Info,"ApplicationUnload timed out, forcing dispose"),oo(e))}(c),c.unloadTimeoutInMs);var c;oo(a)}(e||!1,this.ci,this.Ta,this.ma,()=>{delete this.ma,this.Ca(),this.Ta.dispose(),this.Pa(eo.Unloaded,{})},()=>{try{this.Pa(eo.Disposed,{}),this.ha={}}catch(e){this.ci.ULS.Ye(589108815,E.B,F.Error,"onFrameRemoved error: "+Y(e))}},t)}constructor(e,t,i,o,s){this.ha={},this.ya=()=>{this.Ta.registerMessagePayloadHandler(j.Xi,this.Aa),this.Ta.registerMessagePayloadHandler(j.Bi,this.Ua),this.Ta.registerMessagePayloadHandler(j.Vi,this.Ea),this.Ta.registerMessagePayloadHandler(j.Di,this.Fa),this.Ta.registerMessagePayloadHandler(j.ro,this.Ra),this.Ta.registerMessagePayloadHandler(j.xi,this.Wa),this.Ta.registerMessagePayloadHandler(j.Gi,this.Oa),this.Ta.registerMessagePayloadHandler(j.io,this.ka)},this.Pa=(e,t)=>{const i=this.ha[e];if(i)try{i(t||{})}catch(e){this.ci.ULS.Ye(593773706,E.B,F.Error,"Handler error: "+Y(e))}},this.Aa=e=>{e.previousSessionId=this.zr,this.Pa(eo.DocumentReboot,e)},this.Ua=e=>{this.Pa(eo.WopiInfoFromUrl,e)},this.Ea=e=>{this.Pa(eo.DavUrlFromIds,e)},this.Fa=e=>{Promise?this.Na.isResourceTrustedForMessage(e).then(t=>{t?this.Pa(eo.GetAuthToken,e):this.Ta.sendPostMessage(this.ma,q.Ws,{AuthToken:"",Error:"accessDenied",RequestId:e.RequestId,IdentityType:e.IdentityType})},()=>{this.Ta.sendPostMessage(this.ma,q.Ws,{AuthToken:"",Error:"Exception encountered in AuthTokenTrustValidator.isResourceTrustedForMessage",RequestId:e.RequestId,IdentityType:e.IdentityType})}):this.Ta.sendPostMessage(this.ma,q.Ws,{AuthToken:"",Error:'"Promise" does not exist natively in browser',RequestId:e.RequestId,IdentityType:e.IdentityType})},this.Ra=e=>{this.Pa(eo.FileShare,e)},this.Wa=e=>{this.Pa(eo.GetCustomAuthConfig,e)},this.Oa=e=>{this.Pa(eo.MoveToFolder,e)},this.ka=e=>{this.Pa(eo.SharedFilePicker,e)},this.zr=e,this.ci=t,this.ma=s.innerApplicationFrame,this.Ta=i,this.Ca=o,this.Na=new Re(t),this.ya(),to=!1}}{Dispose(e,t){if(!(this.Ma||this.Da&&e))if(this.xa.disposeStartTime=H(),e){this.Da=!0,this.xa.appUnloadStartTime=H(),this.xa.forceAppUnload=e,this.Ta.sendPostMessage(this.ma,q.zs,{});const i=t||1e3;window.setTimeout(this.Ha,i)}else this.Ba()}constructor(e,t,i,o,s){super(e,t,i,o,s),this.xa={},this.Da=!1,this.Ma=!1,this.Ba=()=>{this.Ma||(this.Ma=!0,this.Da=!1,this.Ca&&this.Ca(),this.Pa(eo.Unloaded,{}),this.Pa(eo.Disposed,{}),this.xa.disposeEndTime=H(),this.ci.ULS.Ye(41710159,E.B,F.Info,JSON.stringify(this.xa)),this.ha={})},this.Va=e=>{this.xa.appUnloadEndTime=H(),e&&(this.xa.wacDisposeTelemetry=e),this.Ba()},this.Ha=()=>{!this.Da&&this.Ma||(this.ci.ULS.Ye(41710160,E.B,F.Warning,"Unload timed out"),this.xa.appUnloadTimedOut=!0),this.Ba()},this.Ta.registerMessagePayloadHandler(j.lo,this.Va)}}class no{getIfAllFieldsSet(){if(this.wopiInfo&&this.hasAppBooted&&this.iframe&&this.podsUrl)return{wopiInfo:this.wopiInfo,iframe:this.iframe,podsUrl:this.podsUrl,readonly:this.readonly,hasAppBooted:this.hasAppBooted,irmEnabled:this.irmEnabled,supportsDecryptedContentDownload:this.supportsDecryptedContentDownload,fileName:this.fileName}}constructor(){this.hasAppBooted=!1}}class ro{log(e){this.ci.ULS.Ye(39978262,E.B,F.Info,e)}onMessage(e,t){try{if(!e||!this.La)return void this.ci.ULS.Ye(39978263,E.B,F.Error,"Missing message data: "+!e+" or appData: "+!this.La);switch(this.Ja&&this.Ja.contentWindow===t||this.ci.ULS.Ye(39978264,E.B,F.Error,"Message with the right postMessageToken came from an unexpected iframe"),!e.Data.officeSessionId&&this.La.AppInitDiagnostics.officeSessionId&&(e.Data.officeSessionId=this.La.AppInitDiagnostics.officeSessionId),e.Data.messageType||(e.Data.messageType=e.Type),this.ci.ULS.Ye(38580691,E.B,F.Warning,JSON.stringify(e.Data)),e.Type){case ji.AppPageLoading:break;case ji.AppReadyForPostMessage:this.Ga&&(this.Ga.hasAppBooted=!0),e.Data.officeSessionId&&(this.La.AppInitDiagnostics.officeSessionId=e.Data.officeSessionId),window.setTimeout(this.$a,1);break;case ji.AppBootComplete:if(this.za=!0,this.La.PptInitParams.FnOnInitializeSuccess){this.La.AppInitDiagnostics.officeBootstrapperVersion=O(),e.Data.officeAppEndpoint&&(this.La.AppInitDiagnostics.officeAppEndpoint=e.Data.officeAppEndpoint),e.Data.officeServerVersion&&(this.La.AppInitDiagnostics.officeServerVersion=e.Data.officeServerVersion),e.Data.documentLoadedTime&&(this.La.AppInitDiagnostics.documentLoadedTime=e.Data.documentLoadedTime,this.La.AppInitDiagnostics.appCompletedTime=e.Data.documentLoadedTime),e.Data.officeFrameFirstFlushTime&&(this.La.AppInitDiagnostics.officeFrameFirstFlushTime=e.Data.officeFrameFirstFlushTime),e.Data.officeFrameDocumentFlushTime&&(this.La.AppInitDiagnostics.officeFrameDocumentFlushTime=e.Data.officeFrameDocumentFlushTime),e.Data.documentFlushTime&&(this.La.AppInitDiagnostics.officeFrameServerDocumentFlushTime=e.Data.documentFlushTime),e.Data.serverFirstFlushTime&&(this.La.AppInitDiagnostics.officeFrameServerFirstFlushTime=e.Data.serverFirstFlushTime),e.Data.serverStartTime&&(this.La.AppInitDiagnostics.officeFrameServerStartTime=e.Data.serverStartTime),e.Data.bootStartMs&&(this.La.AppInitDiagnostics.officeServerDocumentProcessStartTime=e.Data.bootStartMs),e.Data.bootEndMs&&(this.La.AppInitDiagnostics.officeServerDocumentProcessEndTime=e.Data.bootEndMs),e.Data.cacheHit&&(this.La.AppInitDiagnostics.cacheHit=e.Data.cacheHit);const t={browserRequest:!1,status:200,isAppCompleteCritical:!0,isDocumentLoadCritical:!0,name:"BootRequest"};e.Data.downloadCorrelation&&(t.correlationId=e.Data.downloadCorrelation),e.Data.downloadStartMs&&(t.startTime=e.Data.downloadStartMs),e.Data.downloadEndMs&&(t.endTime=e.Data.downloadEndMs),e.Data.downloadSize&&(t.size=e.Data.downloadSize),e.Data.incDownload&&(t.incremental=e.Data.incDownload),this.La.AppInitDiagnostics.fileRequestsData=[t],this.ja.stop();const i=this.ja.getVisibilityChangeEvents();if(i&&i.length>0&&(this.La.AppInitDiagnostics.documentLoadedWithTabSwitch=!0,this.ci.ULS.Ye(38580692,E.B,F.Info,"Visibility Change Events:"+JSON.stringify(i))),this.ci.ULS.Ye(34932955,E.B,F.Warning,JSON.stringify(this.La.AppInitDiagnostics)),!this.Rr)throw this.ci.ULS.Ye(51448022,E.B,F.Warning,"PPTUnifiedSessionLoader::onMessage::AppBootComplete null m_postMessageHandler"),Error("m_postMessageHandler");this.qa=new so(this.La.PptInitParams.PostMessageToken,this.ci,this.Rr,this.Ka,{innerApplicationFrame:this.Ja}),this.La.PptInitParams.FnOnInitializeSuccess(this.qa,this.La.AppInitDiagnostics),this.Rr.ba()}break;case ji.RefreshPage:{if(this.La.PptInitParams.ApplicationUrl.toLowerCase().indexOf("uiembed=1")>-1&&this.La.PptInitParams.SessionInformation.SupportsDocReboot)break;let t=window.location.href;-1!==t.indexOf("&wdccsoff=1")&&(t=g(t,"wdccsoff")),e.Data.officeSessionId&&(t=qt(t,"PreviousSessionID",e.Data.officeSessionId)),e.Data.ControllerServicesParam&&(t=qt(t,e.Data.ControllerServicesParamName,e.Data.ControllerServicesParam)),this.ci.ULS.Ye(594068673,E.B,F.Info,"PPTUnifiedSessionLoader::onMessage::RefreshPage Updating window.location.href"),window.location.href=t;break}case ji.UpdateInitializationComplete:try{if("FatalError"===e.Data.Reason){const t={ErrorName:e.Data.ErrorName,BootCompleted:this.za,SessionInfo:ui(this.La.PptInitParams)};this.ci.ULS.Ye(587236555,E.B,F.Error,JSON.stringify(t))}else this.ci.ULS.Ye(576583120,E.B,F.Info,"PPTUnifiedSessionLoader::onMessage::UpdateInitializationComplete - Reason: "+e.Data.Reason)}catch(e){this.ci.ULS.Ye(576582732,E.B,F.Error,"PPTUnifiedSessionLoader::onMessage::UpdateInitializationComplete Caught exception: "+e)}this.Rr||(this.ci.ULS.Ye(51448024,E.B,F.Info,"PPTUnifiedSessionLoader::onMessage::AppBootComplete null m_postMessageHandler"),this.Rr=new Yi(d(this.La.PptInitParams.ApplicationUrl),this.ci),this.Rr.activate(this.Ja)),this.qa=new so(this.La.PptInitParams.PostMessageToken,this.ci,this.Rr,this.Ka,{innerApplicationFrame:this.Ja}),this.La.PptInitParams.FnOnInitializeSuccess(this.qa,this.La.AppInitDiagnostics),this.Rr.ba();break;case ji.ProfileClientResourceUsage:this.ci.ULS.Ye(541388952,E.B,F.Info,JSON.stringify(e.Data));break;case ji.ULSLog:{const t=e.Data;if(!t||"number"!=typeof t.Tag||"number"!=typeof t.Category||"number"!=typeof t.Level||"string"!=typeof t.Message)break;try{this.ci.ULS.Ye(t.Tag,t.Category,t.Level,t.Message)}catch(e){this.ci.ULS.Ye(512235073,E.B,F.Error,"PPTUnifiedSessionLoader::onMessage ULSLog exception: "+e)}break}}}catch(e){this.ci.ULS.Ye(594121922,E.B,F.Error,"PPTUnifiedSessionLoader::onMessage Caught exception: "+e)}}getWopiPendingApplication(){return this.Za}constructor(e,t,i,o,s){this.Ga=new no,this.za=!1,this.ja=new Xi,this.Ka=()=>{const e=qi.getInstance();e&&this.La&&e.remove(this.La.PptInitParams.PostMessageToken),this.Rr&&this.Rr.dispose(),this.Ja&&this.Ja.parentElement&&this.Ja.parentElement.removeChild(this.Ja),this.Ja&&delete this.Ja,this.Xa(),this.ci.ULS.Ye(587552790,E.B,F.Warning,"PPTUnifiedSessionLoader::dispose:: App dispose"),this.ja.stop()},this.$a=()=>{var e;const t=this.Ga&&this.Ga.getIfAllFieldsSet();if(this.Qa||!t||!t.iframe.contentWindow)return;const i={};i.WopiSrc=t.wopiInfo.WopiSrc,i.AccessToken=t.wopiInfo.AccessToken,i.AccessTokenTTL=t.wopiInfo.AccessTokenExpiry?t.wopiInfo.AccessTokenExpiry.getTime():0,i.ReadOnly=t.readonly,i.IrmEnabled=t.irmEnabled,i.SupportsDecryptedContentDownload=t.supportsDecryptedContentDownload,i.FileName=t.fileName,i.SessionContext=this.Ya,i.WdParams=this.ec,i.DocumentURL=window.location.href,t.wopiInfo.WacToken&&(i.WacToken=t.wopiInfo.WacToken);const o=_("PreviousSessionID");var s;o&&(i.PreviousSessionID=o),(null===(e=this.La)||void 0===e||null===(e=e.PptInitParams)||void 0===e||null===(e=e.SessionInformation)||void 0===e?void 0:e.HostSessionId)&&(i.HostSessionId=null===(s=this.La)||void 0===s?void 0:s.PptInitParams.SessionInformation.HostSessionId),this.tc(i),t.iframe.contentWindow.postMessage(JSON.stringify(i),t.podsUrl),this.Qa=!0},this.tc=e=>{var t,i,o,s;const n=null!==(t=window.WOPIPerf_FirstPageFlush)&&void 0!==t?t:null===(i=this.La)||void 0===i||null===(i=i.AppInitDiagnostics)||void 0===i?void 0:i.hostPageFirstFlushTime;n&&(e.FirstPageFlushTime=n);const r=window.WOPIPerf_BootJsStartTime;r&&(e.BootJsStartTime=r);const a=window.WOPIPerf_BootJsEndTime;a&&(e.BootJsEndTime=a);const c=window.WOPIPerf_InitializeWac;c&&(e.InitializeWacTime=c);const d=window.WOPIPerf_UserClick,l=this.La&&this.La.AppInitDiagnostics&&this.La.AppInitDiagnostics.userClickTime;if(d?e.UserClickTime=d:l&&(e.UserClickTime=l),window.performance){const t=window.performance.timing;t&&(e.NavigationStart=t.navigationStart,e.FetchStart=t.fetchStart,e.RequestStart=t.requestStart,e.ResponseStart=t.responseStart,e.ResponseEnd=t.responseEnd);const i=window.performance.navigation;i&&(e.NavigationType=i.type,e.NavigationRedirects=i.redirectCount)}e.UnifiedUiHostDiagnostics=null===(o=this.La)||void 0===o||null===(o=o.AppInitDiagnostics)||void 0===o?void 0:o.unifiedUiHostDiagnostics,e.ClientDiagnostics=null===(s=this.La)||void 0===s?void 0:s.PptInitParams.ClientDiagnostics,this.ic(e)},this.ic=e=>{if(window.performance&&window.performance.getEntriesByType){var t;const i=null===(t=window.performance.getEntriesByType("navigation")[0])||void 0===t?void 0:t.toJSON();i&&i.name&&(delete i.name,e.HostPerfNavigationTelemetry=i)}},this.oc=(e,t,i)=>{this.Ga&&(this.Ga.wopiInfo=e),t===dt.UnifiedCreateNew&&function(e){if(e&&e.NewFilePath)window.history.replaceState(null,"",e.NewFilePath),e.UpdatedPageTitle&&(window.document.title=e.UpdatedPageTitle);else if(window.location.href.indexOf("action=editnew")>=0){const e=window.location.href.replace("action=editnew","action=edit");window.history.replaceState(null,window.document.title||"",e)}}(i),window.setTimeout(this.$a,1)},this.Xa=()=>{window.removeEventListener("beforeunload",this.rn,{capture:!0}),window.removeEventListener("pagehide",this.an,{capture:!0}),window.removeEventListener("visibilitychange",this.cn,{capture:!0})},this.sc=()=>{const e=Ve(this.ci);this.Rr?this.Rr.sendPostMessage(this.Ja,q.Ni,{isTopFrameTrusted:e}):this.ci.ULS.Ye(51237655,E.B,F.Error,"Trust frame request received but the wac frame is null")};let n,r=void 0;Promise&&(this.nc=new Promise(e=>this.rc=e));try{let a,l=!1;e.WopiPrecheckInfo&&e.WopiPrecheckInfo.PreseededWacSessionId?(n=e.WopiPrecheckInfo.PreseededWacSessionId,l=!0):i?n=i:[n,a]=ne(),D(Ai(e.ApplicationUrl,n),"PowerPoint","init"),function(e){if(void 0===e)throw new TypeError("initParams");const t=e.Container;if(void 0===t||void 0===t.appendChild)throw new TypeError("Container");const i=e.SessionInformation;if(void 0===i||void 0===i.HostName||void 0===i.HostSessionId||void 0===i.UserId)throw new TypeError("SessionInformation");const o=e.ApplicationUrl;if(void 0===o||"string"!=typeof o)throw new TypeError("ApplicationUrl");const s=e.WopiPrecheckInfo;if(void 0===s||void 0===s.FileName)throw new TypeError("WopiPrecheckInfo");if(void 0===e.FnOnInitializeSuccess)throw new TypeError("FnOnInitializeSuccess");if(void 0===e.FnOnInitializeFailure)throw new TypeError("FnOnInitializeFailure")}(e),function(e){!e.WopiPrecheckInfo.PreseededSessionKey||"_._._."===e.WopiPrecheckInfo.PreseededSessionKey.slice(0,6)&&"-.-.-."===e.WopiPrecheckInfo.PreseededSessionKey.slice(-6)||(e.WopiPrecheckInfo.PreseededSessionKey="_._._."+e.WopiPrecheckInfo.PreseededSessionKey+"-.-.-.")}(e),e.ApplicationUrl=c(e.ApplicationUrl,f(e.ApplicationUrl,"region")),e.ApplicationUrl=g(e.ApplicationUrl,"region");const h=function(e){if(e){const t=zt(e);return t?t.PodsUrl:e.substring(0,e.toLowerCase().indexOf("powerpointframe.aspx")).replace("/p/","/pods/")}return""}(e.ApplicationUrl);r=t||Z({remoteUlsEndpoint:h+"RemoteUls.ashx",sessionId:n}),this.ci=r;const u=hi(e.SessionInformation.HostSessionId),p={...e,SessionId:n,PostMessageToken:u,OnDemandServer:h,FeatureManager:o||ee(e.FnIsFeatureEnabled,r),SettingsManager:s||new oe("PowerPoint",r),UsePodsDetails:Zi(e,r),ClientDiagnostics:be()};s||(p.SettingsManager.addSettingsChangeListener(r.settingsChangeHandler),p.SettingsManager.initializePeriodicFetch(h,n)),new Ei(p,r),r.ULS.Ye(38580693,E.B,F.Warning,`PPTBootstrapper - initializing session. Build version: ${O()}; UserSessionId: ${n}; IsSessionIdPreseeded: ${l}; IsSessionIdToUseProvided: ${!!i}`),r.ULS.Ye(38580694,E.B,F.Info,"Bootstrapper Init Time: "+(new Date).getTime()),a&&r.ULS.Ye(572618978,E.B,F.Info,JSON.stringify(a)),window.addEventListener("unload",()=>{r.ULS.Ye(41157219,E.B,F.Warning,"Unloading bootstrapper window."),r.ULS.flushOnClose()}),this.rn=()=>mi(r,"OnBeforeUnload",!0),this.an=()=>mi(r,"OnPageHide",!0),this.cn=()=>mi(r,"VisibilityChange_"+document.visibilityState,!0),window.addEventListener("beforeunload",this.rn,{capture:!0,once:!0}),window.addEventListener("pagehide",this.an,{capture:!0}),window.addEventListener("visibilitychange",this.cn,{capture:!0}),r.ULS.Ye(38580695,E.B,F.Info,"Application.InitializeWopiPending"),function(e,t){const i={BootstrapperType:"TypeScript",JsApiVersion:"v1",Preview:!1,Scenario:"Unified App",ApplicationUrl:P(e.ApplicationUrl)||null,IsDeepLink:!!_("nav"),BootstrapperInstanceId:re(),IsMobileView:we()};i.ApplicationCustomSettings={OnDemandServer:P(e.OnDemandServer)||null,EnableWacFallback:!0};const o=e.SessionInformation,s=e.Diagnostics,n=s&&s.userClickTime?s.userClickTime:o.DocumentClickTime?o.DocumentClickTime.getTime():null;i.SessionInformation={HostName:o.HostName,HostSessionId:o.HostSessionId,UiLocale:o.UiLocale,DataLocale:o.DataLocale,DocumentClickTime:n,HostInitTime:o.HostInitTime,CurrentTime:H(),UiHost:pi(o.HostName),WdParams:o.WdParams},i.Diagnostics={EntryPoint:ci(e),FileHost:fi(e.SessionInformation.HostName),PodsRing:"",UnifiedUiHostDiagnostics:s?s.unifiedUiHostDiagnostics:null};const r=e.WopiPrecheckInfo,a=!!r.FileGetUrl,c=!!r.CustomFontCatalogUrl;i.WopiPrecheckInfo={FileSize:r.FileSize,FileGetUrlBool:a,CustomFontCatalogBool:c,FileGetUrlLength:a?r.FileGetUrl.length:null,FileNameBool:!!r.FileName,ReadOnly:r.ReadOnly,IrmEnabled:r.IrmEnabled,SupportsDecryptedContentDownload:r.SupportsDecryptedContentDownload,ViewOnly:r.ViewOnly,PreseededSessionKey:!!r.PreseededSessionKey,FileExtension:X(r.FileName)||null,BundleInfo:r.BundleInfo?{MajorVersion:r.BundleInfo.MajorVersion,URLBool:!!r.BundleInfo.Url}:{}},i.AppInfo={AppVersionMajor:1,AppVersionMinor:k(),Environment:"wac",UserAgent:window.navigator.userAgent},i.AdditionalTelemetry={PostMessageToken:e.PostMessageToken},t.ULS.Ye(22357763,E.B,F.Info,JSON.stringify(i,Q))}(p,r);const m=p.UsePodsDetails;!function(e,t,i){const o={ShouldUsePodsOrCached:e.ShouldUsePODS,ShouldUsePods:e.ShouldUsePODS,CanUsePods:e.CanUsePODS,ApplicationUrl:P(t)||null,Reason:e.Reason,CreateNewScenario:dt[e.CreateNewScenario]};i.ULS.Ye(38580687,E.B,F.Info,JSON.stringify(o))}(m,p.ApplicationUrl,r);const w=m.ShouldUsePODS;if(w){p.Diagnostics&&p.Diagnostics.userClickTime&&Pe(p.Diagnostics.userClickTime,r),p.IsFileNew=m.CreateNewScenario!==dt.NotCreateNew,p.WopiPrecheckInfo.ReadOnly=p.WopiPrecheckInfo.ReadOnly||!1;const e=Ci(p,r);if(!e){const e={Message:"Error creating IFrame",HostSessionId:p.SessionInformation.HostSessionId};throw r.ULS.Ye(38580696,E.B,F.Error,JSON.stringify(e)),Error("Error Creating IFrame")}r.ULS.Ye(50376725,E.B,F.Warning,"Assigning wopiBootParams"),this.Ja=e.IFrameElement,this.rc&&this.rc(this.Ja),this.Ga&&(this.Ga.iframe=e.IFrameElement,this.Ga.podsUrl=Xt(p.OnDemandServer),this.Ga.readonly=p.WopiPrecheckInfo.ReadOnly,this.Ga.irmEnabled=p.WopiPrecheckInfo.IrmEnabled,this.Ga.supportsDecryptedContentDownload=p.WopiPrecheckInfo.SupportsDecryptedContentDownload,this.Ga.fileName=p.WopiPrecheckInfo.FileName),this.Rr=new Yi(d(p.ApplicationUrl),r),this.Rr.activate(e.IFrameElement),p.SessionInformation.SupportsFrameTrustCheck||this.Rr.registerMessagePayloadHandler(j.Ni,this.sc),this.Ya=p.SessionInformation.SessionContext?p.SessionInformation.SessionContext:"",this.ec="",p.SessionInformation.WdParams&&(this.ec=gi(p.SessionInformation.WdParams)),this.ec&&r.ULS.Ye(539837381,E.B,F.Warning,"Non-empty WdParams Assigned");const t={...p.Diagnostics,hostName:p.SessionInformation.HostName};t.officeFrameCreateTime=e.FrameCreateTime,t.cacheHit=!1,this.La={AppInitDiagnostics:t,PptInitParams:p};const i=qi.getInstance();i&&i.add(u,this)}r.ULS.Ye(50376727,E.B,F.Warning,"Creating WopiPendingApplication"),this.Za={Complete:(e,t)=>{w?this.oc(e,m.CreateNewScenario,t):function(e,t,i,o,s){i.ULS.Ye(38147724,E.B,F.Info,"Launching Wac Fallback");const n=document.createElement("iframe");n.id="WebApplicationFrame",n.name="wac_frame",n.title="Office Online Frame",n.frameBorder="0",n.style.top="0",n.style.bottom="0",n.style.left="0",n.style.right="0",n.style.height="100%",n.style.width="100%",n.style.minHeight="200px",n.style.minWidth="300px",n.style.position="absolute",n.setAttribute("allowfullscreen","true"),n.setAttribute("allowTransparency","true"),n.style.minHeight="150px";const r=t.Container;r.style.top="0",r.style.bottom="0",r.style.left="0",r.style.right="0",r.style.height="100%",r.style.width="100%",r.style.minHeight="150px";const a=document.createElement("div");a.style.top="0",a.style.bottom="0",a.style.left="0",a.style.right="0",a.style.height="100%",a.style.width="100%",a.style.minHeight="150px",a.style.backgroundColor="#393a3d",a.style.backfaceVisibility="hidden";const c=document.createElement("form");c.name="wac_form",c.id="wac_form",c.target="wac_frame",c.action=function(e,t){if(e.WopiSrc.indexOf("PowerPointFrame.aspx")>=0){const t=e.WopiSrc.substr(e.WopiSrc.indexOf("WOPISrc=")+8),i=t.indexOf("&");e.WopiSrc=i<0?decodeURIComponent(decodeURI(t)):decodeURIComponent(t.substring(0,i))}const i=t.ApplicationUrl,o=i.indexOf("?");let s=i.substring(0,o);return s+="?wdEnableRoaming=1&wdo=1",s=qt(s,"PowerPointView",f(i,"PowerPointView")),S(i,"new")&&(s=qt(s,"New","1")),S(i,"embed")&&(s=qt(s,"Embed","1")),t.OnDemandServer||(s=qt(s,"noLog","True")),e.WopiSrc&&(s=qt(s,"WOPISrc",b(e.WopiSrc))),s=Zt(s),s}(e,t),c.method="post",c.appendChild(bi("access_token",e.AccessToken)),c.appendChild(bi("access_token_ttl",e.AccessTokenExpiry?e.AccessTokenExpiry.getTime().toString():"0")),e.WacToken&&c.appendChild(bi("wac_token",e.WacToken)),r.appendChild(c),r.appendChild(a),a.appendChild(n),c.submit();const d={};o.stop();const l=o.getVisibilityChangeEvents();l&&l.length>0&&(d.documentLoadedWithTabSwitch=!0,i.ULS.Ye(38147725,E.B,F.Info,"Visibility Change Events:"+JSON.stringify(l))),t.FnOnInitializeSuccess(new Ti(s),d)}(e,p,r,this.ja,u)},Fail:e=>{this.ci.ULS.Ye(38293905,E.B,F.Info,"Host failed to give us WopiInfo")},Dispose:(e,t)=>{this.Ka(),t&&t()},PostWacToken:(e,t,i)=>{this.Rr?function(e,t,i,o,s,n){const r=H();o.ULS.Ye(507774684,E.B,F.Important,"postWacToken flow initiated");const a=()=>{n&&n.flush&&n.flush()};s?s.then(s=>{const c=()=>i.sendPostMessage(s,q.in,{wacToken:e,postWacTokenStart:t});c();const d=window.setInterval(c,100);i.registerMessagePayloadHandler(j.os,e=>{o.ULS.Ye(507597019,E.B,F.Info,`postWacToken flow completed in ${H()-r} ms`),window.clearInterval(d),window.clearTimeout(l),n&&(n.PostWacTokenResult="success",n.PostWacTokenEndTime=H(),e&&void 0!==e.TokenAlreadySet&&(n.TokenAlreadySet=e.TokenAlreadySet),a())});const l=window.setTimeout(()=>{o.ULS.Ye(507597018,E.B,F.Warning,"postWacToken flow timed out after 60000 ms"),window.clearInterval(d),n&&(n.PostWacTokenResult="timeout",n.PostWacTokenEndTime=H(),a())},6e4)}).catch(e=>{o.ULS.Ye(507873094,E.B,F.Warning,"This should never reject, error: "+Y(e)),n&&(n.PostWacTokenResult="Unexpected JSAPI V1 error",n.PostWacTokenEndTime=H(),a())}):(o.ULS.Ye(507846862,E.B,F.Warning,"`Promise` does not exist natively for this browser."),n&&(n.PostWacTokenResult="JSAPI V1 error: Promise not supported in browser",n.PostWacTokenEndTime=H(),a()))}(e,t,this.Rr,this.ci,this.nc,i):this.ci.ULS.Ye(507846861,E.B,F.Info,"PPTUnifiedBootstrapper::PostWacToken, this._postMessageHandler is undefined")}},li(p.BootstrapperUrl,r),window.setTimeout(()=>{r&&r.ULS.flush()},1e4)}catch(t){r&&(r.ULS.Ye(38580697,E.B,F.Error,yi.AppInitError+": "+Y(t)),r.ULS.flushOnClose()),e&&(e.ApplicationUrl&&D(Ai(e.ApplicationUrl,n),"PowerPoint","bootException"),e.FnOnInitializeFailure&&e.FnOnInitializeFailure({errorType:yi.AppInitError,errorObject:t}))}}}var ao;!function(e){e[e.NotSupported=0]="NotSupported",e[e.SameDocOnly=1]="SameDocOnly",e[e.AnyDoc=2]="AnyDoc",e[e.OtherMode=4]="OtherMode"}(ao||(ao={}));const co=new class{GetVersion(){return O()}GetMinContentVersion(){return 1}Prefetch(){}InitializeWopiPending(e,t,i,o,s,n){return new ro(e,t,i,s,n).getWopiPendingApplication()}},lo=e=>{const t={name:"PowerPoint",usePreseededSessionId:!0,preconnector:y()};return new Ge(e,t,zi)}}});
//# sourceMappingURL=powerpoint.app.boot.226a70a08bfb0194d7c9.js.map